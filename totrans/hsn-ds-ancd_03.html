<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Data Basics</h1>
                </header>
            
            <article>
                
<p>In this chapter, we'll first discuss sources of open data, which includes the <strong>University of California at Irvine</strong> (<strong>UCI</strong>) Machine Learning Depository, the Bureau of Labor Statistics, the Census Bureau, Professor French's Data Library, and the Federal Reserve's Data Library. Then, we will show you several ways of inputting data, how to deal with missing values, sorting, choosing a subset, merging different datasets, and data output. For different languages, such as Python, R, and Julia, several relevant packages for data manipulation will be introduced as well. In particular, the Python <kbd>pandas</kbd> package will be discussed.</p>
<p>In this chapter, the following topics will be covered:</p>
<ul>
<li>Sources of data</li>
<li>Introduction to the Python pandas package</li>
<li>Several ways to inputting packages</li>
<li>Introduction to the Quandl data delivery platform</li>
<li>Dealing with missing data</li>
<li>Sorting data, as well as how to slice, dice, and merge various datasets</li>
<li>Introduction to Python packages: <kbd>cbsodata</kbd> and <kbd>datadotword</kbd></li>
<li>Introduction to R packages: <kbd>dslabs</kbd>, <kbd>haven</kbd>, and <kbd>foreign</kbd></li>
<li>Generating Python datasets</li>
<li>Generating R datasets</li>
</ul>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Sources of data</h1>
                </header>
            
            <article>
                
<p>For users in the area of data science and business analytics, one important issue is the source of data, or simply where to get data. When working at a company, the obvious source of data is one's own company, such as sales, cost of raw materials, the salary of managers and other employees, the related information of suppliers and clients, estimations of future sales, the cost of raw materials, and so on. It is a good idea to find some data for learning purposes, and this is especially true for full-time students.</p>
<p>Generally speaking, there are two types of data: <strong>public</strong> and <strong>private</strong>. Private or proprietary databases are quite expensive. A typical example is the <strong>Center for Research in Security Prices</strong> (<strong>CRSP</strong>) database, a financial database generated and maintained by the University of Chicago. This database has daily, weekly, monthly, and annual trading data for all stocks listed on stock exchanges in the US from 1926 onward.</p>
<p>The second type of data is public or free data. For users in various data science or business analytics programs, this type of data is more than enough. For example, the UCI offers many useful datasets for machine learning that can be used for testing and learning purposes. This offers great benefits to new learners in the area of data science. Later in the chapter, several lists of free data will be offered for learners in data science, economics, and finance and accounting.</p>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">UCI machine learning</h1>
                </header>
            
            <article>
                
<p>The UCI maintains 413 datasets, as of 1/10/2018, for machine learning: <a href="http://archive.ics.uci.edu/ml/index.php"><span class="URLPACKT">http://archive.ics.uci.edu/ml/index.php</span></a>. The following screenshot shows the top three downloaded datasets:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-646 image-border" src="Images/c71cd339-196b-4f81-af74-26a055043229.png" style="width:18.42em;height:12.42em;" width="299" height="201"/></div>
<p>For the number one downloaded dataset called <strong>Iris</strong>, we have the following information:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-647 image-border" src="Images/b4ea2960-8525-4cf7-b584-5055d9a608bf.png" style="width:45.17em;height:28.92em;" width="714" height="458"/></div>
<p>The beauty of these datasets is that they give quite detailed information such as the source, the creator or donator, a description, and even citations.</p>
<p>The following table shows several potential public data sources for users in the area of data science and business analytics:</p>
<table style="border-collapse: collapse;width: 100%" class="table" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Name</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Web page</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Data types</strong></div>
</td>
</tr>
<tr>
<td>
<p>UCI</p>
</td>
<td>
<p><a href="http://archive.ics.uci.edu/ml/index.php"><br/>
<span class="URLPACKT">http://archive.ics.uci.edu/ml/index.php</span><br/></a></p>
</td>
<td>
<p>Data for machine learning</p>
</td>
</tr>
<tr>
<td>
<p>World Health Organization</p>
</td>
<td>
<p><a href="http://www.who.int/en/"><br/>
<span class="URLPACKT">http://www.who.int/en/</span><br/></a></p>
</td>
<td>
<p>Healthcare data</p>
</td>
</tr>
<tr>
<td>
<p>Amazon Web Services</p>
</td>
<td>
<p><a href="https://aws.amazon.com/cn/datasets/?nc1=h_ls"><span class="URLPACKT">https://aws.amazon.com/cn/datasets/?nc1=h_ls</span></a></p>
</td>
<td>
<p>Web usage</p>
</td>
</tr>
<tr>
<td>
<p>Data.gov (US Government Open Data)</p>
</td>
<td>
<p><a href="https://www.data.gov/"><span class="URLPACKT">https://www.data.gov/</span></a></p>
</td>
<td>
<p>Agriculture, climate, consumer, and so on</p>
</td>
</tr>
<tr>
<td>
<p>GitHub</p>
</td>
<td>
<p><a href="https://github.com/caesar0301/awesome-public-datasets"><span class="URLPACKT">https://github.com/caesar0301/awesome-public-datasets</span></a></p>
</td>
<td>
<p>Many datasets offered by individuals</p>
</td>
</tr>
<tr>
<td>
<p>Open data network</p>
</td>
<td>
<p><a href="https://www.opendatanetwork.com/"><span class="URLPACKT">https://www.opendatanetwork.com/</span></a></p>
</td>
<td>
<p>Many useful datasets</p>
</td>
</tr>
<tr>
<td>
<p>Government health data</p>
</td>
<td>
<p><a href="https://www.healthdata.gov/"><span class="URLPACKT">https://www.healthdata.gov/</span></a></p>
</td>
<td>
<p>Healthcare-related datasets</p>
</td>
</tr>
<tr>
<td>
<p>Google public data</p>
</td>
<td>
<p><a href="https://www.google.com/publicdata/directory"><span class="URLPACKT">https://www.google.com/publicdata/directory</span></a></p>
</td>
<td>
<p>World development indicators</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.1: Potential sources of open data for data science and business analytics</div>
<p>After we go to <a href="https://www.data.gov/"><span class="URLPACKT">https://www.data.gov</span><span class="URLPACKT">/</span></a>, we can see the following choices related to <strong>Agriculture</strong>, <strong>Climate</strong>, <strong>Consumer</strong>, <strong>Ecosystems</strong>, <strong>Education</strong>, and the like:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-648 image-border" src="Images/003fd049-ae65-419e-a2ba-78a9777ecc80.png" style="width:70.92em;height:33.33em;" width="851" height="400"/></div>
<p>The next table shows the potential sources of open data for users in the area of economics:</p>
<table style="border-collapse: collapse;width: 100%" class="table" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Name</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Web page</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Data types</strong></div>
</td>
</tr>
<tr>
<td>
<p>Federal reserve economic data</p>
</td>
<td>
<p><a href="https://www.federalreserve.gov/datadownload/Choose.aspx?rel=H15"><br/>
<span class="URLPACKT">https://www.federalreserve.gov/datadownload/Choose.aspx?rel=H15</span><br/></a></p>
</td>
<td>
<p>Interest rates and rates for AAA/AA rated bonds</p>
</td>
</tr>
<tr>
<td>
<p>Census bureau</p>
</td>
<td>
<p><a href="http://www.census.gov/"><br/>
<span class="URLPACKT">http://www.census.gov/</span><br/></a></p>
<p><a href="https://www.census.gov/about/index.html">https://www.census.gov/about/index.html</a></p>
</td>
<td>
<p>Census data</p>
</td>
</tr>
<tr>
<td>
<p>US. dept. treasure</p>
</td>
<td>
<p><a href="http://www.treas.gov"><br/>
<span class="URLPACKT">http://www.treas.gov</span><br/></a></p>
</td>
<td>
<p>US treasure yield</p>
</td>
</tr>
<tr>
<td>
<p>Bureau of labor statistics</p>
</td>
<td>
<p><a href="http://www.bls.gov/"><br/>
<span class="URLPACKT">http://www.bls.gov/</span><br/></a></p>
<p><a href="http://download.bls.gov/"><br/>
<span class="URLPACKT">http://download.bls.gov/</span><br/></a></p>
</td>
<td>
<p>Inflation, employment, unemployment, pay and benefits, and so on</p>
</td>
</tr>
<tr>
<td>
<p>Bureau of economic analysis</p>
</td>
<td>
<p><a href="http://www.bea.gov"><br/>
<span class="URLPACKT">http://www.bea.gov/</span><br/></a></p>
</td>
<td>
<p>GDP, personal income outlays, corporate profit, and so on</p>
</td>
</tr>
<tr>
<td>
<p>National bureau of economic research</p>
</td>
<td>
<p><a href="http://www.nber.org/"><br/>
<span class="URLPACKT">http://www.nber.org/</span><br/></a></p>
</td>
<td>
<p>Business cycles, vital statistics, reports of presidents, and so on</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.2: Potential sources of open data for economics</div>
<p>After going to the Federal Reserve economic data and clicking <span class="packt_screen">Data</span> on the menu, we can see the following entries:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-649 image-border" src="Images/267c0005-8bda-4f67-b203-b14ede16c632.png" style="width:47.08em;height:31.17em;" width="752" height="498"/></div>
<p>The following table offers free data for users in the areas of finance and accounting:</p>
<table style="border-collapse: collapse;width: 100%" class="table" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Name</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Web page</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Data types</strong></div>
</td>
</tr>
<tr>
<td>
<p>Yahoo!Finance</p>
</td>
<td>
<p><a href="http://finance.yahoo.com"><span class="URLPACKT">http://finance.yahoo.com</span></a></p>
</td>
<td>
<p>Historical pricing data, options, balance sheets, and income statements</p>
</td>
</tr>
<tr>
<td>
<p>Google Finance</p>
</td>
<td>
<p><a href="http://www.google.com/finance"><br/>
<span class="URLPACKT">http://www.google.com/finance</span><br/></a></p>
</td>
<td>
<p>Current and historical trading prices</p>
</td>
</tr>
<tr>
<td>
<p>Marketwatch</p>
</td>
<td>
<p><a href="http://www.marketwatch.com"><span class="URLPACKT">http://www.marketwatch.com</span></a></p>
</td>
<td>
<p>Financial statements</p>
</td>
</tr>
<tr>
<td>
<p>SEC filing</p>
</td>
<td>
<p><a href="http://www.sec.gov/edgar.shtml"><span class="URLPACKT">http://www.sec.gov/edgar.shtml</span></a></p>
</td>
<td>
<p>Balance sheets, income statements, holdings, and so on</p>
</td>
</tr>
<tr>
<td>
<p>Professor French's data library</p>
</td>
<td>
<p><a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html"><br/>
<span class="URLPACKT">http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html</span><br/></a></p>
</td>
<td>
<p>Fama/French factors, market index, risk-free rate, industry classification, and so on</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.3: Potential sources of open data for finance and accounting</div>
<p>From Professor French's data library, we could download the famous Fama/French's three-factor time series:</p>
<pre>&gt; infile&lt;-"http://canisius.edu/~yany/data/ff3monthly.csv" 
&gt; x&lt;-read.csv(infile,skip=3) 
&gt; head(x,2) 
<strong>    Date Mkt.RF  SMB   HML   RF 
1 192607   2.96 -2.3 -2.87 0.22 
2 192608   2.64 -1.4  4.19 0.25</strong> 
&gt; tail(x,2) 
<strong>       Date Mkt.RF   SMB   HML   RF 
1095 201709   2.51  4.53  3.02 0.09 
1096 201710   2.25 -1.94 -0.09 0.09</strong> </pre>
<p>In the previous code, the input file called <kbd>ff3monthly.csv</kbd> is a modified copy of <kbd><em>F-F_Research_Data_Factor.csv</em></kbd> made by removing the second part of the annual data and adding a <kbd>Date</kbd> as the header. Note that <kbd><em>F-F_Research_Data_Factor.csv</em></kbd> is from the ZIP file called <kbd><em>F-F_Research_Data_Factor_CSV.zip</em></kbd>.</p>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the Python pandas package</h1>
                </header>
            
            <article>
                
<p>The Python pandas package is very useful when dealing with data. The pandas package is a wonderful tool for data preprocessing, which is essential for data analysis. There is a humorous way of describing the importance of data cleaning: "<em>A data scientist spends 80% of their time cleaning the data and the other 20% complaining about cleaning the data"</em>. To test if the package is preinstalled, we can type <kbd>import pandas as pd</kbd> after we launch Python. If we don't see any error messages, it means that the package was preinstalled. If we do, then we can use <kbd>conda install pandas</kbd> to install the package. To find all available functions, we could use the following three lines of Python code:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-650 image-border" src="Images/71f2655d-31c4-409f-bbf5-cb04951fbc49.png" style="width:82.33em;height:35.17em;" width="988" height="422"/></div>
<p>To find out about the usage or examples of individual functions, the <kbd>help()</kbd> function can be used. For example, for the <kbd>to_pickle</kbd> functionality shown at the bottom of the previous screenshot, we type <kbd>help(pd.to_pickle)</kbd>, shown in the first line here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-651 image-border" src="Images/dc7aa636-acb0-452e-9a91-fd761b4159ad.png" style="width:33.08em;height:15.25em;" width="518" height="238"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Several ways to input data</h1>
                </header>
            
            <article>
                
<p>First, let's look at how to input a <strong>Comma Separated Value</strong> (<strong>CSV</strong>) file. The input dataset is the most popular one from UCI Machine Learning Data Depository. The location is <a href="http://archive.ics.uci.edu/ml/machine-learning-databases/iris/bezdekIris.data"><span class="URLPACKT">http://archive.ics.uci.edu/ml/machine-learning-databases/iris/bezdekIris.data</span></a>; you can refer to the following screenshot as well:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-652 image-border" src="Images/65a83bee-7fbe-4883-a790-13a5700d952c.png" style="width:34.00em;height:16.75em;" width="614" height="303"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Inputting data using R</h1>
                </header>
            
            <article>
                
<p>The R code is shown here:</p>
<pre>&gt; path&lt;-"http://archive.ics.uci.edu/ml/machine-learning-databases/" 
&gt; dataSet&lt;-"iris/bezdekIris.data" 
&gt; a&lt;-paste(path,dataSet,sep='') 
&gt; x&lt;-read.csv(a,header=F) 
&gt; colnames(x)&lt;-c("sepalLength","sepalWidth","petalLength","petalWidth","Class") </pre>
<p>The <kbd>dim()</kbd>, <kbd>head()</kbd>, and <kbd>tail()</kbd> functions can be used to look at the size and the first and last several observations of the dataset, shown here:</p>
<pre>&gt; dim(x) 
<strong>   [1] 150   5</strong> 
&gt; head(x,2) 
<strong>  sepalLength sepalWidth petalLength petalWidth       Class 
1         5.1        3.5         1.4        0.2 Iris-setosa 
2         4.9        3.0         1.4        0.2 Iris-setosa</strong> 
&gt; tail(x,2) 
<strong>    sepalLength sepalWidth petalLength petalWidth          Class 
149         6.2        3.4         5.4        2.3 Iris-virginica 
150         5.9        3.0         5.1        1.8 Iris-virginica</strong> </pre>
<p>Alternatively, we can use other R functions to input data from an external data file. Those functions include the <kbd>read.table()</kbd>, <kbd>read.delim()</kbd>, and <kbd>read.fwf()</kbd> functions. To find out all functions starting with <kbd>read.</kbd>, we could apply the <kbd>apropos()</kbd> function, shown here:</p>
<pre>&gt; apropos("read.") 
<strong> [1] ".read.xls"        ".readRDS"         "read.csv"         
 [4] "read.csv2"        "read.dcf"         "read.delim"       
 [7] "read.delim2"      "read.DIF"         "read.fortran"     
[10] "read.ftable"      "read.fwf"         "read.lines"       
[13] "read.links"       "read.lynx"        "read.socket"      
[16] "read.table"       "read.w3m"         "read.xls"         
[19] "readBin"          "readChar"         "readCitationFile" 
[22] "readClipboard"    "readline"         "readLines"        
[25] "readRDS"          "readRegistry"     "readRenviron"     
[28] "readSeries"       "spreads"          "spreadSeries"     
[31] "Sys.readlink" </strong>    </pre>
<p>To find out the exact usage of individual functions, we use the <kbd>help()</kbd> function. For example, after issuing <kbd>help (read.fwf)</kbd>, we can find information about this specific function, shown in the screenshot in the first several lines:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-653 image-border" src="Images/b914ce15-02c4-44c4-9341-6029dd71ed00.png" style="width:43.58em;height:18.08em;" width="1089" height="451"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Inputting data using Python</h1>
                </header>
            
            <article>
                
<p>Similarly, we can use Python to retrieve the data, as shown in the code here:</p>
<pre>import pandas as pd 
path="http://archive.ics.uci.edu/ml/machine-learning-databases/" 
dataset="iris/bezdekIris.data" 
inFile=path+dataset 
data=pd.read_csv(inFile,header=None) 
data.columns=["sepalLength","sepalWidth","petalLength","petalWidth","Class"] </pre>
<p>After retrieving data, the <kbd>print(data.head(2))</kbd> function can be used to see the first two instances:</p>
<pre>&gt; print(data.head(2)) <br/><strong>   sepalLength  sepalWidth  petalLength  petalWidth        Class
0          5.1         3.5          1.4         0.2  Iris-setosa
1          4.9         3.0          1.4         0.2  Iris-setosa</strong></pre>
<p class="mce-root">When typing <kbd>pd.read.csv()</kbd>, we can find the definitions of all input variables, shown in the following screenshot. Again, to save space, only the first several input variables are shown:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-654 image-border" src="Images/05dd6a84-7d4b-4a74-952c-7dbc6f1e75c0.png" style="width:31.83em;height:11.42em;" width="498" height="178"/></div>
<p>To prevent a future potential change in terms of a dataset link, we have a backup dataset located at the author's website, shown in the following Python code:</p>
<pre>inFile="http://canisius.edu/~yany/data/bezdekIris.data.txt" 
import pandas as pd 
d=pd.read_csv(inFile,header=None) </pre>
<p class="mce-root">The following table shows several functions included in the pandas package that we could use to retrieve data:</p>
<table style="border-collapse: collapse;width: 100%" class="MsoTableGrid" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Function</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Description</strong></div>
</td>
</tr>
<tr>
<td>
<p><kbd>read_clipboard</kbd></p>
</td>
<td>
<p>Read text from clipboard and pass to <kbd>read_table</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_csv</kbd></p>
</td>
<td>
<p>Read a CSV file into <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_excel</kbd></p>
</td>
<td>
<p>Read an Excel table into a pandas <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_feather</kbd></p>
</td>
<td>
<p>Load a feather-format object from the file path</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_fwf</kbd></p>
</td>
<td>
<p>Read a table of formatted lines with fixed-width into <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_gbq</kbd></p>
</td>
<td>
<p>Load data from Google BigQuery</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_hdf</kbd></p>
</td>
<td>
<p>Retrieve a pandas object stored in a file</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_html</kbd></p>
</td>
<td>
<p>Read HTML tables into a list of <kbd>DataFrame</kbd> objects</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_json</kbd></p>
</td>
<td>
<p>Convert a JSON string into a pandas object</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_msgpack</kbd></p>
</td>
<td>
<p>Load a <kbd>msgpack</kbd> pandas object from the specified file path</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_pickle</kbd></p>
</td>
<td>
<p>Load a <kbd>pickled</kbd> pandas object (or any other <kbd>pickled</kbd> object) from the specified file path</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_sas</kbd></p>
</td>
<td>
<p>Read SAS files stored as either XPORT or SAS7BDAT format files</p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_sql</kbd></p>
</td>
<td>
<p>Read an SQL query or database table into a <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_sql_query</kbd></p>
</td>
<td>
<p>Read an SQL query into a <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_sql_table</kbd></p>
</td>
<td>
<p>Read an SQL database table into a <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_stata</kbd></p>
</td>
<td>
<p>Read a Stata file into a <kbd>DataFrame</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>read_table</kbd></p>
</td>
<td>
<p>Read a general delimited file into a <kbd>DataFrame</kbd></p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.4 Functions included in the Python pandas module for inputting data</div>
<p>To find out detailed information on each of the preceding functions, we use the <kbd>help()</kbd> function. For example, if we want to get more information about the <kbd>read_sas()</kbd> function, we issue the following commands:</p>
<pre>import pandas as pd 
help(pd.read_sas) </pre>
<p>The corresponding output, the top part only, is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-655 image-border" src="Images/aa299345-1e1a-4976-95d6-ef8c4107a87b.png" style="width:48.17em;height:5.75em;" width="823" height="98"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the Quandl data delivery platform</h1>
                </header>
            
            <article>
                
<p>Quandl is a data delivery platform that includes many free datasets. Its website is <a href="https://www.quandl.com"><span class="URLPACKT">https://www.quandl.com</span></a>. The following are a few programs written in R or Python to download data from the platform. The following program retrieves the latest <kbd>50</kbd> trading days' data for <strong>International Business Machine</strong> (<strong>IBM</strong>):</p>
<pre>&gt; library(Quandl) 
&gt; x&lt;- Quandl.dataset.get("WIKI/ibm", list(rows=50)) 
&gt; head(x,2) 
<strong>        Date   Open    High     Low  Close  Volume Ex-Dividend 
1 2018-01-09 163.90 164.530 163.060 163.83 4333418           0 
2 2018-01-08 162.66 163.905 161.701 163.47 5101023           0 
  Split Ratio Adj. Open Adj. High Adj. Low Adj. Close Adj. Volume 
1           1    163.90   164.530  163.060     163.83     4333418 
2           1    162.66   163.905  161.701     163.47     5101023</strong> </pre>
<p>Note that we just need to issue the first two lines in the code once. The following code would get the data for a Chinese company with a ticker symbol of <kbd>601628</kbd>. Obviously, <kbd>DY4</kbd> is for Chinese data:</p>
<pre>import Quandl as qd 
y&lt;- Quandl.dataset.get("DY4/601628", list(rows=50)) 
&gt; head(y,2) </pre>
<p>The corresponding output is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-656 image-border" src="Images/23e43492-56dc-4814-bd72-17cc94bed33e.png" style="width:36.17em;height:9.75em;" width="625" height="169"/></div>
<p>For the following R program, we assume that the Quandl application key is contained in the <kbd>myQuandlKey</kbd> variable. Later in the chapter, we explain how to get a Quandl application key:</p>
<pre>&gt; library(Quandl) 
&gt; Quandl.api_key(myQuandlKey) 
&gt; x&lt;- Quandl.dataset.get("WIKI/wmt", list(rows=500)) </pre>
<p>For Python, we have the following code to download the <strong>Gross Domestic Product</strong> (<strong>GDP</strong>) from <kbd>Quandl</kbd>:</p>
<pre>import quandl 
x= quandl.get("FRED/GDP") 
x.head() 
<strong>             Value 
Date                
1947-01-01  243.080 
1947-04-01  246.267 
1947-07-01  250.115 
1947-10-01  260.309 
1948-01-01  266.173</strong> </pre>
<p>The format of the output dataset is a pandas data frame. <kbd>Quandl</kbd> can also return data as a <kbd>numpy</kbd> array, shown here:</p>
<pre>import quandl 
x=quandl.get("FRED/GDP",returns="pandas")     
y=quandl.get("FRED/GDP",returns="numpy") </pre>
<p>The following table shows patterns for different sources of data from the Quandl data platform:</p>
<table style="border-collapse: collapse;width: 100%" class="MsoTableGrid" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Pattern</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Example</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Explanation</strong></div>
</td>
</tr>
<tr>
<td>
<p>WIKI</p>
</td>
<td>
<p><kbd>WIKI/IBM</kbd></p>
</td>
<td>
<p>End-of-day US stock prices</p>
</td>
</tr>
<tr>
<td>
<p>DY4</p>
</td>
<td>
<p><kbd>DYE/60618</kbd></p>
</td>
<td>
<p>Chinese data</p>
</td>
</tr>
<tr>
<td>
<p>FRED</p>
</td>
<td>
<p><kbd>FRED/GDP</kbd></p>
</td>
<td>
<p>Federal Reserve economic data</p>
</td>
</tr>
<tr>
<td>
<p>EIA</p>
</td>
<td>
<p><kbd>EIA/PET_RWTC_D</kbd></p>
</td>
<td>
<p>US Department of Energy</p>
</td>
</tr>
<tr>
<td>
<p>NSE</p>
</td>
<td>
<p><kbd>NSE/OIL</kbd></p>
</td>
<td>
<p>Oil prices</p>
</td>
</tr>
<tr>
<td>
<p>ZEP</p>
</td>
<td>
<p><kbd>ZEP/ibm</kbd></p>
</td>
<td>
<p>Zacks equity prices, dividend history (US)</p>
</td>
</tr>
<tr>
<td>
<p>CBOE</p>
</td>
<td>
<p><kbd>CBOE/VXU2018</kbd></p>
</td>
<td>
<p>Chicago Board Options Exchange</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.5: Patterns for different types/courses of data on the Quandl platform</div>
<p>As of 1/10/2017, in terms of the limitation set by Quandl, see the following table. For free subscribers, users need to register with Quandl to get a Quandl application key:</p>
<table style="border-collapse: collapse;width: 100%" class="MsoTableGrid" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Type of user</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Max calls (every 10 min.)</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Max calls every day</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Concurrent Limit</strong></div>
</td>
</tr>
<tr>
<td>
<p>Anonymous</p>
</td>
<td>
<p>20</p>
</td>
<td>
<p>50</p>
</td>
<td>
<p>1 call</p>
</td>
</tr>
<tr>
<td>
<p>Free subscribers</p>
</td>
<td>
<p>2,000</p>
</td>
<td>
<p>50,000</p>
</td>
<td>
<p>1 + 1 in the queue</p>
</td>
</tr>
<tr>
<td>
<p>Premium</p>
</td>
<td>
<p>5,000</p>
</td>
<td>
<p>720,000</p>
</td>
<td>
<p>No limit</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.6: Max number of calls every 10 min and every day for Quandl users</div>
<p>The next program shows how to retrieve Walmart data for free subscribers, as in, those with a Quandl application key. Being a free subscriber means that you register with Quandl without paying any fees:</p>
<pre>import quandl as qd 
quandl.ApiConfig.api_key = 'YOUR_API_KEY'  
y=qd.get("WIKI/WMT") 
y.head(2) 
y.tail(1) </pre>
<p>The output is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-657 image-border" src="Images/84731c2b-144a-469c-aa5c-9a63abfd11d5.png" style="width:32.83em;height:24.42em;" width="518" height="385"/></div>
<p>The second line of <kbd>quandl.ApiConfig.api_key = 'YOUR_API_KEY'</kbd> indicates that a user has to enter his/her Quandl application key.</p>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Dealing with missing data</h1>
                </header>
            
            <article>
                
<p>First, let's look at the missing codes for different languages:</p>
<table style="border-collapse: collapse;width: 100%" class="MsoTableGrid" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Languages</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Missing code</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Explanation or examples</strong></div>
</td>
</tr>
<tr>
<td>
<p>R</p>
</td>
<td>
<p><kbd>NA</kbd></p>
</td>
<td>
<p><kbd>NA</kbd> stands for Not Available</p>
</td>
</tr>
<tr>
<td>
<p>Python</p>
</td>
<td>
<p><kbd>nan</kbd></p>
</td>
<td>
<p><kbd>import scipy as sp</kbd></p>
<p><kbd>misingCode=sp.nan</kbd></p>
<p> </p>
</td>
</tr>
<tr>
<td>
<p>Jullia</p>
</td>
<td>
<p><kbd>missing</kbd></p>
</td>
<td>
<p><kbd>julia&gt; missing + 5</kbd></p>
<p><kbd>missing</kbd></p>
</td>
</tr>
<tr>
<td>
<p>Octave</p>
</td>
<td>
<p><kbd>NaN</kbd></p>
</td>
<td>
<p>Same for MATLAB as well</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Table 3.7: Missing codes for R, Python, Julia, and Octave</div>
<p>For R, the missing code is <kbd>NA</kbd>. Here are several functions we could use to remove those missing observations, shown in an example:</p>
<pre>&gt; head(na_example,20) 
<strong>[1]  2  1  3  2  1  3  1  4  3  2  2 NA  2  2  1  4 NA  1  1  2</strong> 
&gt; length(na_example) 
<strong>[1] 1000</strong> 
&gt; x&lt;-na.exclude(na_example) 
&gt; length(x) 
<strong>[1] 855</strong> 
&gt; head(x,20) 
<strong>[1] 2 1 3 2 1 3 1 4 3 2 2 2 2 1 4 1 1 2 1 2</strong> </pre>
<p>In the previous example, we removed 145 missing values by using the R function called <kbd>na.exclude()</kbd>. We could also use the <kbd>apropos()</kbd> function to find more functions dealing with missing code in R, as shown here:</p>
<pre> &gt; apropos("^na.") 
<strong> [1] "na.action"              "na.contiguous"          
 [3] "na.exclude"             "na.fail"                
 [5] "na.omit"                "na.pass"                
 [7] "na_example"             "names"                  
 [9] "names.POSIXlt"          "names&lt;-"                
[11] "names&lt;-.POSIXlt"        "namespaceExport"        
[13] "namespaceImport"        "namespaceImportClasses" 
[15] "namespaceImportFrom"    "namespaceImportMethods" 
[17] "napredict"              "naprint"                
[19] "naresid"                "nargs"</strong> 
 </pre>
<p>For Python, we have the following example, First, let’s generate a dataset called <kbd>z.csv</kbd>, see the R code given next. For the program, we generate <kbd>100</kbd> zeros as our missing values:</p>
<pre>set.seed(123)<br/>n=500<br/>x&lt;-rnorm(n)<br/>x2&lt;-x<br/>m=100<br/>y&lt;-as.integer(runif(m)*n)<br/>x[y]&lt;-0<br/>z&lt;-matrix(x,n/5,5)<br/>outFile&lt;-"c:/temp/z.csv"<br/>write.table(z,file=outFile,quote=F,row.names=F,col.names=F,sep=',')</pre>
<p>The following Python program checks missing values for <kbd>5</kbd> columns, replace them with <kbd>NaN</kbd> or with the averages of each columns:</p>
<pre>import scipy as sp<br/>import pandas as pd<br/>path="https://canisius.edu/~yany/data/"<br/>dataSet="z.csv"<br/>infile=path+dataset<br/>#infile=”c:/temp/z.csv”<br/>x=pd.read_csv(infile,header=None)<br/>print(x.head())<br/>print((x[[1,1,2,3,4,5]] ==0).sum())</pre>
<p>The related output is shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-677 image-border" src="Images/140582de-3c76-48c3-947a-bfcb02099356.png" style="width:35.75em;height:19.50em;" width="603" height="329"/></div>
<p>At this stage, we just know that for the first five columns, zero represents a missing value. The code of <kbd>print((x[[1,2,3,4,5]] == 0).sum())</kbd> shows the number of zeros for five columns. For instance, there are five zeros for the first column. We could use <kbd>scipy.NaN</kbd> to replace those zeros, as shown here:</p>
<pre>x2=x<br/>x2[[1,2,3,4,5]] = x2[[1,2,3,4,5]].replace(0, sp.NaN)<br/>print(x2.head())</pre>
<p>The output with zeros is replaced with <kbd>sp.NaN</kbd>, as shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-678 image-border" src="Images/fd1d4f34-5969-4b55-8971-989f0c910a44.png" style="width:36.92em;height:15.92em;" width="607" height="262"/></div>
<p>If we plan to use the mean to replace those <kbd>NaN</kbd>s, we have the following code:</p>
<pre>x3=x2<br/>x3.fillna(x3.mean(), inplace=True)<br/>print(x3.head())</pre>
<p>The output is shown here:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-679 image-border" src="Images/88843bec-924a-4ce9-9ba0-4d39fcc46330.png" style="width:35.75em;height:15.58em;" width="603" height="263"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Data sorting</h1>
                </header>
            
            <article>
                
<p>In R, we have several ways to sort data. The easiest way is to use the <kbd>sort()</kbd> function (see the code for the simplest one-dimensional data):</p>
<pre>&gt; set.seed(123) 
&gt; x&lt;-rnorm(100) 
&gt; head(x) 
<strong>[1] -0.56047565 -0.23017749  1.55870831  0.07050839  0.12928774  1.71506499</strong> 
&gt; y&lt;-sort(x) 
&gt; head(y) 
<strong>[1] -2.309169 -1.966617 -1.686693 -1.548753 -1.265396 -1.265061</strong> </pre>
<p>Let's look at another way to sort data. The dataset used is called <kbd>nyseListing</kbd>, which is included in the R package called <kbd>fImport</kbd>, shown here:</p>
<pre>library(fImport) 
data(nyseListing) 
dim(nyseListing) 
head(nyseListing) </pre>
<p>The output is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-661 image-border" src="Images/95064081-0de2-49c6-a728-2b001d668452.png" style="width:31.08em;height:11.00em;" width="459" height="162"/></div>
<p>In total, we have <kbd>3,387</kbd> observations, each with <kbd>4</kbd> variables. The dataset is sorted by <kbd>Symbol</kbd>, as in the tickers of individual stocks. Assume that we want to sort them by <kbd>Name</kbd>, as shown here:</p>
<pre>&gt; x&lt;-nyseListing[order(nyseListing$Name),] 
&gt; head(x) </pre>
<p>The output shows that the dataset is indeed sorted by company <kbd>Name</kbd>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-662 image-border" src="Images/9ef74209-741e-4e13-9c80-81a3cdf650c0.png" style="width:32.92em;height:10.00em;" width="480" height="146"/></div>
<p>In the following example, we sort by <kbd>ID</kbd> first, then by <kbd>RET</kbd>:</p>
<pre>&gt; x&lt;-c(1,3,1, 0.1,0.3,-0.4,100,300,30) 
&gt; y&lt;-data.frame(matrix(x,3,3)) 
&gt; colnames(y)&lt;-c("ID","RET","Data1") 
&gt; y </pre>
<p>Our simple output dataset is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-663 image-border" src="Images/1a51c911-769d-4cfd-a6a4-185109c797fa.png" style="width:9.50em;height:6.00em;" width="132" height="83"/></div>
<p>To sort the data according to <kbd>ID</kbd> and <kbd>RET</kbd>, we could use <kbd>order(ID,RET)</kbd>, shown here:</p>
<pre>&gt; z&lt;-y[order(y$ID,y$RET),] 
&gt; z </pre>
<p>The following screenshot shows that the output dataset was sorted correctly:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-664 image-border" src="Images/637557cb-2dda-4b71-835c-cf4eea18af5e.png" style="width:8.92em;height:5.17em;" width="141" height="82"/></div>
<p>If we want to sort according to decreasing order, we could add <kbd>decreasing=TRUE</kbd>:</p>
<pre>&gt; z2&lt;-y[order(y$ID,decreasing = TRUE,y$RET),] 
&gt; z2 
<strong>  ID  RET Data1 
2  3  0.3   300 
1  1  0.1   100 
3  1 -0.4    30 </strong> </pre>
<p>To sort data in Python, see the following code:</p>
<pre>import pandas as pd 
a = pd.DataFrame([[8,3],[8,2],[1,-1]],columns=['X','Y']) 
print(a) 
# sort by A ascending, then B descending 
b= a.sort_values(['X', 'Y'], ascending=[1, 0]) 
print(b) 
# sort by A and B, both ascending 
c= a.sort_values(['X', 'Y'], ascending=[1, 1]) 
print(c)  </pre>
<p>The output is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-665 image-border" src="Images/e0a2ab0c-f7b4-4243-b924-bdade33694bc.png" style="width:3.67em;height:10.25em;" width="66" height="184"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Slicing and dicing datasets</h1>
                </header>
            
            <article>
                
<p>Our first example is to pick all stocks listed on the NYSE by using an R dataset called <kbd>marketCap.Rdata</kbd>, shown in the code here:</p>
<pre>&gt; con&lt;-url("http://canisius.edu/~yany/RData/marketCap.RData") 
&gt; load(con) 
&gt; head(.marketCap) </pre>
<p>The associated output is shown here:</p>
<pre>&gt; head(.marketCap) 
<strong>  Symbol                       Name MarketCap Exchange 
1      A Agilent Technologies, Inc. $12,852.3     NYSE 
2     AA                 Alcoa Inc. $28,234.5     NYSE 
3   AA-P                 Alcoa Inc.     $43.6     AMEX<br/></strong><strong>4    AAC       Ableauctions.Com Inc      $4.3     AMEX 
5    AAI     AirTran Holdings, Inc.    $156.9     NYSE 
6    AAP     Advance Auto Parts Inc  $3,507.4     NYSE</strong> </pre>
<p>We have various ways to choose a subset of the R dataset called <kbd>.marketCap</kbd>. Note that there is a dot in front of <kbd>.marketCap</kbd>:</p>
<pre>a&lt;-.marketCap[1]      # choose the 1st column  
b&lt;-.marketCap$SYMBOL  # another way to choose the 1st column  
c&lt;-.marketCap[,1:2]   # choose the first two columns  
d&lt;-subset(.marketCap,.marketCap$EXCHANGE=="NYSE") 
e&lt;-subset(head(.marketCap)) 
f&lt;-subset(.marketCap,.marketCap$MARKET&gt;200 &amp; .marketCap$MARKETCAP&lt;=3000) </pre>
<p>A Python dataset is downloadable at <a href="http://canisius.edu/~yany/python/marketCap.pkl">h<span class="URLPACKT">ttp://canisius.edu/~yany/python/marketCap.pkl</span></a>.</p>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Merging different datasets</h1>
                </header>
            
            <article>
                
<p>First, let's generate some hypothetical datasets. Then we will try to merge them according to certain rules. The easiest way is to use Monte Carlo simulation to generate those datasets:</p>
<pre>&gt; set.seed(123) 
&gt; nStocks&lt;-4 
&gt; nPeriods&lt;-24 
&gt; x&lt;-runif(nStocks*nPeriods,min=-0.1,max=0.20) 
&gt; a&lt;-matrix(x,nPeriods,nStocks) 
&gt; d1&lt;-as.Date("2000-01-01") 
&gt; d2&lt;-as.Date("2001-12-01") 
&gt; dd&lt;-seq(d1,d2,"months") 
&gt; stocks&lt;-data.frame(dd,a) 
&gt; colnames(stocks)&lt;-c("DATE",paste('stock',1:nStocks,sep=''))  </pre>
<p>In the code, the first line sets up a random seed which will guarantee that any user will get the same random numbers if he/she uses the same random seed. The <kbd>runif()</kbd> function is used to get random numbers from a uniform distribution. In a sense, the preceding code would generate 2-year returns for five stocks. The <kbd>dim()</kbd> and <kbd>head()</kbd> function can be used to see the dimensions of the dataset and its first couple of lines, as shown here:</p>
<pre>&gt; dim(stocks) 
<strong>[1] 24  5</strong> 
&gt; head(stocks) 
<strong>        DATE      stock1      stock2      stock3      stock4 
1 2000-01-01 -0.01372674  0.09671174 -0.02020821  0.11305472 
2 2000-02-01  0.13649154  0.11255914  0.15734831 -0.09981257 
3 2000-03-01  0.02269308  0.06321981 -0.08625065  0.04259497 
4 2000-04-01  0.16490522  0.07824261  0.03266002 -0.03396433 
5 2000-05-01  0.18214019 -0.01325208  0.13967745  0.01394496 
6 2000-06-01 -0.08633305 -0.05586591 -0.06343022  0.08383130 </strong> </pre>
<p>Similarly, we could get the market returns, shown in the code here:</p>
<pre>&gt; d3&lt;-as.Date("1999-01-01") 
&gt; d4&lt;-as.Date("2010-12-01") 
&gt; dd2&lt;-seq(d3,d4,"months") 
&gt; y&lt;-runif(length(dd2),min=-0.05,max=0.1) 
&gt; market&lt;-data.frame(dd2,y) 
&gt; colnames(market)&lt;-c("DATE","MKT") </pre>
<p>To make the merge more interesting, we deliberately make the market returns longer, shown here along with its dimensions and the first several lines:</p>
<pre>&gt; dim(market) 
<strong>[1] 144   2</strong> 
&gt; head(market,2) 
<strong>        DATE          MKT 
1 1999-01-01  0.047184022 
2 1999-02-01 -0.002026907</strong> </pre>
<p>To merge them, we have the following code:</p>
<pre>&gt; final&lt;-merge(stocks,market) 
&gt; dim(final) 
<strong>[1] 24  6</strong> 
&gt; head(final,2) 
<strong>        DATE      stock1     stock2      stock3      stock4        MKT 
1 2000-01-01 -0.01372674 0.09671174 -0.02020821  0.11305472 0.05094986 
2 2000-02-01  0.13649154 0.11255914  0.15734831 -0.09981257 0.06056166 </strong></pre>
<p>To find out more about the R <kbd>merge()</kbd> function, just type <kbd>help(merge)</kbd> and we can then specify inner merge, left-merge, right-merge, and out merge. The default setting in the previous case is called inner merge, as in picking up observations that only exist in both datasets.</p>
<p>The following Python program shows this concept clearly:</p>
<pre>import pandas as pd 
import scipy as sp 
x= pd.DataFrame({'YEAR': [2010,2011, 2012, 2013], 
                 'FirmA': [0.2, -0.3, 0.13, -0.2], 
                 'FirmB': [0.1, 0, 0.05, 0.23]}) 
y = pd.DataFrame({'YEAR': [2011,2013,2014, 2015], 
                 'FirmC': [0.12, 0.23, 0.11, -0.1], 
                 'SP500': [0.1,0.17, -0.05, 0.13]}) 
 
print("n  inner  merge ") 
print(pd.merge(x,y, on='YEAR')) 
print(" n  outer merge  ") 
print(pd.merge(x,y, on='YEAR',how='outer')) 
print("n  left  merge  ") 
print(pd.merge(x,y, on='YEAR',how='left')) 
print("n  right  merge ") 
print(pd.merge(x,y, on='YEAR',how='right')) </pre>
<p>The related output is shown here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-666 image-border" src="Images/5bb67bd0-c2df-42c7-83d0-4fc7ff12963d.png" style="width:19.50em;height:29.33em;" width="282" height="424"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Data output</h1>
                </header>
            
            <article>
                
<p>In the previous section, by using the R language, we generated a data asset called <kbd>final</kbd>. To save it to a CSV file, we could use the <kbd>write.csv()</kbd> or <kbd>write.table()</kbd> functions, shown in the code here:</p>
<pre>&gt; write.csv(final,file="c:/temp/t.csv") 
&gt; write.table(final,file="c:/temp/t2.txt",sep=";") </pre>
<p>The separator for the <kbd>write.csv()</kbd> function is a comma, while we can specify our own separator for the <kbd>write.table()</kbd> function. To find out the other R functions starting with <kbd>write</kbd>, we could use the <kbd>apropos()</kbd> function, shown here:</p>
<pre>&gt; apropos("^write") 
<strong> [1] "write"          "write.csv"      "write.csv2"     
 [4] "write.dcf"      "write.ftable"   "write.socket"   
 [7] "write.table"    "writeBin"       "writeChar"      
[10] "writeClipboard" "writeLines" </strong>    </pre>
<p>For the following Python program, we export Fama-French monthly factors to three different output formats, pickle, CSV, and text files:</p>
<pre>import pandas as pd 
infile="http://canisius.edu/~yany/data/ff3monthly.csv" 
ff3=pd.read_csv(infile,skiprows=3) 
print(ff3.head(2)) 
# output to pickle 
ff3.to_pickle("c:/temp/ff3.pkl") 
# output to a csv file  
outfile=open("c:/temp/ff3.csv","w") 
ff3.to_csv(outfile,index=None) 
outfile.close() 
# output to text file 
outfile2=open("c:/temp/ff3.txt","w") 
ff3.to_csv(outfile2, header=True, index=None, sep=' ', mode='a') 
outfile2.close() </pre>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the cbsodata Python package</h1>
                </header>
            
            <article>
                
<p>To install the <kbd>cbsodata</kbd> Python package, perform the following steps:</p>
<ol>
<li>We can use one of the following commands:</li>
</ol>
<pre style="padding-left: 90px">conda install cbsodata 
pip install cbsodata </pre>
<p style="padding-left: 60px">For more detailed instructions about how to install the Python package, please see <a href="c812a40e-eb24-4bb8-8af5-1cfe1834ec77.xhtml" target="_blank">Chapter 6</a>, <em>Managing Packages</em>:</p>
<ol start="2">
<li>The next program shows one example of using the package:</li>
</ol>
<pre style="padding-left: 90px">import pandas as pd 
import cbsodata as cb 
name='82070ENG' 
data = pd.DataFrame(cb.get_data(name)) 
print(data.head()) 
info=cb.get_info(name) 
print(info['Title']) </pre>
<ol start="3">
<li>The corresponding output is shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-667 image-border" src="Images/fde9f01d-fefc-452a-b70f-ad7d69f6fd64.png" style="width:36.75em;height:25.25em;" width="523" height="359"/></div>
<p style="padding-left: 60px">The last line in the screenshot gives the name of the dataset. In the previous example, we used the dataset with the name <kbd>82070ENG</kbd>.</p>
<ol start="4">
<li>To find out all the names of lists, we use the <kbd>get_table_list()</kbd> function; see the following code:</li>
</ol>
<pre style="padding-left: 90px">import cbsodata as cb 
list=cb.get_table_list() 
print(list) </pre>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the datadotworld Python package</h1>
                </header>
            
            <article>
                
<p>To install the <kbd>datadotworld</kbd> Python package, follow these steps:</p>
<ol>
<li>First, we have to install the package. To do so, we could try one of the following lines:</li>
</ol>
<pre style="padding-left: 90px">conda install datadotworld 
pip install datadotworld </pre>
<ol start="2">
<li>After the package is successfully installed, we can use the <kbd>dir()</kbd> function to list all its functions, as shown in this screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-668 image-border" src="Images/25a19cd1-b50f-4874-82d9-3f4988eab715.png" style="width:61.92em;height:11.25em;" width="743" height="135"/></div>
<ol start="3">
<li>A user has to get an APK token at <a href="https://data.world/settings/advaned"><span class="URLPACKT">https://data.world/settings/advaned</span></a> in order to run a Python program. Without such a token, we might get the following error message if we run a <kbd>datadotworld</kbd> function:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-669 image-border" src="Images/3ea234b5-69f9-4596-91fc-231c81930ef4.png" style="width:49.17em;height:3.67em;" width="689" height="51"/></div>
<ol start="4">
<li>According to the error message, we must run the following configure command:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-670 image-border" src="Images/fca01243-dd8c-4d98-b2d2-5aa81962e6d8.png" style="width:51.67em;height:3.83em;" width="665" height="49"/></div>
<ol start="5">
<li>Now we can use the Python package as shown in the following Python program:</li>
</ol>
<pre style="padding-left: 90px">import datadotworld as dw 
name='jonloyens/an-intro-to-dataworld-dataset' 
results = dw.query(name, 
    'SELECT * FROM `DataDotWorldBBallStats`, `DataDotWorldBBallTeam` ' 
    'WHERE DataDotWorldBBallTeam.Name = DataDotWorldBBallStats.Name') 
df = results.dataframe 
print(df) </pre>
<ol start="6">
<li>The related output is shown here:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-671 image-border" src="Images/637c8877-b3e3-4edb-abac-8ff37216cacd.png" style="width:33.67em;height:21.58em;" width="461" height="295"/></div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the haven and foreign R packages</h1>
                </header>
            
            <article>
                
<p>The R package called <kbd>haven</kbd> is for import and export from SPSS, Stata and SAS files. The package is for<strong> Labelled Data Utility Functions</strong>, which is a collection of many small functions dealing with labelled data, such as reading and writing data between R and other statistical software packages such as <kbd>SAS</kbd>, <kbd>SPSS</kbd>, or <kbd>Stata</kbd>, and working with labelled data.</p>
<p>This includes easy ways to get, set, and change value and variable label attributes, convert labelled vectors into factors or numeric values (and vice versa), and deal with multiple declared missing values. The following example is about writing several specific outputs:</p>
<pre>library(haven)<br/>x&lt;-1:100<br/>y&lt;-matrix(x,50,2)<br/>z&lt;-data.frame(y)<br/>colnames(z)&lt;-c("a","b")<br/>write_sas(z,"c:/temp/tt.sas7bdat")<br/>write_spss(z,"c:/temp/tt.sav")<br/>write_stata(z,"c:/temp/tt.dta")</pre>
<p>Another R package called <kbd>foreign</kbd> can be used to read SPSS, and SAS data. Here is one example. First, let's download a SPSS dataset called <kbd>airline_passanges.sav</kbd> at <a href="http://calcnet.mth.cmich.edu/org/spss/Prj_airlinePassengers.htm">http://calcnet.mth.cmich.edu/org/spss/Prj_airlinePassengers.htm</a>. Assume that the related SPCC data is saved under <kbd>c:/temp</kbd>:</p>
<pre>library(foreign) 
x&lt;-read.spss("c:/temp/airline_passengers.sav", to.data.frame=TRUE) 
dim(x) 
<strong>[1] 144   1</strong> </pre>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the dslabs R package</h1>
                </header>
            
            <article>
                
<p>The <kbd>dslabs</kbd> R package is short for <strong>Data Science Labs</strong>. The package includes several datasets, such as the dataset called <kbd>murders</kbd> for US gun murders by state for 2010:</p>
<pre>&gt; library(dslabs) 
&gt; data(murders) 
&gt; head(murders) 
<strong>       state abb region population total 
1    Alabama  AL  South    4779736   135 
2     Alaska  AK   West     710231    19 
3    Arizona  AZ   West    6392017   232 
4   Arkansas  AR  South    2915918    93 
5 California  CA   West   37253956  1257 
6   Colorado  CO   West    5029196    65</strong> </pre>
<p>The following table shows the datasets included in the package:</p>
<table style="border-collapse: collapse;width: 100%" class="table" border="1">
<tbody>
<tr>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Name of dataset</strong></div>
</td>
<td>
<div class="CDPAlignCenter CDPAlign"><strong>Description</strong></div>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/admissions.html">admissions</a></p>
</td>
<td>
<p>Gender bias among graduate school admissions to UC Berkeley</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/divorce_margarine.html">divorce_margarine</a></p>
</td>
<td>
<p>Divorce rate and margarine consumption data</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/ds_theme_set.html">ds_theme_set</a></p>
</td>
<td>
<p>dslabs theme set</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/gapminder.html">gapminder</a></p>
</td>
<td>
<p>Gapminder data</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/heights.html">heights</a></p>
</td>
<td>
<p>Self-Reported heights</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/murders.html">murders</a></p>
</td>
<td>
<p>US gun murders by state for 2010</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/na_example.html">na_example</a></p>
</td>
<td>
<p>Count data with some missing values</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/gapminder.html">oecd</a></p>
</td>
<td>
<p>Gapminder data</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/gapminder.html">opec</a></p>
</td>
<td>
<p>Gapminder data</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/outlier_example.html">outlier_example</a></p>
</td>
<td>
<p>Adult male heights in feet with outliers</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/polls_us_election_2016.html">polls_us_election_2016</a></p>
</td>
<td>
<p>Fivethirtyeight 2016 poll data</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/research_funding_rates.html">raw_data_research_funding_rates</a></p>
</td>
<td>
<p>Gender bias in research funding in the Netherlands</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/reported_heights.html">reported_heights</a></p>
</td>
<td>
<p>Self-reported Heights</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/research_funding_rates.html">research_funding_rates</a></p>
</td>
<td>
<p>Gender bias in research funding in the Netherlands</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/polls_us_election_2016.html">results_us_election_2016</a></p>
</td>
<td>
<p>Fivethirtyeight 2016 poll fata</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/rfalling_object.html">rfalling_object</a></p>
</td>
<td>
<p>Simulated falling object data</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/take_poll.html">take_poll</a></p>
</td>
<td>
<p>Models results from taking a poll</p>
</td>
</tr>
<tr>
<td>
<p><a href="http://127.0.0.1:23636/library/dslabs/html/us_contagious_diseases.html">us_contagious_diseases</a></p>
</td>
<td>
<p>Contagious disease data for US states</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Table 3.8 Datasets included in the R package called dslabs</div>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Generating Python datasets</h1>
                </header>
            
            <article>
                
<p>To generate a Python dataset, we use the <kbd>Pandas to_pickle</kbd> functionality. The dataset we plan to use is called <kbd>adult.pkl</kbd>, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-672 image-border" src="Images/4103314a-8b1a-4e19-8957-b36c8bb097da.png" style="width:45.25em;height:22.92em;" width="644" height="326"/></div>
<p>The related Python code is given here:</p>
<pre>import pandas as pd 
path="http://archive.ics.uci.edu/ml/machine-learning-databases/" 
dataSet="adult/adult.data" 
inFile=path+dataSet 
x=pd.read_csv(inFile,header=None) 
adult=pd.DataFrame(x,index=None) 
adult= adult.rename(columns={0:'age',1: 'workclass', 
2:'fnlwgt',3:'education',4:'education-num', 
5:'marital-status',6:'occupation',7:'relationship', 
8:'race',9:'sex',10:'capital-gain',11:'capital-loss', 
12:'hours-per-week',13:'native-country',14:'class'}) 
adult.to_pickle("c:/temp/adult.pkl") </pre>
<p>To show the first several lines of observations, we use the <kbd>x.head()</kbd> functionality, shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-673 image-border" src="Images/5d80694f-a4d1-4b52-bedc-00ec3403ce5f.png" style="width:39.08em;height:24.75em;" width="548" height="347"/></div>
<p>Note that the backup dataset is available at the author's website, downloadable at <a href="http://canisius.edu/~yany/data/adult.data.txt"><span class="URLPACKT">http://canisius.edu/~yany/data/adult.data.txt</span></a>.</p>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Generating R datasets</h1>
                </header>
            
            <article>
                
<p>Here, we show you how to generate an R dataset called <kbd>iris.RData</kbd> by using the R <kbd>save()</kbd> function:</p>
<pre>path&lt;-"http://archive.ics.uci.edu/ml/machine-learning-databases/" 
dataSet&lt;-"iris/bezdekIris.data" 
a&lt;-paste(path,dataSet,sep='') 
.iris&lt;-read.csv(a,header=F) 
colnames(.iris)&lt;-c("sepalLength","sepalWidth","petalLength","petalWidth","Class") 
save(iris,file="c:/temp/iris.RData") </pre>
<p>To upload the function, we use the <kbd>load()</kbd> function:</p>
<pre>&gt;load("c:/temp/iris.RData") 
&gt; head(.iris) 
<strong>  sepalLength sepalWidth petalLength petalWidth       Class 
1         5.1        3.5         1.4        0.2 Iris-setosa 
2         4.9        3.0         1.4        0.2 Iris-setosa 
3         4.7        3.2         1.3        0.2 Iris-setosa 
4         4.6        3.1         1.5        0.2 Iris-setosa 
5         5.0        3.6         1.4        0.2 Iris-setosa 
6         5.4        3.9         1.7        0.4 Iris-setosa</strong> </pre>
<p>Note that the extension of <kbd>.RData</kbd> is not critical. The second way to save R data is to apply an R function called <kbd>saveRDS()</kbd>, shown in the code here:</p>
<pre>inFile&lt;-"http://canisius.edu/~yany/data/ff3monthly.csv" <br/>ff3monthly&lt;-read.csv(inFile,skip=3)
saveRDS(ff3monthly,file="c:/temp/ff3monthly.rds") </pre>
<p>The corresponding function to load the dataset is called <kbd>readRDS()</kbd>. Another important property when using the rds dataset is that we can assign another more convenient name, shown in the code that follows. In this case, we call it <kbd>abc</kbd> instead of <kbd>ff3monthly</kbd>:</p>
<pre>&gt;abc&lt;-readRDS("c:/temp/ff3monthly.rds") 
&gt;head(abc,3) 
<strong>        DATE MKT_RF     SMB     HML     RF 
1 1926-07-01 0.0296 -0.0230 -0.0287 0.0022 
2 1926-08-01 0.0264 -0.0140  0.0419 0.0025 
3 1926-09-01 0.0036 -0.0132  0.0001 0.0023</strong> 
&gt;head(ff3monthly,3) 
<strong>        DATE MKT_RF     SMB     HML     RF 
1 1926-07-01 0.0296 -0.0230 -0.0287 0.0022 
2 1926-08-01 0.0264 -0.0140  0.0419 0.0025 
3 1926-09-01 0.0036 -0.0132  0.0001 0.0023</strong> </pre>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we first discussed sources of open data, which included The Bureau of Labor Statistics, the Census Bureau, Professor French's data library, the Federal Reserve's data library, and the UCI Machine Learning Depository. After that, we showed you how to input data; how to deal with missing data; how to sort, slice, and dice the datasets; and how to merge different datasets. Data output was discussed in detail. For different languages, such as Python, R, and Julia, several relevant packages for data manipulation were introduced and discussed.</p>
<p>In <a href="fa744362-086d-4d82-9e32-5733918d1d38.xhtml" target="_blank">Chapter 4</a>, <em>Data Visualization</em>, we will discuss data visualization in R, Python, and Julia separately. To make our visual presentation more eye catching, we will show how you to generate simple graphs and bar charts, as well as how to add trend lines and legends. Other explanations will include how to save graphs to an external file, and we will discuss several packages related to data visualization in R, Python, and Julia.</p>


            </article>

            
        </section>
    </div>
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Review questions and exercises</h1>
                </header>
            
            <article>
                
<ol>
<li>What is the difference between open data and proprietary databases?</li>
<li>Is it enough for learners in the area of data science to use open data?</li>
<li>Where can we access open public data?</li>
<li>From The UCI Data Depository, <a href="http://archive.ics.uci.edu/ml/index.php"><span class="URLPACKT">http://archive.ics.uci.edu/ml/index.php</span></a>, download a dataset called <kbd>Wine</kbd>. Write a program in R to import it.</li>
<li>From the UCI Data Depository, download a dataset called <kbd>Forest Fire</kbd>. Write a program in Python to import it.</li>
<li>From the UCI Data Depository, download a dataset called <kbd>Bank Marketing</kbd>. Write a program in Octave to import it. Answer the following questions: 1) How many banks? and 2) What is the cost?</li>
<li>How can we find all R functions with <kbd>read.</kbd> as their leading letters? (Note that there is a dot after <kbd>read.</kbd>)</li>
<li>How can we find more information on an R function called <kbd>read.xls()</kbd>?</li>
<li>Explain the differences between two R functions: <kbd>save()</kbd> and <kbd>saveRDS()</kbd>.</li>
<li>Find more information about the <kbd>read_clipboard()</kbd> function included in the Python pandas package.</li>
</ol>
<p> </p>
<ol start="11">
<li>What is the Quandl platform? What kinds of data could we download from Quandl?</li>
<li>Write both R and Python programs to download GDP (Gross Domestic Product) data from the Quandl platform.</li>
<li>When loading an R dataset, what is the difference between using the <kbd>load()</kbd> function and the <kbd>readRDS()</kbd> function?</li>
<li>After uploading the Python pandas package, explain why we have the following error message:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-674 image-border" src="Images/b5fb4549-6c1d-4469-92fb-c2a78eb33378.png" style="width:32.50em;height:10.67em;" width="437" height="143"/></div>
<ol start="15">
<li>First, download a ZIP file called <kbd>bank-fall.zip</kbd> at <a href="http://archive.ics.uci.edu/ml/datasets/Bank+Marketing"><span class="URLPACKT">http://archive.ics.uci.edu/ml/datasets/Bank+Marketing</span></a>. Unzip the file to get a CSV file; see the related code that follows:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-675 image-border" src="Images/e347f686-a7b8-4809-874f-1babfb9ae8ae.png" style="width:47.50em;height:12.25em;" width="679" height="175"/></div>
<p style="padding-left: 60px">Generate an R dataset called <kbd>bank.Rata</kbd> and <kbd>bank.rds</kbd> and answer the following questions: a) What is the average age? b) What percentage of people are married? c) Is the default probability of those who are married higher than those who are single?</p>
<ol start="16">
<li>How do we merge two datasets in R?</li>
<li>Write a Python program to download IBM's daily data from Quandl and merge it with Fama-French three-factor. To get a Fama-French daily factor time series we could go to <a href="http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html"><span class="URLPACKT">http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html</span></a> or download a dataset at <a href="http://canisius.edu/~yany/python/data/ffDaily.pkl">http://canisius.edu/~yany/python/data/ffDaily.pkl</a>.<a href="http://canisius.edu/~yany/python/data/ffDaily.pkl"/></li>
<li>Generate both R and Python datasets for monthly Fama-French-Charhart four factors. Both time series, can be downloaded from Professor French's data library.</li>
<li>Write a Python program to merge FRED/GDP data with market index data.</li>
</ol>
<p> </p>


            </article>

            
        </section>
    </div></body></html>
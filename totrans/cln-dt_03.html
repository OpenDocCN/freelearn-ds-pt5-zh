<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Workhorses of Clean Data &#x2013; Spreadsheets and Text Editors"><div class="titlepage" id="aid-MSDG2"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Workhorses of Clean Data – Spreadsheets and Text Editors</h1></div></div></div><p>When designing a home kitchen, the typical layout invokes the classic work triangle, the points of which are the refrigerator, sink, and stove. In our Clean Data kitchen, we have a few <a id="id179" class="indexterm"/>indispensible devices as well. Two of these are the humble<a id="id180" class="indexterm"/> <span class="strong"><strong>spreadsheet</strong></span> and the <span class="strong"><strong>text editor</strong></span>. Although these unpretentious tools are often overlooked, full knowledge of their features can make many cleaning tasks quicker and easier. In <a class="link" title="Chapter 2. Fundamentals – Formats, Types, and Encodings" href="part0020.xhtml#aid-J2B82">Chapter 2</a>, <span class="emphasis"><em>Fundamentals – Formats, Types, and Encodings</em></span>, we briefly introduced these two tools in the context of learning about data types and file types, but in this chapter, we are ready to dig deeper into:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Useful functions in Excel and Google Spreadsheets that can help us manipulate data, including text to columns, splitting and concatenating strings, searching and formatting to find unusual values, sorting, importing spreadsheet data into MySQL, and even generating SQL using a spreadsheet</li><li class="listitem">Typical features of a text editor that can automatically extract and manipulate data into a more useful format, including searching and replacing with regular expressions, altering line beginnings and endings, and column-based editing</li><li class="listitem">A small project where we use features of both of these tools to clean some real-world data</li></ul></div><div class="section" title="Spreadsheet data cleaning"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec18"/>Spreadsheet data cleaning</h1></div></div></div><p>The <a id="id181" class="indexterm"/>utility of the spreadsheet for data cleaning comes from two things: its ability to organize data into columns and rows and its suite of built-in functions. In this section, we will learn how to use the spreadsheet to its fullest in our quest for clean data.</p><div class="section" title="Text to columns in Excel"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>Text to columns in Excel</h2></div></div></div><p>As <a id="id182" class="indexterm"/>spreadsheets are designed to hold data in columns and rows, one of the first cleaning tasks we might need to do is arrange our data accordingly. For instance, if you paste a large amount of data into Excel or Google Spreadsheets, the software will first try to look for a delimiter (such as a comma or tab) and divide the data into columns that way. (Refer to <a class="link" title="Chapter 2. Fundamentals – Formats, Types, and Encodings" href="part0020.xhtml#aid-J2B82">Chapter 2</a>, <span class="emphasis"><em>Fundamentals – Formats, Types, and Encodings</em></span>, for a review of delimited data.) Sometimes, the spreadsheet software will not find a delimiter, so we will have to provide it more guidance about how to divide the data into columns. Consider the following snippet of text from a list of several thousand Internet Relay Chat channel topics on Freenode:</p><div class="informalexample"><pre class="programlisting">[2014-09-19 14:10:47] === #eurovision   4   Congratulations to Austria, winner of the Eurovision Song Contest 2014!
[2014-09-19 14:10:47] === #tinkerforge   3
[2014-09-19 14:10:47] === ##new   3   Welcome to ##NEW</pre></div><div class="note" title="Note"><h3 class="title"><a id="note07"/>Note</h3><p>To generate a list of channels and their topics in an IRC chat server, use the <code class="literal">alis</code> command, which can be sent as part of either <code class="literal">/query</code> or <code class="literal">/msg</code>, depending on your server's settings. On Freenode, the <code class="literal">/msg alis *</code> command will generate<a id="id183" class="indexterm"/> a list of channels. More information on IRC chat can be found here: <a class="ulink" href="https://freenode.net/services.shtml">https://freenode.net/services.shtml</a></p></div><p>We can see with our human eyes that the first chunk of data is a timestamp, followed by <code class="literal">===</code>, <code class="literal">#</code> and a channel name, a number (the count of users on the channel at the moment the list was constructed), and a description of the channel. However, if we paste these lines into Excel or Google Spreadsheets, it is unable to automatically make the same observations about what columns should be. The rows are detected correctly by the spreadsheet, but the delimiting is too inconsistent for columns to be detected automatically. How the data looks when pasted into Google Spreadsheets is given in the following image. By highlighting cell A1, we can see that the entire line is shown in the formula bar, indicating that the entire row has been pasted into cell A1:</p><div class="mediaobject"><img src="../Images/image00247.jpeg" alt="Text to columns in Excel"/></div><p style="clear:both; height: 1em;"> </p><p>How can we easily create columns from this data in the spreadsheet? We would like each separate data item to be in its own column. By doing this, we will be able to, for example, take an average of the number of users on the channels or sort the data by the channel names. Right now, we cannot easily sort or use formulas on this data as it is all in one giant text string.</p><p>One <a id="id184" class="indexterm"/>strategy will be to use Excel's text-to-columns wizard to split the data into recognizable chunks; then, we can reassemble them and strip out extra characters if needed. This is shown in the steps mentioned as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Highlight column <code class="literal">A</code>, and launch the text-to-columns wizard (located in the Data menu). In step 1, choose a fixed width, and in step 2, double-click on all the lines that have been drawn to delimit the description field. The following figure shows you how the data should look after delimiting the first few columns and removing all the extra lines:<div class="mediaobject"><img src="../Images/image00248.jpeg" alt="Text to columns in Excel"/><div class="caption"><p>Fixed-width splitting in Excel.</p></div></div><p style="clear:both; height: 1em;"> </p><p>The resulting data looks like the following figure. The first three columns are good, but the fixed-width delimiting did not work to separate the count of users and channel names in column D. This happened because the channel names are not as predictable in length as the previous columns.</p><div class="mediaobject"><img src="../Images/image00249.jpeg" alt="Text to columns in Excel"/></div><p style="clear:both; height: 1em;"> </p><p>This is the result after the first round of text-to-columns splitting.</p></li><li class="listitem">We will have to run text-to-columns again but just on column D this time, and we will use delimited instead of fixed-width procedure. First, note that there<a id="id185" class="indexterm"/> are two spaces between the channel name <span class="strong"><strong>#eurovision</strong></span> and the number of users (<span class="strong"><strong>4</strong></span>) and two spaces again between <span class="strong"><strong>4</strong></span> and the channel description. Even though text-to-columns does not allow us to type two spaces as a delimiter (it allows single characters only), we can use the <span class="strong"><strong>Find-Replace</strong></span> dialogue to replace all cases of two spaces with a symbol that is not used anywhere else in our text. (Perform a <span class="strong"><strong>Find</strong></span> operation first to make sure.) I chose a <code class="literal">^</code> symbol.<p>This particular step seems a little sloppy, so if you are interested in an alternate approach, I do not blame you one bit. Excel is more limited than other tools in its ability to find and replace bad text. We will learn how to use regular expressions in the <span class="emphasis"><em>Text editor data cleaning</em></span> section later in this chapter.</p><div class="mediaobject"><img src="../Images/image00250.jpeg" alt="Text to columns in Excel"/></div><p style="clear:both; height: 1em;"> </p><p>Adding an unusual delimiting character allows us to split apart the remaining columns.</p></li><li class="listitem">Now, use <span class="strong"><strong>Find-Replace</strong></span> to remove the <code class="literal">[</code> and <code class="literal">]</code> characters from columns A and B, replacing them with nothing. (Highlight these columns before starting find-replace so that you do not accidentally remove symbols throughout the whole sheet.)<p>Unfortunately, Excel, in its eternal quest to try to help us, turns these into dates formatted in a way we might not like: 9/19/2014. If you want these to go back to the way they were (2014-09-19), select the entire column and use the custom format dialogue to specify the date format as yyyy-mm-dd.</p></li><li class="listitem">The <a id="id186" class="indexterm"/>strings in column <span class="strong"><strong>F</strong></span> still have extra space at the beginning. We can strip the extra spaces<a id="id187" class="indexterm"/> from the front of each string value using the <code class="literal">trim()</code> function. Insert a new column to the left of <span class="strong"><strong>F</strong></span>, and apply the <code class="literal">trim()</code> function, shown as follows:<div class="mediaobject"><img src="../Images/image00251.jpeg" alt="Text to columns in Excel"/></div><p style="clear:both; height: 1em;"> </p><p>This is the result of applying the <code class="literal">trim()</code> function to strip out leading or trailing spaces.</p></li><li class="listitem">We can also apply the <code class="literal">clean()</code> function to the trimmed text. This will remove any of the first 32 ASCII characters: all non-printing control characters that may have somehow made their way into these channel descriptions. You can apply <code class="literal">clean()</code> outside <code class="literal">trim()</code> functions like this: <code class="literal">clean(trim(g1))</code>.</li><li class="listitem">Drag the corner of the F1 box down to apply <code class="literal">clean(trim())</code> to the rest of the cells in column <span class="strong"><strong>F</strong></span>.</li><li class="listitem">Select column <span class="strong"><strong>F</strong></span>, copy it, and use <span class="strong"><strong>Paste Special Values Only</strong></span> in column <span class="strong"><strong>F</strong></span> so that we can delete column <span class="strong"><strong>G</strong></span>.</li><li class="listitem">Delete column <span class="strong"><strong>G</strong></span>. Voila, now you have perfectly cleaned data.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Splitting strings"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>Splitting strings</h2></div></div></div><p>A lightweight <a id="id188" class="indexterm"/>version of the text to columns feature, available in Google Spreadsheets but not in Excel, is the <code class="literal">split()</code> function. This function just takes a string value and splits it into its component pieces. Be aware that you need to provide enough new columns for the newly split data to fit into. In the following example, we have used the same data as the previous example but created three new columns to hold the split values from <span class="strong"><strong>D</strong></span>.</p><div class="mediaobject"><img src="../Images/image00252.jpeg" alt="Splitting strings"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Concatenating strings"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec19"/>Concatenating strings</h2></div></div></div><p>The <code class="literal">concatenate()</code> function takes a number of strings, either as cell references or as quoted <a id="id189" class="indexterm"/>strings, and attaches them<a id="id190" class="indexterm"/> together inside a new cell. In the following example, we use the <code class="literal">concatenate()</code> function to join the date and time strings into one. This function is available in both Excel and Google Spreadsheets, as shown in the following figure:</p><div class="mediaobject"><img src="../Images/image00253.jpeg" alt="Concatenating strings"/></div><p style="clear:both; height: 1em;"> </p><div class="section" title="Conditional formatting to find unusual values"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec25"/>Conditional formatting to find unusual values</h3></div></div></div><p>Both<a id="id191" class="indexterm"/> Excel and Google spreadsheets have <span class="strong"><strong>conditional formatting</strong></span> features. Conditional formatting uses a set of rules to change the appearance (format) of a cell or cells depending on whether some criteria are met (condition). We can use this to find data that is too high, too low, missing, or otherwise strange. Once we have identified it, we can clean it.</p><p>Here<a id="id192" class="indexterm"/> is an example of how to use conditional formatting in Google Spreadsheets to find a row in our sample data that does not include <code class="literal">#</code> in the channel name and has an empty value for the number of chat participants:</p><div class="mediaobject"><img src="../Images/image00254.jpeg" alt="Conditional formatting to find unusual values"/></div><p style="clear:both; height: 1em;"> </p><p>Here is the result after the background cell colors have been changed to locate cells in <span class="strong"><strong>D</strong></span> that do not start with <code class="literal">#</code> and cells in <span class="strong"><strong>E</strong></span> that are empty. Now these problem values can be found easily with a visual inspection.</p><div class="mediaobject"><img src="../Images/image00255.jpeg" alt="Conditional formatting to find unusual values"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Sorting to find unusual values"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec26"/>Sorting to find unusual values</h3></div></div></div><p>If there<a id="id193" class="indexterm"/> is too much data for a visual inspection, then we could try to employ sorting to find the troublesome data. In either Google Spreadsheets or Excel, select the columns you want to sort, which can be the entire sheet, and use the <span class="strong"><strong>Sort</strong></span> option in the <span class="strong"><strong>Data</strong></span> menu. This works fairly easily for most of the columns, especially if you are looking for data like cell D4.</p><p>But what happens if you try to sort by column <span class="strong"><strong>E</strong></span> in order to find that missing value? Maybe we would like to put all the missing data together so that we can delete these rows of data. The value for E4 is empty. Remember from <a class="link" title="Chapter 2. Fundamentals – Formats, Types, and Encodings" href="part0020.xhtml#aid-J2B82">Chapter 2</a>, <span class="emphasis"><em>Fundamentals – Formats, Types, and Encodings</em></span>, that NULL (empty in Google Spreadsheets parlance) cannot be compared to any other value, so it remains at the bottom of the sorted list no matter <a id="id194" class="indexterm"/>whether you sort the values in column <span class="strong"><strong>E</strong></span> from low to high or high to low.</p></div><div class="section" title="Importing spreadsheet data into MySQL"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec27"/>Importing spreadsheet data into MySQL</h3></div></div></div><p>Now <a id="id195" class="indexterm"/>that you have a lovely spreadsheet full of clean data, you might wish to store it in a database for the long term.</p><div class="section" title="Creating CSV from a spreadsheet"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec20"/>Creating CSV from a spreadsheet</h4></div></div></div><p>Many<a id="id196" class="indexterm"/> database systems will accept data via an import routine built around CSV files. If you are using MySQL, there is a <code class="literal">LOAD DATA IN FILE</code> command that will slurp data right into the database from a delimited file, and you can even set your own delimiter. First, let's take a look at an example of the command, and then we can create the file in Excel according to the parameters we want.</p><p>From the MySQL command line, we can run:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>load data local infile 'myFile.csv' </strong></span>
<span class="strong"><strong>  into table freenode_topics</strong></span>
<span class="strong"><strong>  fields terminated by ','</strong></span>
<span class="strong"><strong>  (dateOfTopic, channel, numUsers, message);</strong></span>
</pre></div><p>This, of course, assumes that a table has already been created. In this case, it is called <code class="literal">freenode_topics</code>, and it has four columns in it, which appear on the last line of this SQL query.</p><p>The CSV file referenced in this query, <code class="literal">myFile.csv</code>, will therefore need to have the columns in this order and separated by commas.</p><p>In Excel, a CSV can be created from the current sheet in a workbook by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save As</strong></span> and then choosing <span class="strong"><strong>CSV (MS-DOS)</strong></span> from the list of format options. In Google Spreadsheets, you can accomplish the same thing by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Downloads</strong></span> | <span class="strong"><strong>CSV</strong></span>. In both cases, save the file to your local system and then launch the MySQL client and proceed through the command line shown previously.</p><div class="note" title="Note"><h3 class="title"><a id="tip11"/>Tip</h3><p>If you do not like using the MySQL command-line client, CSV files can also be uploaded to a server using MySQL's own Workbench graphical client or using a tool like PhpMyAdmin. PhpMyAdmin does have a size limit on the upload file (currently, 2 MB).</p></div></div><div class="section" title="Generating SQL using a spreadsheet"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec21"/>Generating SQL using a spreadsheet</h4></div></div></div><p>Another<a id="id197" class="indexterm"/> way to get data into a database seems strange at first, but it can be a real timesaver if you are unable—for whatever reason, maybe because of the wrong permissions or because of file size limits—to load it via the CSV discussed previously. In this method, we will build <code class="literal">INSERT</code> statements inside the spreadsheet itself and then run these commands in the database.</p><p>If each column in the spreadsheet represents a column in the database, then we can simply <a id="id198" class="indexterm"/>add the structural components of a SQL <code class="literal">INSERT</code> command (quoted strings, parenthesis, commands, and line-terminating semicolons) around the columns in the spreadsheet and concatenate the result together into a giant string of <code class="literal">INSERT</code> commands.</p><div class="mediaobject"><img src="../Images/image00256.jpeg" alt="Generating SQL using a spreadsheet"/></div><p style="clear:both; height: 1em;"> </p><p>After using the <code class="literal">concatenate(A1:I1)</code> function to attach all the strings in columns A:I, we end up with <code class="literal">INSERT</code> statements that look like this:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>INSERT INTO freenode_topics (dateOfTopic, channel, num_users, message) VALUES('2014-09-19 14:10:47', '#eurovision',4, 'Congratulations to Austria, winner of the Eurovision Song Contest 2014!');</strong></span>
</pre></div><p>These can be pasted into a user-friendly frontend, such as PhpMyAdmin or MySQL Workbench. Or, you can save this as a text file (using your text editor), one <code class="literal">INSERT</code> statement after the other. I called my file <code class="literal">inserts.sql</code>. This file can now be imported into the database using the command line and MySQL client, as follows:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$mysql -uusername -p -hhostname databasename &lt; inserts.sql</strong></span>
</pre></div><p>Or, it can be imported using the <code class="literal">source</code> command in the MySQL command-line client like this:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$mysql -uusername -p -hhostname</strong></span>
<span class="strong"><strong>[enter your password]</strong></span>
<span class="strong"><strong>&gt; use databasename;</strong></span>
<span class="strong"><strong>&gt; source inserts.sql</strong></span>
</pre></div><p>Either one of these will work to get the data into MySQL. If the script is small enough, you can also use one of the graphical clients, such as MySQL Workbench. Be careful of loading very large scripts into the graphical client, however, as the amount of memory on your client machine may not be sufficient to load hundreds of gigabytes of SQL. I prefer the second method (<code class="literal">source</code>) because it prints out a success message following each successful insert, so I know my commands are good.</p><p>If you are a little unclear about how you would go about creating a text file called <code class="literal">inserts.sql</code>, then the next section is for you. We are going to cover more than you ever thought <a id="id199" class="indexterm"/>you would want to know about text editors!</p></div></div></div></div></div>
<div class="section" title="Text editor data cleaning"><div class="titlepage" id="aid-NQU22"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Text editor data cleaning</h1></div></div></div><p>We learned in <a class="link" title="Chapter 2. Fundamentals – Formats, Types, and Encodings" href="part0020.xhtml#aid-J2B82">Chapter 2</a>, <span class="emphasis"><em>Fundamentals – Formats, Types, and Encodings</em></span>, that text editors <a id="id200" class="indexterm"/>are the preferred way of reading and creating text files. This sounds reasonable and makes perfect sense. What we did not really explain back then was that a text editor is sometimes also called a programmer's editor because it has many cool features that help folks such as programmers, as well as data cleaners, who must deal with text files all day long. We are going to take a tour of some of the most useful features now.</p><div class="note" title="Note"><h3 class="title"><a id="tip12"/>Tip</h3><p>There are dozens of text editors available for every operating system. Some of them cost money, but many are available at no cost. For this chapter, I am going to use <a id="id201" class="indexterm"/>Text Wrangler, a no cost editor available for OSX (available here: <a class="ulink" href="http://www.barebones.com/products/textwrangler">http://www.barebones.com/products/textwrangler</a>). The features shown in this chapter are widely available in most other editors, such as Sublime Editor, but you should check the documentation for whatever editor you have chosen if the location of a particular feature or tool is not obvious.</p></div><div class="section" title="Text tweaking"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec20"/>Text tweaking</h2></div></div></div><p>Our <a id="id202" class="indexterm"/>text editor of choice has a number of useful functions<a id="id203" class="indexterm"/> built into it for text manipulation. The ones outlined here represent some of the most commonly used ones for data cleaning tasks. Keep in mind that you might run dozens of cleaning routines on a single text file in the course of cleaning it, so the tips we gave in <a class="link" title="Chapter 1. Why Do You Need Clean Data?" href="part0014.xhtml#aid-DB7S1">Chapter 1</a>, <span class="emphasis"><em>Why Do You Need Clean Data?</em></span>, for how to clearly communicate the changes you made will really come in handy here.</p><p><span class="strong"><strong>Changing case</strong></span> is <a id="id204" class="indexterm"/>a very common request in data cleaning. Many times, we will inherit data that is all lowercase or all uppercase. The following image shows a dialogue within Text Wrangler to perform case changes on a selection of text. The keyboard shortcuts are shown to the right of each option.</p><div class="mediaobject"><img src="../Images/image00257.jpeg" alt="Text tweaking"/></div><p style="clear:both; height: 1em;"> </p><p>Options<a id="id205" class="indexterm"/> for case changes include uppercase and lowercase as <a id="id206" class="indexterm"/>well as capitalizing the first letter of each word, line, or the first word in a sentence.</p><p>Adding<a id="id207" class="indexterm"/> or removing prefixes or suffixes on each line in a selection is another common task. I needed to do this for a large amount of text lines the other day when I was building a text classifier. I needed to suffix each line with a comma and the name of what class (positive or negative) the line exemplified. Here is the prefix and suffix dialogue in Text Wrangler. Note how you can either insert or remove, but not both, in the same maneuver. If you need to perform both of these tasks, perform one, and then perform the other.</p><div class="mediaobject"><img src="../Images/image00258.jpeg" alt="Text tweaking"/></div><p style="clear:both; height: 1em;"> </p><p><span class="strong"><strong>Zapping gremlins</strong></span> is<a id="id208" class="indexterm"/> another excellent task for your text editor. Both TextWrangler and Sublime Editor for Windows have this feature. In zapping gremlins, the editor can look for any characters that are outside of your desired character set, for example, control characters, NULL characters, and non-ASCII characters. It can either delete them or replace them with their character code. It could also replace the gremlins with any character <a id="id209" class="indexterm"/>that you specify. This makes them easier to find <a id="id210" class="indexterm"/>later.</p><div class="mediaobject"><img src="../Images/image00259.jpeg" alt="Text tweaking"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="The column mode"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>The column mode</h2></div></div></div><p>When<a id="id211" class="indexterm"/> a text editor is in <span class="strong"><strong>column mode</strong></span>, it means that you can <a id="id212" class="indexterm"/>select text in columns and not just in rows. Here is an example of selection in a normal (non-column) mode:</p><div class="mediaobject"><img src="../Images/image00260.jpeg" alt="The column mode"/></div><p style="clear:both; height: 1em;"> </p><p>Here is an example of a selection in column mode. Hold down the <span class="strong"><strong>Option</strong></span> key and select the text in columns. Once the text is selected, you can treat it just like you would treat any selected text: you can delete it, cut it or copy it onto the clipboard, or use any of the text tweaks we discussed in the preceding section as long as they work on a selection.</p><div class="mediaobject"><img src="../Images/image00261.jpeg" alt="The column mode"/></div><p style="clear:both; height: 1em;"> </p><p>A few<a id="id213" class="indexterm"/> limitations of this feature include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Each<a id="id214" class="indexterm"/> character is one column, so characters should be displayed in <a id="id215" class="indexterm"/>a non-proportional, typewriter-style typeface.</li><li class="listitem">In Text Wrangler, the column mode only works when line wrapping is turned off. Turning off soft wrapping means your lines will extend to the right and not be wrapped.</li><li class="listitem">In Text Wrangler, the vertical height of the column you are drawing must be able to be drawn by you manually, so this is a technique for small amounts of data (hundreds or thousands of rows, but probably not hundreds <span class="emphasis"><em>of</em></span> thousands of rows).</li></ul></div></div><div class="section" title="Heavy duty find and replace"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>Heavy duty find and replace</h2></div></div></div><p>Text <a id="id216" class="indexterm"/>editors really shine at manipulating text. It may feel strange to use a text editor in the column mode, as that seems like more of a natural task for a spreadsheet. Similarly, it may seem awkward to use a spreadsheet for <span class="strong"><strong>Find-Replace</strong></span> after you see what a text editor can do.</p><p>The main portion of the <span class="strong"><strong>Find</strong></span> dialogue window in Text Wrangler is shown as follows. The provided features include options for case-sensitive searches, wrapping around, searching in subselections of text, and looking for the given text pattern inside either a word or just a portion of a word. You can also paste special characters, whitespace (including tabs and line terminators), emojis, and so on, into the textbox. The little drop-down boxes to the right of the <span class="strong"><strong>Find</strong></span> box provide additional functionality. The top one with the clock icon on it holds a list of recent searches and replacements. The bottom one with the letter <span class="strong"><strong>g</strong></span> on it holds a list of built-in search patterns that might be useful, and at the bottom of this menu is an option to add your own patterns to the list.</p><div class="mediaobject"><img src="../Images/image00262.jpeg" alt="Heavy duty find and replace"/></div><p style="clear:both; height: 1em;"> </p><p>One <a id="id217" class="indexterm"/>of the most powerful find-replace features is enabled by the <span class="strong"><strong>Grep</strong></span> checkbox. Checking this box allows us to use a regular expression pattern for <a id="id218" class="indexterm"/>our searches. In short, a <span class="strong"><strong>regular expression</strong></span> (<span class="strong"><strong>regex</strong></span>) is a pattern written in a special language, made up of symbols, and designed to match against some string text. A full treatment of regular expressions is beyond the scope of this book, but suffice it to say that they are enormously useful and we will be visiting them periodically when we need them to clean data.</p><div class="note" title="Note"><h3 class="title"><a id="tip13"/>Tip</h3><p>The reason the checkbox in the Text Wrangler interface says Grep—and not RegEx or Match—is that there are several slight variations on the regular expression pattern-matching language. Text Wrangler is signaling to us that it is using the one from Grep, a program originally written for Unix and the most common variant.</p></div><p>Here, we will outline a few of the indispensible regular expression symbols that we will use time and again to clean data. For more complicated patterns, it is worth consulting a special book or one of the myriad web pages that show all kinds of exotic regular expression syntaxes:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Symbol</p>
</th><th valign="bottom">
<p>What it does</p>
</th></tr></thead><tbody><tr><td valign="top">
<p><code class="literal">$</code></p>
</td><td valign="top">
<p>Matches<a id="id219" class="indexterm"/> the end of the line</p>
</td></tr><tr><td valign="top">
<p><code class="literal">^</code></p>
</td><td valign="top">
<p>Matches <a id="id220" class="indexterm"/>the beginning of the line</p>
</td></tr><tr><td valign="top">
<p><code class="literal">+</code></p>
</td><td valign="top">
<p>Matches <a id="id221" class="indexterm"/>one or more of the specified characters</p>
</td></tr><tr><td valign="top">
<p><code class="literal">*</code></p>
</td><td valign="top">
<p>Matches<a id="id222" class="indexterm"/> 0 or more of the specified characters</p>
</td></tr><tr><td valign="top">
<p><code class="literal">\w</code></p>
</td><td valign="top">
<p>Matches <a id="id223" class="indexterm"/>any word character (0-9, A-z). To match nonword characters, use <code class="literal">\W</code></p>
</td></tr><tr><td valign="top">
<p><code class="literal">\s</code></p>
</td><td valign="top">
<p>Matches <a id="id224" class="indexterm"/>any whitespace character (tab, line feed, or carriage return). To match non-whitespace characters, use <code class="literal">\S</code></p>
</td></tr><tr><td valign="top">
<p><code class="literal">\t</code></p>
</td><td valign="top">
<p>Matches a tab character</p>
</td></tr><tr><td valign="top">
<p><code class="literal">\r</code></p>
</td><td valign="top">
<p>Matches<a id="id225" class="indexterm"/> a carriage return. Use <code class="literal">\n</code> for line feed.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">\</code></p>
</td><td valign="top">
<p>This is<a id="id226" class="indexterm"/> the escape character. It matches the exact character that follows, not the regex pattern character.</p>
</td></tr></tbody></table></div><p>Here <a id="id227" class="indexterm"/>are a few examples of find-replace combinations so that we can learn how Text Wrangler works with regular expressions. Make sure the Grep box is checked. If nothing is shown in the replace column, it means that the <a id="id228" class="indexterm"/>Replace field should be left empty.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Find</p>
</th><th valign="bottom">
<p>Replace</p>
</th><th valign="bottom">
<p>What it does</p>
</th></tr></thead><tbody><tr><td valign="top">
<p><code class="literal">\r</code></p>
</td><td valign="top"> </td><td valign="top">
<p>Finds a line feed (line terminator) and replaces it with nothing. Another way to phrase this is "make multiple lines into one line".</p>
</td></tr><tr><td valign="top">
<p><code class="literal">^\w+</code></p>
</td><td valign="top">
<p><code class="literal">-</code></p>
</td><td valign="top">
<p>Matches the beginning of the line, followed by at least a one-word character. Adds a <code class="literal">-</code> character to the front of the line.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">\\r$</code></p>
</td><td valign="top">
<p><code class="literal">\[end\]</code></p>
</td><td valign="top">
<p>Looks for all lines that end with the actual <code class="literal">\r</code> characters (backslash followed by r) and replaces<a id="id229" class="indexterm"/> them with the actual characters <code class="literal">[end]</code>. Note that [ and ] are special regex characters as well, so they will need to be escaped to use them as actual characters.</p>
</td></tr></tbody></table></div><p>If regular expressions seem daunting, take heart. First, recall from the <span class="emphasis"><em>Text tweaking</em></span> section earlier in this chapter that most text editors, Text Wrangler included, have many built-in<a id="id230" class="indexterm"/> search and replace features that are built on the most common regular expressions. So, you may find that you do not really have to write many regular expressions very often. Second, as regular expressions are so powerful and so useful, there are a lot of online resources that you can consult to learn how to build a complicated regex if you need it.</p><p>Two of my favorite resources for regex are <a id="id231" class="indexterm"/>Stack Overflow (<a class="ulink" href="http://stackoverflow.com">http://stackoverflow.com</a>) and regular-expresions.info (<a class="ulink" href="http://regular-expressions.info">http://regular-expressions.info</a>). There are also numerous <a id="id232" class="indexterm"/>regular expression testing websites available via a quick web search. These sites let you write and test the regular expressions on a sample text.</p><div class="section" title="A word of caution"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec28"/>A word of caution</h3></div></div></div><p>Be careful<a id="id233" class="indexterm"/> when using online regex testers, however, as they are usually designed to teach a particular flavor of regular expressions, such as for the regex parsers inside JavaScript, PHP, or Python. Some of the things you want to do may have the same regular expression syntax in your text editor as the one in these languages, or they may not. Depending on the complexity of what you are trying to do, it may be a better idea just to create a backup copy of your text data (or extract a small sample of the text in question into a new file) and experiment on it in your own text editor using its regular expression syntax.</p></div></div><div class="section" title="Text sorting and processing duplicates"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>Text sorting and processing duplicates</h2></div></div></div><p>Once<a id="id234" class="indexterm"/> we <a id="id235" class="indexterm"/>have experimented with regex<a id="id236" class="indexterm"/> a little bit, we notice that our text editor will occasionally make these pattern-matching techniques available in other menu options, for example, in sorting and duplicate processing. Consider the following sorting dialogue to see how a regex can be applied to sorting multiple lines:</p><div class="mediaobject"><img src="../Images/image00263.jpeg" alt="Text sorting and processing duplicates"/></div><p style="clear:both; height: 1em;"> </p><p>In <a id="id237" class="indexterm"/>this case, we can use the <span class="strong"><strong>Sort using pattern</strong></span> checkbox to enter a <a id="id238" class="indexterm"/>regular expression pattern to sort by. The duplicate processing<a id="id239" class="indexterm"/> dialogue is similar. You can tell the editor whether to leave the original line or remove it. Interestingly, you can also remove the duplicates to another file or to the clipboard if you need to use them for something else, such as keeping a log of removed lines, perhaps.</p><div class="note" title="Note"><h3 class="title"><a id="tip14"/>Tip</h3><p>In data cleaning, it is a good idea to at least consider saving the removed lines into their own file in case you ever need them again.</p></div><div class="mediaobject"><img src="../Images/image00264.jpeg" alt="Text sorting and processing duplicates"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Process Lines Containing"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec24"/>Process Lines Containing</h2></div></div></div><p>One<a id="id240" class="indexterm"/> handy feature in Text Wrangler is called <span class="strong"><strong>Process Lines Containing</strong></span>. It<a id="id241" class="indexterm"/> mixes searching (including the possibility of using a regular expression) with line-by-line processing, such as removing the affected lines to another file or to the clipboard, or deleting the matching lines.</p><div class="mediaobject"><img src="../Images/image00265.jpeg" alt="Process Lines Containing"/></div><p style="clear:both; height: 1em;"> </p></div></div>
<div class="section" title="An example project"><div class="titlepage" id="aid-OPEK2"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>An example project</h1></div></div></div><p>In this<a id="id242" class="indexterm"/> example project, we will download a spreadsheet, use Excel or a text editor to clean it, and then run some simple analyses on it.</p><div class="section" title="Step one – state the problem"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>Step one – state the problem</h2></div></div></div><p>This <a id="id243" class="indexterm"/>project is inspired by some data made available by the Chronicle of Higher Education, a publication about college and university news and happenings. In 2012, they created an interactive feature called "Who does your college think its peers are?". In this feature, users can enter the name of any US-based college or university into a form and see an interactive visualization showing which other<a id="id244" class="indexterm"/> universities call that target school a <span class="strong"><strong>peer</strong></span>. (Peers are universities that are similar in some way.) The original data came from U.S. government reports, but the Chronicle has made the data underlying this visualization free for anyone to use.</p><p>For this example, we are interested in a complimentary question: When University X appears on a list, which other universities are on these lists? To answer this question, we will need to find all the other universities that are listed with University X, and then we will have to count how many times each of their names occurs.</p></div><div class="section" title="Step two – data collection"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>Step two – data collection</h2></div></div></div><p>In this step, we will see the procedure to collect data and then clean it in a step-by-step manner. The <a id="id245" class="indexterm"/>upcoming sections discuss the actions we need to take in order to collect proper data for our project.</p><div class="section" title="Download the data"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec29"/>Download the data</h3></div></div></div><p>The <a id="id246" class="indexterm"/>data for this project can be downloaded from the original article at <a class="ulink" href="http://chronicle.com/article/Who-Does-Your-College-Think/134222/">http://chronicle.com/article/Who-Does-Your-College-Think/134222/</a> or from the direct link to the spreadsheet at <a class="ulink" href="https://s3.amazonaws.com/03peers/selected_peers.csv.zip">https://s3.amazonaws.com/03peers/selected_peers.csv.zip</a></p><p>The file is zipped, so use your unzip program of choice to unzip the file.</p></div><div class="section" title="Get familiar with the data"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec30"/>Get familiar with the data</h3></div></div></div><p>The file <a id="id247" class="indexterm"/>inside the ZIP folder has a <code class="literal">.csv</code> extension, and it indeed is a CSV-delimited file with 1,686 rows in it, including a header row. The commas delimit two columns: the first column is the name of the university in question, and the second column is the list of all the universities that the original one listed as peers. These peers are themselves delimited by the pipe (<code class="literal">|</code>) character. Here is a sample row:</p><div class="informalexample"><pre class="programlisting">Harvard University,Yale University|Princeton University|Stanford University</pre></div><p>In this case, the first column states that Harvard University is the target university, and the second column shows that Yale, Princeton, and Stanford have been listed by Harvard as its peers.</p></div></div><div class="section" title="Step three – data cleaning"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>Step three – data cleaning</h2></div></div></div><p>As <a id="id248" class="indexterm"/>the goal of this example is to look at one particular university and all the times it is listed as some other university's peer, our first goal is to clean out any row that does <span class="emphasis"><em>not</em></span> have the target university in it. We will then transform the file into a single long list of individual universities. At this point, our data will be clean and we will be ready to go to the analysis and visualization steps.</p><div class="section" title="Extracting relevant lines"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec31"/>Extracting relevant lines</h3></div></div></div><p>Let's <a id="id249" class="indexterm"/>compare two methods for extracting relevant lines: one using a spreadsheet and one using a text editor with the techniques outlined in this chapter.</p><div class="section" title="Using a spreadsheet"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec22"/>Using a spreadsheet</h4></div></div></div><p>Open the file in a spreadsheet program, highlight any row that has <span class="strong"><strong>Harvard</strong></span> written in it (or your <a id="id250" class="indexterm"/>target university of choice) using conditional formatting, and delete the rest of the rows.</p></div><div class="section" title="Using a text editor"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec23"/>Using a text editor</h4></div></div></div><p>Open<a id="id251" class="indexterm"/> the file in a text editor and use <span class="strong"><strong>Process Lines Containing</strong></span> to find all lines that have the <span class="strong"><strong>Harvard University</strong></span> phrase (or whatever your university of choice is) included, and then copy them to a new file.</p><div class="mediaobject"><img src="../Images/image00266.jpeg" alt="Using a text editor"/></div><p style="clear:both; height: 1em;"> </p><p>With either option, the result of this process is a new file with 26 lines in it, all of which include <span class="strong"><strong>Harvard University</strong></span> somewhere in the line.</p></div></div><div class="section" title="Transform the lines"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec32"/>Transform the lines</h3></div></div></div><p>Right <a id="id252" class="indexterm"/>now we have a file with 26 lines, each with multiple universities per line (wide data). We anticipate that we will probably be reading the file into Python at some point to perform a simple frequency count of universities. So, we decide that we want to change this to long data, with one university per line.</p><p>To transform the file so that there is one university per line, we will use a text editor and three instances of find and replace. First, we will find commas and replace them with <code class="literal">/r</code> (carriage return).</p><div class="mediaobject"><img src="../Images/image00267.jpeg" alt="Transform the lines"/></div><p style="clear:both; height: 1em;"> </p><p>Next, find<a id="id253" class="indexterm"/> instances of the pipe character (<code class="literal">|</code>) and replace it with <code class="literal">\r</code>. At this point, the text file has 749 lines.</p><p>Finally, we need to remove all instances of <span class="strong"><strong>Harvard University</strong></span>. (Remember, we are only interested in peers who are mentioned with Harvard, so we do not need Harvard itself in the count.) In Text Wrangler, we can put <span class="strong"><strong>Harvard University\r</strong></span> in the <span class="strong"><strong>Find</strong></span> box and leave the <span class="strong"><strong>Replace</strong></span> box empty. This results in 26 lines deleted and a grand total of 723 lines in the file.</p></div></div><div class="section" title="Step four – data analysis"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Step four – data analysis</h2></div></div></div><p>As <a id="id254" class="indexterm"/>our main focus is data cleaning, we will not spend too much time on analysis or visualization, but here is a quick Python script to count how many times each of these peers are mentioned along with Harvard on some university's list:</p><div class="informalexample"><pre class="programlisting">from collections import Counter
with open('universities.txt') as infile:
    counted = Counter(filter(None,[line.strip() for line in infile]))
    sorted = counted.most_common()
    for key,value in sorted:
      print key, ",", value</pre></div><p>The results show 232 unique universities and a count of how many times that university was mentioned. Here are the first few results. We can interpret these results as follows:</p><p><span class="emphasis"><em>When Harvard is mentioned as a peer, Yale was also mentioned 26 times</em></span>:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Yale University , 26</strong></span>
<span class="strong"><strong>Princeton University , 25</strong></span>
<span class="strong"><strong>Cornell University , 24</strong></span>
<span class="strong"><strong>Stanford University , 23</strong></span>
<span class="strong"><strong>Columbia University in the City of New York , 22</strong></span>
<span class="strong"><strong>Brown University , 21</strong></span>
<span class="strong"><strong>University of Pennsylvania , 21</strong></span>
</pre></div><p>At this point, you can take the list (or some portion of the longer list) and feed it into a bar graph<a id="id255" class="indexterm"/> or a word cloud or whatever type of visualization you think is persuasive or interesting. As the data is comma-delimited, you could even easily paste it into a spreadsheet program for further analysis. But at this point, we have answered our initial question about which peers are mentioned most, given a target university.</p></div></div>
<div class="section" title="Summary" id="aid-PNV61"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Summary</h1></div></div></div><p>In this chapter, we learned some very practical tips for data cleaning using two easily accessible tools: text editors and spreadsheets. We outlined the available spreadsheet functions for splitting data, moving it around, finding and replacing parts, formatting it, and then putting it back together. Then, we learned how to get the most out of a simple text editor, including some of the built-in functions, and how to use find and replace and regular expressions most effectively.</p><p>In the next chapter, we will put together a variety of the techniques we have learned so far to perform some significant file conversions. Many of the techniques we will use will be based on what we have learned in the past two chapters about text editing, regular expressions, data types, and file formats, so get ready to solve some real-world data cleaning problems.</p></div></body></html>
<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Importing and Exporting Data from Various DBs"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Importing and Exporting Data from Various DBs</h1></div></div></div><p>In this final chapter, we are going to see how data from different sources can be loaded into R for performing the data analytics operations. Here, we have considered some of the popular databases that are being used as data storage, required for performing data analytics with <a id="id737" class="indexterm"/>different applications and technologies. As we know, performing the analytics operations with R is quite easy as compared to the other analytics tools and again, it's free and open source. Since, R has available methods to use customized functions via installing R packages, many database packages are available in CRAN to perform database connection with R. Therefore, the R programming language is becoming more and more popular due to database, as well as operating system, independence.</p><p>We have specially designed this chapter to share knowledge of how data from various database systems can be loaded and used into R for performing data modeling. In this chapter, we have included several popular database examples for performing various DB operations.</p><p>We have covered various data sources that are popular and are used with R. They are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">RData</li><li class="listitem" style="list-style-type: disc">MySQL</li><li class="listitem" style="list-style-type: disc">Excel</li><li class="listitem" style="list-style-type: disc">MongoDB</li><li class="listitem" style="list-style-type: disc">SQLite</li><li class="listitem" style="list-style-type: disc">PostgreSQL</li><li class="listitem" style="list-style-type: disc">Hive</li><li class="listitem" style="list-style-type: disc">HBase</li></ul></div><div class="mediaobject"><img src="graphics/3282OS_07_01.jpg" alt="Importing and Exporting Data from Various DBs"/></div><p>From the preceding diagram, we can understand that R is supported with several database systems to perform <a id="id738" class="indexterm"/>data analytics related operations over various databases. Since there are a large number of libraries available for R to perform the connection with various DBs, we just need to inherit them.</p><p>In the following table, the possible database systems and the related R packages are given for easy understanding of the related R packages:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Database system name</p>
</th><th style="text-align: left" valign="bottom">
<p>Useful R packages / function utilities</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Text files</p>
</td><td style="text-align: left" valign="top">
<p>Text data files such as <code class="literal">.csv</code>, <code class="literal">.txt</code>, and <code class="literal">.r</code></p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>MySQL</p>
</td><td style="text-align: left" valign="top">
<p>RMySQL</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Excel</p>
</td><td style="text-align: left" valign="top">
<p>Xlsx</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Mongo</p>
</td><td style="text-align: left" valign="top">
<p>RMongo</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>SQLlite</p>
</td><td style="text-align: left" valign="top">
<p>RSQLlite</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p> PostgreSQL</p>
</td><td style="text-align: left" valign="top">
<p>RPostgreSQL</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>HDFS</p>
</td><td style="text-align: left" valign="top">
<p>RHDFS</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Hive</p>
</td><td style="text-align: left" valign="top">
<p>RHive</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>HBase</p>
</td><td style="text-align: left" valign="top">
<p>RHBase</p>
</td></tr></tbody></table></div><p>As we know, each of the mentioned databases have their own importance with the features. Each of these<a id="id739" class="indexterm"/> data sources will be described with the following points for better understanding:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Introduction</li><li class="listitem" style="list-style-type: disc">Features</li><li class="listitem" style="list-style-type: disc">Installation</li><li class="listitem" style="list-style-type: disc">Import the data into R</li><li class="listitem" style="list-style-type: disc">Data manipulation</li><li class="listitem" style="list-style-type: disc">Export the data from R</li></ul></div><p>In this chapter, we are going to install and interact with R packages that will be used for various data operations in R.</p><p>Now, we will start understanding about databases and how to perform data-related operations to forward to data analytics for all databases.</p><div class="section" title="Learning about data files as database"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec44"/>Learning about data files as database</h1></div></div></div><p>While dealing with<a id="id740" class="indexterm"/> the data analytics activities, we need to do data importing, loading, or exporting functionalities all the time. Sometimes the same operations need to be iterated with R programming language. So, we can use the available R function for performing the same data activities.</p><div class="section" title="Understanding different types of files"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec65"/>Understanding different types of files</h2></div></div></div><p>There are commonly four different types of data files used with R for data storage operations. They<a id="id741" class="indexterm"/> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CSV (Comma Separated Values)</li><li class="listitem" style="list-style-type: disc">Txt<a id="id742" class="indexterm"/> (with Tab Separated Values)</li><li class="listitem" style="list-style-type: disc">.RDATA<a id="id743" class="indexterm"/> (R's native data format)</li><li class="listitem" style="list-style-type: disc">.rda<a id="id744" class="indexterm"/> (R's native data format)</li></ul></div></div><div class="section" title="Installing R packages"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec66"/>Installing R packages</h2></div></div></div><p>To use the <a id="id745" class="indexterm"/>data file with the format specified earlier, we don't need to <a id="id746" class="indexterm"/>install extra R packages. We just need to use the<a id="id747" class="indexterm"/> built-in functions available with R.</p></div><div class="section" title="Importing the data into R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec67"/>Importing the data into R</h2></div></div></div><p>To perform <a id="id748" class="indexterm"/>analytics-related activities, we need to use the following <a id="id749" class="indexterm"/>functions to get the data into R:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CSV: <code class="literal">read.csv()</code> is intended for reading the <span class="strong"><strong>comma separated value</strong></span> (<span class="strong"><strong>CSV</strong></span>) files, where the decimal point is <code class="literal">",". </code>The retrieved data will be stored into one R object, which is considered as <code class="literal">Dataframe</code>.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Dataframe &lt;- read.csv("data.csv",sep=",")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">TXT: To retrieve the tab separated values, the <code class="literal">read.table()</code> function will be used with some important parameters and the return type of this function will be <code class="literal">Dataframe type</code>.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Dataframe &lt;- read.table("data.csv", sep="\t")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">.RDATA: Here, the .RDATA format is used by R for storing the workspace data for a particular time period. It is considered as image file. This will store/retrieve all of the data available in the workspace.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>load("history.RDATA")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">.rda: This is also R's native data format, which stores the specific data variable as per requirement.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>load("data_variables_a_and_b.rda")</strong></span>
</pre></div></li></ul></div></div><div class="section" title="Exporting the data from R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec68"/>Exporting the data from R</h2></div></div></div><p>To export<a id="id750" class="indexterm"/> the existing data object from R and to support data files as <a id="id751" class="indexterm"/>per requirements, we need to use the following functions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CSV: Write the dataframe object into the <code class="literal">csv</code> data file via the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>write.csv(mydata, "c:/mydata.csv", sep=",", row.names=FALSE)</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">TXT: Write the data with the tab delimiters via the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>write.table(mydata, "c:/mydata.txt", sep="\t")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">.RDATA: To <a id="id752" class="indexterm"/>store the workspace data variables available to <a id="id753" class="indexterm"/>R session, use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>save.image()</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">.rda: This function is used to store specific data objects that can be reused later. Use the following code for saving them to the .<code class="literal">rda</code> files.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># column vector</strong></span>
<span class="strong"><strong>a &lt;- c(1,2,3)</strong></span>

<span class="strong"><strong># column vector</strong></span>
<span class="strong"><strong>b &lt;- c(2,4,6)</strong></span>

<span class="strong"><strong># saving it to R (.rda) data format</strong></span>
<span class="strong"><strong>save(a, b, file=" data_variables_a_and_b.rda")</strong></span>
</pre></div></li></ul></div></div></div></div>
<div class="section" title="Understanding MySQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec45"/>Understanding MySQL</h1></div></div></div><p>MySQL is world's<a id="id754" class="indexterm"/> most popular open source database. Many of the world's largest and fastest growing organizations including Facebook, Google, Adobe, and Zappos rely on MySQL databases, to save time and money powering high-volume websites, business critical systems, and software packages.</p><p>Since both R and MySQL both are open source, they can be used for building the interactive web analytic applications. Also simple data analytics activities can be performed for existing web applications with this unique package.</p><p>To install MySQL on your Linux machine, you need to follow the given steps in sequence:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Install MySQL</li><li class="listitem" style="list-style-type: disc">Install RMySQL</li></ul></div><div class="section" title="Installing MySQL"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec69"/>Installing MySQL</h2></div></div></div><p>We <a id="id755" class="indexterm"/>will<a id="id756" class="indexterm"/> see how to get MySQL installed on Linux:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Updating the linux package list</strong></span>
<span class="strong"><strong>sudo apt-get update</strong></span>

<span class="strong"><strong>// Upgrading the updated packages</strong></span>
<span class="strong"><strong>sudo apt-get dist-upgrade</strong></span>

<span class="strong"><strong>//First, install the MySQL server and client packages:</strong></span>
<span class="strong"><strong>sudo apt-get install mysql-server mysql-client</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip21"/>Tip</h3><p>Log in<a id="id757" class="indexterm"/> to MySQL database using the following<a id="id758" class="indexterm"/> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mysql -u root -p</strong></span>
</pre></div></div></div></div><div class="section" title="Installing RMySQL"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec70"/>Installing RMySQL</h2></div></div></div><p>Now, we have <a id="id759" class="indexterm"/>installed MySQL on our Linux machine. It's <a id="id760" class="indexterm"/>time to install RMySQL – R library from CRAN<a id="id761" class="indexterm"/> via the following R commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># to install RMySQL library</strong></span>
<span class="strong"><strong>install.packages("RMySQL")</strong></span>

<span class="strong"><strong>#Loading RMySQL
library(RMySQL)</strong></span>
</pre></div><p>After the RMySQL library is installed on R, perform MySQL database connection by providing the user privileges as provided in MySQL administration console:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mydb = dbConnect(MySQL(), user='root', password='', dbname='sample_table', host='localhost')</strong></span>
</pre></div></div><div class="section" title="Learning to list the tables and their structure"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec71"/>Learning to list the tables and their structure</h2></div></div></div><p>Now, the database connection has been done successfully. To list the available tables and their structure of data base<a id="id762" class="indexterm"/> in MySQL database, look at the following commands. To<a id="id763" class="indexterm"/> return the available tables created under <code class="literal">mydb</code> database, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>dbListTables(mydb)</strong></span>
</pre></div><p>To return a list of data fields created under the <code class="literal">sample_table</code> table, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>dbListFields(mydb, 'sample_table')</strong></span>
</pre></div></div><div class="section" title="Importing the data into R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec72"/>Importing the data into R</h2></div></div></div><p>We know how<a id="id764" class="indexterm"/> to check MySQL tables and their fields. After identification of useful data tables, we can import them in R using the following RMySQL command. To retrieve the custom data from MySQL database as per the provided SQL query, we need to store it in an object:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rs = dbSendQuery(mydb, "select * from sample_table")</strong></span>
</pre></div><p>The available<a id="id765" class="indexterm"/> data-related information can be retrieved from MySQL to R via the <code class="literal">fetch</code> command as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>dataset = fetch(rs, n=-1)</strong></span>
</pre></div><p>Here, the specified parameter <code class="literal">n = -1</code> is used for retrieving all pending records.</p></div><div class="section" title="Understanding data manipulation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec73"/>Understanding data manipulation</h2></div></div></div><p>To perform the <a id="id766" class="indexterm"/>data operation with MySQL database, we need to fire<a id="id767" class="indexterm"/> the SQL queries. But in case of RMySQL, we can fire commands with the <code class="literal">dbSendQuery</code> function.</p><p>Creating a new table with the help of available R dataframe into MySQL database can be done with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>dbWriteTable(mydb, name='mysql_table_name', value=data.frame.name)</strong></span>
</pre></div><p>To insert R matrix data into the existing data table in MySQL, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># defining data matrix</strong></span>
<span class="strong"><strong>datamatrix &lt;- matrix(1:4, 2, 2)</strong></span>

<span class="strong"><strong># defining query to insert the data</strong></span>
<span class="strong"><strong>query &lt;- paste("INSERT INTO names VALUES(",datamatrix [1,1], ",", datamatrix [1,2], ")")</strong></span>

<span class="strong"><strong># command for submitting the defined SQL query dbGetQuery(con, query)</strong></span>
</pre></div><p>Sometimes we need to delete a MySQL table when it is no longer of use. We can fire the following query to delete the <code class="literal">mysql_some_table</code> table:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>dbSendQuery(mydb, 'drop table if exists mysql_some_table').</strong></span>
</pre></div></div></div>
<div class="section" title="Understanding Excel"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec46"/>Understanding Excel</h1></div></div></div><p>Excel is a spreadsheet application developed by Microsoft to be run on Windows and Mac OS, which <a id="id768" class="indexterm"/>has a similar function to R for performing statistical computation, graphical visualization, and data modeling. Excel is provided by Microsoft with the Microsoft Office bundle, which mainly supports <code class="literal">.xls</code> spreadsheet data file format. In case, we want to read or write to Microsoft Excel spreadsheets from within R, we can use many available R packages. But one of the popular and working R library is xlsx.</p><p>This package programmatically provides control of the Excel files using R. The high level API of this<a id="id769" class="indexterm"/> allows users to read a spread sheet of the <code class="literal">.xlsx</code> document into a <code class="literal">data.frame</code> and writing <code class="literal">data.frame</code> to a file. This package is basically developed by <span class="emphasis"><em>Adrian A. Dragulescu</em></span>.</p><div class="section" title="Installing Excel"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec74"/>Installing Excel</h2></div></div></div><p>Here, we are <a id="id770" class="indexterm"/>considering the <code class="literal">.xls</code> file as the data source, which can be built <a id="id771" class="indexterm"/>and maintained with the help of Microsoft Excel 97/2000/XP/2003.</p><p>The following<a id="id772" class="indexterm"/> are the prerequisites for the xlsx packages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">xlsxjars</li><li class="listitem" style="list-style-type: disc">rJava</li></ul></div><p>Installing xlsxX packages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Install.packages("xlsxjars")</li><li class="listitem" style="list-style-type: disc">Install.packages("rJava")</li><li class="listitem" style="list-style-type: disc">Install.packages("xlsx")</li></ul></div></div><div class="section" title="Importing data into R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec75"/>Importing data into R</h2></div></div></div><p>Suppose <a id="id773" class="indexterm"/>we have created one excel file and now we want to perform the data analytics related operations with R, this is the best package to load the excel file to be processed within R.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>es &lt;- read.xlsx("D:/ga.xlsx",1) </strong></span>
</pre></div><p>The preceding command will store the excel data with sheet 1 into the <code class="literal">es</code> dataframe format in R.</p></div><div class="section" title="Understanding data manipulation with R and Excel"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec150"/>Understanding data manipulation with R and Excel</h2></div></div></div><p>The following<a id="id774" class="indexterm"/> command will be used for selecting the subset of dataframe, <code class="literal">res</code>, which selects the first five rows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>r &lt;- res[1:5,]</strong></span>
</pre></div></div><div class="section" title="Exporting the data to Excel"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec76"/>Exporting the data to Excel</h2></div></div></div><p>As per the<a id="id775" class="indexterm"/> defined name, the processed data with the dataframe format can be stored as a <code class="literal">xls</code> file to be supported with Excel.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ress &lt;- write.xlsx(r, "D:/ga1.xls")  </strong></span>
</pre></div></div></div>
<div class="section" title="Understanding MongoDB"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Understanding MongoDB</h1></div></div></div><p>MongoDB is a NoSQL-based distributed document data storage. This has been specially designed for<a id="id776" class="indexterm"/> providing scalable and high performance data storage solutions. In many scenarios, it can be used to replace traditional relational database or key/value data storage. The biggest feature of Mongo is its query language, which is very powerful, and its syntax is somewhat similar to object-oriented query language.</p><p>The following are the <a id="id777" class="indexterm"/>features of MongoDB:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set-oriented storage and easy to store the object type</li><li class="listitem" style="list-style-type: disc">Support for dynamic queries</li><li class="listitem" style="list-style-type: disc">Full index support</li><li class="listitem" style="list-style-type: disc">Rich query language</li><li class="listitem" style="list-style-type: disc">Data fragments processing order to support the expansion of the cloud level</li><li class="listitem" style="list-style-type: disc">BSON-based file data storage</li><li class="listitem" style="list-style-type: disc">Supported with C, C++, C#, Erlang, Haskell, Java, JavaScript, Perl, PHP, Python, Ruby, and Scala</li></ul></div><p>We can use R and MongoDB together by installing the following prerequisites:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">MongoDB installation</li><li class="listitem" style="list-style-type: disc">rmongodb installation</li></ul></div><div class="section" title="Installing MongoDB"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec77"/>Installing MongoDB</h2></div></div></div><p>The following are <a id="id778" class="indexterm"/>the steps provided for installation of MongoDB <a id="id779" class="indexterm"/>in Ubuntu 12.04 and CentOS:</p><p>First, we <a id="id780" class="indexterm"/>will<a id="id781" class="indexterm"/> see installation steps for Ubuntu.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Configure Package Management System (APT) using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-key adv --keyserverhkp://keyserver.ubuntu.com:80 --recv 7F0CEB10</strong></span>
</pre></div></li><li class="listitem">Create <code class="literal">/etc/apt/sources.list.d/mongodb.list</code> by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | sudo tee /etc/apt/sources.list.d/mongodb.list</strong></span>
</pre></div></li><li class="listitem">Now, update the package list of your OS using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get update</strong></span>
</pre></div></li><li class="listitem">Install the latest version of MongoDB by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>apt-get install mongodb-10gen</strong></span>
</pre></div></li></ol></div><p>Now, we <a id="id782" class="indexterm"/>will <a id="id783" class="indexterm"/>see the installation steps for CentOs.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Configure Package Management System (YUM).</li><li class="listitem">Create <code class="literal">/etc/yum.repos.d/mongodb.repo</code> and use the following configurations:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For a 64-bit system use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[mongodb]</strong></span>
<span class="strong"><strong>name=MongoDB Repository</strong></span>
<span class="strong"><strong>baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/</strong></span>
<span class="strong"><strong>gpgcheck=0</strong></span>
<span class="strong"><strong>enabled=1</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">For a 32-bit system use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[mongodb]</strong></span>
<span class="strong"><strong>name=MongoDB Repository</strong></span>
<span class="strong"><strong>baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/i686/</strong></span>
<span class="strong"><strong>gpgcheck=0</strong></span>
<span class="strong"><strong>enabled=1</strong></span>
</pre></div></li></ul></div></li><li class="listitem">Install Packages.</li></ol></div><p>With the following command, install a stable version of MongoDB and the associated tools:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>yum install mongo-10gen mongo-10gen-server</strong></span>
</pre></div><p>Now, you have successfully installed MongoDB.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip22"/>Tip</h3><p><span class="strong"><strong>Useful commands for controlling a mongodb service</strong></span></p><p>To start the mongodb service we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service mongodb start</strong></span>
</pre></div><p>To stop the mongodb service we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service mongodb stop</strong></span>
</pre></div><p>To restart the mongodb service we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service mongodb restart</strong></span>
</pre></div><p>To start a<a id="id784" class="indexterm"/> Mongo<a id="id785" class="indexterm"/> console we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mongo</strong></span>
</pre></div></div></div><div class="section" title="Mapping SQL to MongoDB"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec54"/>Mapping SQL to MongoDB</h3></div></div></div><p>The following<a id="id786" class="indexterm"/> are the mappings of SQL terms to MongoDB <a id="id787" class="indexterm"/>terms for better understanding of data storage:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>No.</p>
</th><th style="text-align: left" valign="bottom">
<p>SQL Term</p>
</th><th style="text-align: left" valign="bottom">
<p>MongoDB Term</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>1.</p>
</td><td style="text-align: left" valign="top">
<p>Database</p>
</td><td style="text-align: left" valign="top">
<p>Database</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>2.</p>
</td><td style="text-align: left" valign="top">
<p>Table</p>
</td><td style="text-align: left" valign="top">
<p>Collection</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3.</p>
</td><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>Index</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>4.</p>
</td><td style="text-align: left" valign="top">
<p>Row</p>
</td><td style="text-align: left" valign="top">
<p>Document</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5.</p>
</td><td style="text-align: left" valign="top">
<p>Column</p>
</td><td style="text-align: left" valign="top">
<p>Field</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>6.</p>
</td><td style="text-align: left" valign="top">
<p>Joining</p>
</td><td style="text-align: left" valign="top">
<p>Embedding &amp; linking</p>
</td></tr></tbody></table></div></div><div class="section" title="Mapping SQL to MongoQL"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec55"/>Mapping SQL to MongoQL</h3></div></div></div><p>The following<a id="id788" class="indexterm"/> are the mapping of SQL statements to Mongo QL <a id="id789" class="indexterm"/>statements for the understanding of query development/conversion:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>No.</p>
</th><th style="text-align: left" valign="bottom">
<p>SQL Statement</p>
</th><th style="text-align: left" valign="bottom">
<p>Mongo QL Statement</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>1.</p>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>INSERT INTO students VALUES(1,1)</strong></span>
</pre></div>
</td><td style="text-align: left" valign="top">
<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$db-&gt;students-&gt;insert(array("a" =&gt; 1, "b" =&gt; 1));</strong></span>
</pre></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>2.</p>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>SELECT a, b FROM students</strong></span>
</pre></div>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$db-&gt;students-&gt;find(array(), array("a" =&gt; 1, "b" =&gt; 1));</strong></span>
</pre></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3.</p>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>SELECT * FROM students WHERE age &lt; 15</strong></span>
</pre></div></td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$db-&gt;students-&gt;find(array("age" =&gt; array('$lt' =&gt; 15)));</strong></span>
</pre></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>4.</p>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>UPDATE students SET a=1 WHERE b='q'</strong></span>
</pre></div>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$db-&gt;students-&gt;update(array("b" =&gt; "q"), array('$set' =&gt; array("a" =&gt; 1)));</strong></span>
</pre></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5.</p>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>DELETE FROM students WHERE name="siddharth"</strong></span>
</pre></div>
</td><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$db-&gt;students-&gt;remove(array("name" =&gt; " siddharth"));</strong></span>
</pre></div>
</td></tr></tbody></table></div></div></div><div class="section" title="Installing rmongodb"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec78"/>Installing rmongodb</h2></div></div></div><p>To use <a id="id790" class="indexterm"/>MongoDB within R, we need to have installed R with the<a id="id791" class="indexterm"/> rmongodb library. We can install rmongodb from CRAN via <a id="id792" class="indexterm"/>the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># installing library rmongodb in R</strong></span>
<span class="strong"><strong>install.packages (rmongodb)</strong></span>
</pre></div></div><div class="section" title="Importing the data into R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec79"/>Importing the data into R</h2></div></div></div><p>We have <a id="id793" class="indexterm"/>learned how to install MongoDB in Ubuntu 12.04. Now, we can perform all the necessary operations on our data. In this section, we are going to learn how Mongo data can be handled and imported in R for data analytics activity. For loading the library we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># loading the library of rmongodb</strong></span>
<span class="strong"><strong>library (rmongodb)</strong></span>

<span class="strong"><strong>Mongo connection establishment</strong></span>
<span class="strong"><strong>mongo &lt;-mongo.create ()</strong></span>

<span class="strong"><strong>Check whether the normal series</strong></span>
<span class="strong"><strong>mongo.is.connected (mongo)</strong></span>

<span class="strong"><strong>Create a BSON object cache</strong></span>
<span class="strong"><strong>buf &lt;- mongo.bson.buffer.create ()</strong></span>

<span class="strong"><strong>Add element to the object buf</strong></span>
<span class="strong"><strong>mongo.bson.buffer.append (buf, "name", "Echo")</strong></span>
</pre></div><p>Objects of the <code class="literal">mongo.bson</code> class are used to store BSON documents. BSON is the form that MongoDB uses to store documents in its database. MongoDB network traffic also uses BSON messages:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>b &lt;- mongo.bson.from.list(list(name="Fred", age=29, city="Boston"))iter &lt;- mongo.bson.iterator.create(b)  # b is of class "mongo.bson"while (mongo.bson.iterator.next(iter))print(mongo.bson.iterator.value(iter))</strong></span>
</pre></div></div><div class="section" title="Understanding data manipulation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec80"/>Understanding data manipulation</h2></div></div></div><p>We will <a id="id794" class="indexterm"/>now see how Mongo data object can be operated within R:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># To check whether mongo is connected or not in R.</strong></span>
<span class="strong"><strong>if (mongo.is.connected(mongo)) {ns &lt;- "test.people"</strong></span>
<span class="strong"><strong>#Returns a fresh mongo.bson.buffer object ready to have data </strong></span>
<span class="strong"><strong>#appended onto it in R.buf &lt;- mongo.bson.buffer.create()mongo.bson.buffer.append(buf, "name", "Joe")criteria &lt;- mongo.bson.from.buffer(buf)</strong></span>

<span class="strong"><strong># mongo.bson.buffer objects are used to build mongo.bson objects.buf &lt;- mongo.bson.buffer.create()</strong></span>
<span class="strong"><strong>  mongo.bson.buffer.start.object(buf, "inc")mongo.bson.buffer.append(buf, "age", 1L)mongo.bson.buffer.finish.object(buf)objNew &lt;- mongo.bson.from.buffer(buf)# increment the age field of the first record   matching name "Joe"mongo.update(mongo, ns, criteria, objNew)</strong></span>

<span class="strong"><strong># mongo.bson.buffer objects are used to build mongo.bson objects.buf &lt;- mongo.bson.buffer.create()mongo.bson.buffer.append(buf, "name", "Jeff")criteria &lt;- mongo.bson.from.buffer(buf)</strong></span>

<span class="strong"><strong># mongo.bson.buffer objects are used to build mongo.bson objects.buf &lt;- mongo.bson.buffer.create()mongo.bson.buffer.append(buf, "name", "Jeff")mongo.bson.buffer.append(buf, "age", 27L)objNew &lt;- mongo.bson.from.buffer(buf)# update the entire record to { name: "Jeff", age: 27 }# where name equals "Jeff"# if such a record exists; otherwise, insert this as a new reordmongo.update(mongo, ns, criteria, objNew,mongo.update.upsert)# do a shorthand update:mongo.update(mongo, ns, list(name="John"), list(name="John", age=25))}</strong></span>
</pre></div></div></div>
<div class="section" title="Understanding SQLite"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec48"/>Understanding SQLite</h1></div></div></div><p>SQLite is <a id="id795" class="indexterm"/>a relational database management system developed with C programming language. SQLite is ACID compliant and implements most of the SQL standard. Unlike other database systems, SQLite doesn't have a standalone process to serve data to client applications. It's an embedded SQL database engine. SQLite system reads and writes directly to the system disk files because it's a file-based database. Related SQL database with multiple tables, indices, and views are contained there and this database file format is supported as cross-platform.</p><p>Quick understanding of ACID properties of transactions:</p><p>There are a set <a id="id796" class="indexterm"/>of properties that needs to be fulfilled to perform the transactions. They<a id="id797" class="indexterm"/> are Atomicity, Consistency, Isolation, and <a id="id798" class="indexterm"/>Durability. which are explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Atomicity refers to the guarantee that all the tasks of the database are performed.</li><li class="listitem" style="list-style-type: disc">Consistency ensures that the database remains in a consistent manner throughout, similar to how it was before we started.</li><li class="listitem" style="list-style-type: disc">Isolation refers to the requirement that other operations cannot access or see the data in an intermediate state during a transaction.</li><li class="listitem" style="list-style-type: disc">Durability refers to the guarantee that once the user has been notified of success, the transaction will persist, and not be undone. This means it will survive system failure, and that the database system has checked the integrity constraints and won't need to abort the transaction.</li></ul></div><div class="section" title="Understanding features of SQLite"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec81"/>Understanding features of SQLite</h2></div></div></div><p>The following<a id="id799" class="indexterm"/> are the features of SQLite database that follows ACID properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Zero configuration</li><li class="listitem" style="list-style-type: disc">Cross-platform-supported disk format</li><li class="listitem" style="list-style-type: disc">Faster than client-server type of database system</li><li class="listitem" style="list-style-type: disc">Easy to use API</li></ul></div><p>We will require the following prerequisites for using SQLite and R together:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">SQLite installation</li><li class="listitem" style="list-style-type: disc">RSQLite installation</li></ul></div></div><div class="section" title="Installing SQLite"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec82"/>Installing SQLite</h2></div></div></div><p>To install<a id="id800" class="indexterm"/> the<a id="id801" class="indexterm"/> SQLite database in Ubuntu, follow the given commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// install sqllite by firing the following commands</strong></span>
<span class="strong"><strong>sudo apt-get purge sqlite3 sqlite3-doc libsqlite3-0</strong></span>
<span class="strong"><strong>sudo apt-get autoremove</strong></span>
<span class="strong"><strong>sudo apt-get install sqlite3 sqlite3-doc</strong></span>
</pre></div></div><div class="section" title="Installing RSQLite"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec83"/>Installing RSQLite</h2></div></div></div><p>We<a id="id802" class="indexterm"/> can <a id="id803" class="indexterm"/>install RSQLite by following <a id="id804" class="indexterm"/>the given command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># installing RSQLite library from CRAN in R</strong></span>
<span class="strong"><strong>Install.packages("RSQLite")</strong></span>
</pre></div></div><div class="section" title="Importing the data into R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec84"/>Importing the data into R</h2></div></div></div><p>We <a id="id805" class="indexterm"/>will see how to insert the data into R with the RSQLite package.</p><p>To load an installed package, we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>#loading the installed package</strong></span>
<span class="strong"><strong>library("RSQLite")</strong></span>
</pre></div><p>With the following commands, you can connect to DB and list all tables from the database:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># connect to db</strong></span>
<span class="strong"><strong>con &lt;- dbConnect(SQLite(), dbname="data/first.db")</strong></span>

<span class="strong"><strong># list all tables</strong></span>
<span class="strong"><strong>tables &lt;- dbListTables(con)</strong></span>

<span class="strong"><strong># exclude sqlite_sequence (contains table information)</strong></span>
<span class="strong"><strong>tables &lt;- tables[tables != "sqlite_sequence"]</strong></span>
<span class="strong"><strong>lDataFrames &lt;- vector("list", length=length(tables))</strong></span>

<span class="strong"><strong># create a data.frame for each table</strong></span>
<span class="strong"><strong>for (i in seq(along=tables)) {</strong></span>
<span class="strong"><strong>  lDataFrames[[i]] &lt;- dbGetQuery(conn=con, statement=paste("SELECT * FROM '", tables[[i]], "'", sep=""))</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></div><div class="section" title="Understanding data manipulation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec85"/>Understanding data manipulation</h2></div></div></div><p>We <a id="id806" class="indexterm"/>can manipulate the dataset using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>dbBeginTransaction(con)</strong></span>
<span class="strong"><strong>rs &lt;- dbSendQuery(con, "DELETE from candidates WHERE age &gt; 50")</strong></span>
<span class="strong"><strong>Exporting the data from Rdata(USArrests)</strong></span>
<span class="strong"><strong>dbWriteTable(con, "USArrests", USArrests)</strong></span>
</pre></div></div></div>
<div class="section" title="Understanding PostgreSQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec49"/>Understanding PostgreSQL</h1></div></div></div><p>PostgreSQL is <a id="id807" class="indexterm"/>an open source object relational database management system. PostgreSQL runs on most of the operating systems such as Linux, UNIX, and Windows. It supports text, image, sound, and video data sources. It supports programming technologies such as C, C++, Java, Python, Ruby, and Tcl.</p><div class="section" title="Understanding features of PostgreSQL"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec86"/>Understanding features of PostgreSQL</h2></div></div></div><p>The following <a id="id808" class="indexterm"/>are the features of PostgreSQL:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Complex SQL queries</li><li class="listitem" style="list-style-type: disc">Fully ACID complaint</li><li class="listitem" style="list-style-type: disc">SQL subselects</li></ul></div><p>We need to have installed the following prerequisites for using PostgreSQL in R:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing Postgre SQL</li><li class="listitem" style="list-style-type: disc">Installing RPostgre SQL</li></ul></div></div><div class="section" title="Installing PostgreSQL"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec87"/>Installing PostgreSQL</h2></div></div></div><p>In<a id="id809" class="indexterm"/> this section, we will learn about installing PostgreSQL.</p><p>The given <a id="id810" class="indexterm"/>commands will be followed for the installation of PostgreSQL:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// updating the packages list</strong></span>
<span class="strong"><strong>Sudo apt-get update</strong></span>

<span class="strong"><strong>// installing postgresql </strong></span>
<span class="strong"><strong>sudo apt-get install postgresql postgresql-contrib</strong></span>

<span class="strong"><strong>// creating postgresql user</strong></span>
<span class="strong"><strong>su – postgres createuser</strong></span>
</pre></div></div><div class="section" title="Installing RPostgreSQL"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec88"/>Installing RPostgreSQL</h2></div></div></div><p>We <a id="id811" class="indexterm"/>will<a id="id812" class="indexterm"/> now see how to<a id="id813" class="indexterm"/> install and use RPostgreSQL:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># installing package from CRAN</strong></span>
<span class="strong"><strong>install.packages(RPostgreSQL)</strong></span>
<span class="strong"><strong>Importing the data into R# loading the installed package</strong></span>
<span class="strong"><strong>library(RPostgreSQL)</strong></span>

<span class="strong"><strong>## load the PostgreSQL driver</strong></span>
<span class="strong"><strong>drv &lt;- dbDriver("PostgreSQL")</strong></span>

<span class="strong"><strong>## Open a connection</strong></span>
<span class="strong"><strong>con &lt;- dbConnect(drv, dbname="oxford")</strong></span>

<span class="strong"><strong>## Submits a statement</strong></span>
<span class="strong"><strong>rs &lt;- dbSendQuery(con, "select * from student")</strong></span>

<span class="strong"><strong>## fetch all elements from the result set</strong></span>
<span class="strong"><strong>fetch(rs,n=-1)</strong></span>

<span class="strong"><strong>## Closes the connection</strong></span>
<span class="strong"><strong>dbDisconnect(con)</strong></span>

<span class="strong"><strong>## Frees all the resources on the driver</strong></span>
<span class="strong"><strong>dbUnloadDriver(drv)</strong></span>
</pre></div><p>With <a id="id814" class="indexterm"/>the<a id="id815" class="indexterm"/> following<a id="id816" class="indexterm"/> code, we will learn how to operate data stored at PostgreSQL from within R:</p><div class="informalexample"><pre class="programlisting">opendbGetQuery(con, "BEGIN TRANSACTION")
rs &lt;- dbSendQuery(con,
"Delete * from sales as p where p.cost&gt;10")
if(dbGetInfo(rs, what = "rowsAffected") &gt; 250){
  warning("Rolling back transaction")
  dbRollback(con)
}else{
  dbCommit(con)
}</pre></div></div><div class="section" title="Exporting the data from R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec89"/>Exporting the data from R</h2></div></div></div><p>In this <a id="id817" class="indexterm"/>section, we are going to learn how to load data, write the contents of the dataframe value into the table name specified, and remove the specified table from the database connection:</p><div class="informalexample"><pre class="programlisting">conn &lt;- dbConnect("PostgreSQL", dbname = "wireless")
if(dbExistsTable(con, "frame_fuel")){
  dbRemoveTable(conn, "frame_fuel")
  dbWriteTable(conn, "frame_fuel", fuel.frame)
}
if(dbExistsTable(conn, "RESULTS")){
  dbWriteTable(conn, "RESULTS", results2000, append = T)
  else
  dbWriteTable(conn, "RESULTS", results2000)
}</pre></div></div></div>
<div class="section" title="Understanding Hive"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Understanding Hive</h1></div></div></div><p>Hive is a <a id="id818" class="indexterm"/>Hadoop-based data warehousing-like framework developed by Facebook. It allows users to fire queries in SQL, with languages like HiveQL, which are highly abstracted to Hadoop MapReduce. This allows SQL programmers with no MapReduce experience to use the warehouse and makes it easier to integrate with business intelligence and visualization tools for real-time query processing.</p><div class="section" title="Understanding features of Hive"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec90"/>Understanding features of Hive</h2></div></div></div><p>The <a id="id819" class="indexterm"/>following are the features of Hive:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Hibernate Query Language (HQL)</li><li class="listitem" style="list-style-type: disc">Supports UDF</li><li class="listitem" style="list-style-type: disc">Metadata storage</li><li class="listitem" style="list-style-type: disc">Data indexing</li><li class="listitem" style="list-style-type: disc">Different storage type</li><li class="listitem" style="list-style-type: disc">Hadoop integration</li></ul></div><p>Prerequisites<a id="id820" class="indexterm"/> for RHive are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Hadoop</li><li class="listitem" style="list-style-type: disc">Hive</li></ul></div><p>We assume here that our readers have already configured Hadoop; else they can learn Hadoop installation from <a class="link" href="ch01.html" title="Chapter 1. Getting Ready to Use R and Hadoop">Chapter 1</a>, <span class="emphasis"><em>Getting Ready to Use R and Hadoop</em></span>. As Hive will be required for running RHive, we will first see how Hive can be installed.</p></div><div class="section" title="Installing Hive"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec91"/>Installing Hive</h2></div></div></div><p>The <a id="id821" class="indexterm"/>commands <a id="id822" class="indexterm"/>to install Hive are as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Downloading the hive source from apache mirror</strong></span>
<span class="strong"><strong>wget http://www.motorlogy.com/apache/hive/hive-0.11.0/hive-0.11.0.tar.gz</strong></span>

<span class="strong"><strong>// For extracting the hive source</strong></span>
<span class="strong"><strong>tar xzvf  hive-0.11.0.tar.gz</strong></span>
</pre></div><div class="section" title="Setting up Hive configurations"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec56"/>Setting up Hive configurations</h3></div></div></div><p>To setup<a id="id823" class="indexterm"/> Hive configuration, we need to update the <code class="literal">hive-site.xml</code> file with a few additions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Update <code class="literal">hive-site.xml</code> using <a id="id824" class="indexterm"/>the following commands:<div class="informalexample"><pre class="programlisting">&lt;description&gt; JDBC connect string for a JDBC metastore &lt;/ description&gt;
&lt;/Property&gt;

&lt;property&gt;
&lt;name&gt; javax.jdo.option.ConnectionDriverName &lt;/ name&gt;
&lt;value&gt; com.mysql.jdbc.Driver &lt;/ value&gt;
&lt;description&gt; Driver class name for a JDBC metastore &lt;/ description&gt;
&lt;/Property&gt;

&lt;property&gt;
&lt;name&gt; javax.jdo.option.ConnectionUserName &lt;/ name&gt;
&lt;value&gt; hive &lt;/value&gt;
&lt;description&gt; username to use against metastore database &lt;/ description&gt;
&lt;/ Property&gt;

&lt;property&gt;
&lt;name&gt; javax.jdo.option.ConnectionPassword &lt;/name&gt;
&lt;value&gt; hive&lt;/value&gt;
&lt;description&gt; password to use against metastore database &lt;/ description&gt;
&lt;/Property&gt;

&lt;property&gt;
&lt;name&gt; hive.metastore.warehouse.dir &lt;/ name&gt;
&lt;value&gt; /user/hive/warehouse &lt;/value&gt;
&lt;description&gt; location of default database for the warehouse &lt;/ description&gt;
&lt;/Property&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Update <code class="literal">hive-log4j.properties</code> by adding the following line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>log4j.appender.EventCounter = org.apache.hadoop.log.metrics.EventCounter</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">Update the environment variables by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>export $HIVE_HOME=/usr/local/ hive-0.11.0</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">In HDFS, create specific directories for Hive:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$HADOOP_HOME/bin/ hadoop fs-mkidr /tmp</strong></span>
<span class="strong"><strong>$HADOOP_HOME/bin/ hadoop fs-mkidr /user/hive/warehouse</strong></span>
<span class="strong"><strong>$HADOOP_HOME/bin/ hadoop fs-chmod g+w / tmp</strong></span>
<span class="strong"><strong>$HADOOP_HOME/bin/ hadoop fs-chmod g+w /user/hive/warehouse</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip26"/>Tip</h3><p>To <a id="id825" class="indexterm"/>start the hive server, the <code class="literal">hive --service hiveserver</code> command needs to be called from <code class="literal">HIVE_HOME</code>.</p></div></div></li></ul></div></div></div><div class="section" title="Installing RHive"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec92"/>Installing RHive</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Install <a id="id826" class="indexterm"/>the<a id="id827" class="indexterm"/> dependant<a id="id828" class="indexterm"/> library, <code class="literal">rjava</code>, using the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// for setting up java configuration variables</strong></span>
<span class="strong"><strong>sudo R CMD javareconf</strong></span>

<span class="strong"><strong>// Installing rJava package</strong></span>
<span class="strong"><strong>install.packages ("rJava")</strong></span>

<span class="strong"><strong>// Installing RHive package from CRAN</strong></span>
<span class="strong"><strong>install.packages("RHive")</strong></span>

<span class="strong"><strong>// Loading RHive library</strong></span>
<span class="strong"><strong>library("RHive")</strong></span>
</pre></div></li></ul></div></div><div class="section" title="Understanding RHive operations"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec93"/>Understanding RHive operations</h2></div></div></div><p>We will see <a id="id829" class="indexterm"/>how we can load and operate over Hive datasets in <a id="id830" class="indexterm"/>R using the RHive library:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To initialize RHive we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhive.init ()</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To connect with the Hive server we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhive.connect ("192.168.1.210")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To view all tables we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhive.list.tables ()</strong></span>
<span class="strong"><strong>             tab_name</strong></span>
<span class="strong"><strong>1 hive_algo_t_account</strong></span>
<span class="strong"><strong>2 o_account</strong></span>
<span class="strong"><strong>3 r_t_account</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To view the table structure we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhive.desc.table ('o_account');</strong></span>
<span class="strong"><strong>     col_name data_type comment</strong></span>

<span class="strong"><strong>1 id int</strong></span>
<span class="strong"><strong>2 email string</strong></span>
<span class="strong"><strong>3 create_date string</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To <a id="id831" class="indexterm"/>execute the HQL queries we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhive.query ("select * from o_account");</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To <a id="id832" class="indexterm"/>close connection to the Hive server we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhive.close()</strong></span>
</pre></div></li></ul></div></div></div>
<div class="section" title="Understanding HBase"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Understanding HBase</h1></div></div></div><p>Apache HBase is a distributed Big Data store for Hadoop. This allows random, real-time, read/write <a id="id833" class="indexterm"/>access to Big Data. This is designed as a column-oriented, data-storage model, innovated after being inspired by Google Big table.</p><div class="section" title="Understanding HBase features"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec94"/>Understanding HBase features</h2></div></div></div><p>Following <a id="id834" class="indexterm"/>are the features for HBase:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">RESTful web service with XML</li><li class="listitem" style="list-style-type: disc">Linear and modular scalability</li><li class="listitem" style="list-style-type: disc">Strict consistent reads and writes</li><li class="listitem" style="list-style-type: disc">Extensible shell</li><li class="listitem" style="list-style-type: disc">Block cache and Bloom filters for real-time queries</li></ul></div><p>Pre-requisites<a id="id835" class="indexterm"/> for RHBase are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Hadoop</li><li class="listitem" style="list-style-type: disc">HBase</li><li class="listitem" style="list-style-type: disc">Thrift</li></ul></div><p>Here we assume that users have already configured Hadoop for their Linux machine. If anyone wishes to know how to install Hadoop on Linux, please refer to <a class="link" href="ch01.html" title="Chapter 1. Getting Ready to Use R and Hadoop">Chapter 1</a>, <span class="emphasis"><em>Getting Ready to Use R and Hadoop</em></span>.</p></div><div class="section" title="Installing HBase"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec95"/>Installing HBase</h2></div></div></div><p>Following <a id="id836" class="indexterm"/>are<a id="id837" class="indexterm"/> the steps for installing HBase:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download <a id="id838" class="indexterm"/>the tar file of HBase and extract it:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>wget http://apache.cs.utah.edu/hbase/stable/hbase-0.94.11.tar.gz</strong></span>

<span class="strong"><strong>tar -xzf hbase-0.94.11.tar.gz</strong></span>
</pre></div></li><li class="listitem">Go to HBase <a id="id839" class="indexterm"/>installation directory and update the configuration files:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cd hbase-0.94.11/</strong></span>

<span class="strong"><strong>vi conf/hbase-site.xml</strong></span>
</pre></div></li><li class="listitem">Modify the configuration files:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Update <code class="literal">hbase-env.sh</code>.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>~ Vi conf / hbase-env.sh </strong></span>
</pre></div></li><li class="listitem">Set up the configuration for HBase:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  export JAVA_HOME = /usr/lib/jvm/java-6-sun</strong></span>
<span class="strong"><strong>  export HBASE_HOME = /usr/local/hbase-0.94.11</strong></span>
<span class="strong"><strong>  export HADOOP_INSTALL = /usr/local/hadoop</strong></span>
<span class="strong"><strong>  export HBASE_CLASSPATH = /usr/local/hadoop/conf</strong></span>
<span class="strong"><strong>  export HBASE_MANAGES_ZK = true</strong></span>
</pre></div></li><li class="listitem">Update <code class="literal">hbase-site.xmlzxml</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Vi conf / hbase-site.xml</strong></span>
</pre></div></li><li class="listitem">Change <code class="literal">hbase-site.cml</code>, which should look like the following code:<div class="informalexample"><pre class="programlisting">    &lt;configuration&gt;
      &lt;property&gt;
        &lt;name&gt; hbase.rootdir &lt;/name&gt;
        &lt;value&gt; hdfs://master:9000/hbase &lt;/value&gt;
      &lt;/Property&gt;

      &lt;property&gt;
        &lt;name&gt;hbase.cluster.distributed &lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
      &lt;/Property&gt;

      &lt;property&gt;
         &lt;name&gt;dfs.replication &lt;/name&gt;
         &lt;value&gt;1&lt;/value&gt;
      &lt;/Property&gt;

      &lt;property&gt;
        &lt;name&gt;hbase.zookeeper.quorum &lt;/name&gt;
        &lt;value&gt;master&lt;/value&gt;
      &lt;/Property&gt;

      &lt;property&gt;
          &lt;name&gt;hbase.zookeeper.property.clientPort &lt;/name&gt;
          &lt;value&gt;2181&lt;/value&gt;
      &lt;/Property&gt;

      &lt;property&gt;
        &lt;name&gt;hbase.zookeeper.property.dataDir &lt;/name&gt;
        &lt;value&gt;/root/hadoop/hdata&lt;/​​value&gt;
      &lt;/Property&gt;
    &lt;/ Configuration&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip27"/>Tip</h3><p>If a <a id="id840" class="indexterm"/>separate zookeper setup is used, the configuration <a id="id841" class="indexterm"/>needs to be changed.</p></div></div></li><li class="listitem">Copy the Hadoop environment configuration files and libraries.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Cp $HADOOP_HOME/conf/hdfs-site.xml $HBASE_HOME/conf</strong></span>
<span class="strong"><strong>Cp $HADOOP_HOME/hadoop-core-1.0.3.jar $HBASE_HOME/lib</strong></span>
<span class="strong"><strong>Cp $HADOOP_HOME/lib/commons-configuration-1.6.jar $HBASE_HOME/lib</strong></span>
<span class="strong"><strong>Cp $HADOOP_HOME/lib/commons-collections-3.2.1.jar $HBASE_HOME/lib</strong></span>
</pre></div></li></ol></div></li></ol></div></div><div class="section" title="Installing thrift"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec96"/>Installing thrift</h2></div></div></div><p>Following<a id="id842" class="indexterm"/> are<a id="id843" class="indexterm"/> the steps for installing thrift:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download <a id="id844" class="indexterm"/>the thrift source from the Internet and place it to client. We will do it with Ubuntu O.S 12.04:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>get http://archive.apache.org/dist/thrift/0.8.0/thrift-0.8.0.tar.gz</strong></span>
</pre></div></li><li class="listitem">To extract the downloaded <code class="literal">.tar.gz</code> file, use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>tar xzvf thrift-0.8.0.tar.gz</strong></span>
<span class="strong"><strong>cd thrift-0.8.0/</strong></span>
</pre></div></li><li class="listitem">Compile the configuration parameters:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>./Configure</strong></span>
</pre></div></li><li class="listitem">Install thrift:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Make</strong></span>
<span class="strong"><strong>Make install</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip28"/>Tip</h3><p>To <a id="id845" class="indexterm"/>start the <a id="id846" class="indexterm"/>HBase thrift server we<a id="id847" class="indexterm"/> need to call the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$HBASE_HOME/bin/hbase-daemon.sh start</strong></span>
</pre></div></div></div></li></ol></div></div><div class="section" title="Installing RHBase"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec97"/>Installing RHBase</h2></div></div></div><p>After <a id="id848" class="indexterm"/>installing<a id="id849" class="indexterm"/> HBase , we will see <a id="id850" class="indexterm"/>how to get the RHBase library.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To install <code class="literal">rhbase</code> we use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>wget https://github.com/RevolutionAnalytics/rhbase/blob/master/build/rhbase_1.2.0.tar.gz</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To install the downloaded package we use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>R CMD INSTALL rhbase_1.2.0.tar.gz</strong></span>
</pre></div></li></ul></div></div><div class="section" title="Importing the data into R"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec98"/>Importing the data into R</h2></div></div></div><p>Once RHBase <a id="id851" class="indexterm"/>is installed, we can load the dataset in R from HBase with the help of RHBase:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To list all tables we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.list.tables ()</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To create a new table we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.new.table ("student")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To display the table structure we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.describe.table("student_rhbase")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To read data we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.get ('student_rhbase', 'mary')</strong></span>
</pre></div></li></ul></div></div><div class="section" title="Understanding data manipulation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec99"/>Understanding data manipulation</h2></div></div></div><p>Now, we will <a id="id852" class="indexterm"/>see how to operate over the dataset of HBase from within R:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To create the table we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.new.table ("student_rhbase", "info")</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To insert the data we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.insert ("student_rhbase", list (list ("mary", "info: age", "24")))</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To <a id="id853" class="indexterm"/>delete a sheet we use:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hb.delete.table ('student_rhbase')</strong></span>
</pre></div></li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Summary</h1></div></div></div><p>In this chapter, we learned how various R packages that are integrated with various database systems and their data sets can be loaded in R to perform data analytics. Most of the popular database systems have their R packages to load the data, update, as well as query the data to analyze them.</p></div></body></html>
<html><head></head><body><div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Chapter 1. Python for Data Science"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title"><a id="ch01" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Chapter 1. Python for Data Science</h1></div></div></div><p class="calibre11">In this chapter, we will cover the following recipes:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">Using dictionary objects</li><li class="listitem">Working with a dictionary of dictionaries</li><li class="listitem">Working with tuples</li><li class="listitem">Using sets</li><li class="listitem">Writing a list</li><li class="listitem">Creating a list from another list - list comprehension</li><li class="listitem">Using iterators</li><li class="listitem">Generating an iterator and a generator</li><li class="listitem">Using iterables</li><li class="listitem">Passing a function as a variable</li><li class="listitem">Embedding functions in another function</li><li class="listitem">Passing a function as a parameter</li><li class="listitem">Returning a function</li><li class="listitem">Altering the function behavior with decorators</li><li class="listitem">Creating anonymous functions with lambda</li><li class="listitem">Using the map function</li><li class="listitem">Working with filters</li><li class="listitem">Using zip and izip</li><li class="listitem">Processing arrays from the tabular data</li><li class="listitem">Preprocessing the columns</li><li class="listitem">Sorting lists</li><li class="listitem">Sorting with a key</li><li class="listitem">Working with itertools</li></ul></div><div class="calibre2" title="Introduction"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec09" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Introduction</h1></div></div></div><p class="calibre11">The Python programming language provides a lot of built-in data structures and functions that are very handy for data science programming. In this chapter, we will look at some that are most frequently used. In the subsequent chapters, you will see that these will be used in various sections for different topics. A good grasp of these will help you in the long run to quickly bootstrap a program in order to handle data and develop algorithms.</p><p class="calibre11">While this chapter is a quick overview of handy data structures and methods, you will start discovering your own ways of combining these data structures to achieve your requirements as you become a seasoned Python user.</p><p class="calibre11">Each of these data structures have an utility, though different circumstances may require using two or more data structures in tandem to achieve your requirements. You will see this in action in some of the examples in this book.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Using dictionary objects"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec10" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Using dictionary objects</h1></div></div></div><p class="calibre11">In Python, containers are objects that can hold any number of arbitrary objects. They provide a way to <a id="id0" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>access the child objects and iterate over them. Dictionary, tuple, list, and set are container objects in Python. More container types are available with the <code class="literal">collections</code> module. Let's look at the dictionary object in detail in this section.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec13" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's look at an example Python script to understand how a dictionary operates. So, with a text, this script tries to get the word count, that is, how many times each word has appeared in the given text.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec14" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's proceed to demonstrate how to operate a dictionary in Python. Let's use a simple sentence to demonstrate the use of a dictionary. We will follow it up with an actual dictionary creation:</p><div class="calibre2"><pre class="programlisting"># 1.Load a variable with sentences
sentence = "Peter Piper picked a peck of pickled peppers A peck of pickled \
peppers Peter Piper picked If Peter Piper picked a peck of pickled \
peppers Wheres the peck of pickled peppers Peter Piper picked"


# 2.Initialize a dictionary object
word_dict = {}

# 3.Perform the word count
for word in sentence.split():
    if word not in word_dict:
        word_dict[word] =1
    else:  
        word_dict[word]+=1
# 4.print the outputprint (word_dict)</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec15" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">The preceding code<a id="id1" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> builds a word frequency table; every word and its frequency is calculated. The final print statement produces the following output:</p><div class="calibre2"><pre class="programlisting">{'a': 2, 'A': 1, 'Peter': 4, 'of': 4, 'Piper': 4, 'pickled': 4, 'picked': 4, 'peppers': 4, 'the': 1, 'peck': 4, 'Wheres': 1, 'If': 1}</pre></div><p class="calibre11">The preceding output is a key value pair. For each word (key), we have a frequency (value). A dictionary data structure is a hash map where values are stored against a key. In the preceding example, we used a string as a key; however, any other immutable data type can also be used as a key.</p><p class="calibre11">Refer to the following URL for a detailed discussion about mutable and immutable objections in <a id="id2" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>Python:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/reference/datamodel.html">https://docs.python.org/2/reference/datamodel.html</a>
</p><p class="calibre11">Similarly, values can be any data type including custom classes.</p><p class="calibre11">In step 2, we initialized the dictionary. Its empty when initialized. When a new key is added to a dictionary, accessing the dictionary through the new key will throw <code class="literal">KeyError</code>. In the preceding example in step 3, we included an if statement in the for loop to handle this situation. However, we can also use the following:</p><div class="calibre2"><pre class="programlisting">word_dict.setdefault(word,0)</pre></div><p class="calibre11">With every key access to the dictionary, this statement has to be repeated if we are adding elements to a dictionary in a loop, as in a loop, we are not aware of new keys. Rewriting step 3 using <code class="literal">setdefault</code> will look as follows:</p><div class="calibre2"><pre class="programlisting">for word in sentence.split():
word_dict.setdefault(word,0)
word_dict[word]+=1</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec16" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Python 2.5 and above has a class named <code class="literal">defaultdict</code>; it's in the <code class="literal">collections</code> module. This takes care of the <code class="literal">setdefault</code> action. A <code class="literal">defaultdict</code> class is invoked as follows:</p><div class="calibre2"><pre class="programlisting">from collections import defaultdict

sentence = "Peter Piper picked a peck of pickled peppers  A peck of pickled \
            peppers Peter Piper picked If Peter Piper picked a peck of pickled \
            peppers Wheres the peck of pickled peppers Peter Piper picked"

word_dict = defaultdict(int)

for word in sentence.split():
    word_dict[word]+=1print word_dict   </pre></div><p class="calibre11">As you have <a id="id3" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>noticed, we included <code class="literal">collections.defaultdict</code> in our code and initialized our dictionary. Note that the <code class="literal">int</code> parameter, <code class="literal">defaultdict</code>, takes a function as an argument. In this case, we passed the <code class="literal">int()</code> function and thus, when the dictionary encounters a key that was not seen before, it initializes the key with a value returned by the <code class="literal">int()</code> function, in this case, zero. We will use <code class="literal">defaultdict</code> later in this book.</p><div class="note" title="Note"><div class="inner"><h3 class="title5"><a id="note02" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Note</h3><p class="calibre19">A typical dictionary does not remember the order in which the keys were inserted. In its collections module, Python provides a container called <code class="literal">OrderedDict</code> that can remember the order in which the keys were inserted. See the<a id="id4" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> following Python documentation for more<a id="id5" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> details:</p><p class="calibre19">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/collections.html#collections.OrderedDict">https://docs.python.org/2/library/collections.html#collections.OrderedDict</a>
</p></div></div><p class="calibre11">Looping through a dictionary is very easy; using the keys() function provided in the dictionary, we can loop through the key and using values(), we can loop through the values or using items(), we can loop through both the keys and values. Look at the following example:</p><div class="calibre2"><pre class="programlisting">For key, value in word_dict.items():
print key,value</pre></div><p class="calibre11">In this example, using <code class="literal">dict.items()</code>, we can iterate through the keys and values present in the dictionary.</p><p class="calibre11">The Python documentation for dictionaries is very exhaustive and is a handy companion when working <a id="id6" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>with dictionaries:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/tutorial/datastructures.html#dictionaries">https://docs.python.org/2/tutorial/datastructures.html#dictionaries</a>
</p><p class="calibre11">Dictionaries are <a id="id7" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>very useful as an intermediate data structure. If your program uses JSON as a way to move around information between modules, dictionary is the right data type for the job. It is very convenient to load a dictionary from a JSON file and similarly dump a dictionary as JSON strings.</p><p class="calibre11">Python provides <a id="id8" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>us with libraries to handle JSON very efficiently:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/json.html">https://docs.python.org/2/library/json.html</a>
</p><p class="calibre11">Counter is a dictionary subclass to count the hashable objects. Our example of the word count can be easily<a id="id9" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> done using counter.</p><p class="calibre11">Look at the following example:</p><div class="calibre2"><pre class="programlisting">from collections import Counter

sentence = "Peter Piper picked a peck of pickled peppers  A peck of pickled \
            peppers Peter Piper picked If Peter Piper picked a peck of pickled \
            peppers Wheres the peck of pickled peppers Peter Piper picked"

words = sentence.split()

word_count = Counter(words)

print word_count['Peter']print word_dict   </pre></div><p class="calibre11">The output is<a id="id10" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> as follows and you can verify this output with the previous one:</p><div class="calibre2"><pre class="programlisting">Counter({'Peter': 4, 'of': 4, 'Piper': 4, 'pickled': 4, 'picked': 4, 'peppers': 4, 'peck': 4, 'a': 2, 'A': 1, 'the': 1, 'Wheres': 1, 'If': 1})</pre></div><p class="calibre11">You can <a id="id11" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>go through the following link to understand more about Counters:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/collections.html#collections.Counter">https://docs.python.org/2/library/collections.html#collections.Counter</a>
</p></div><div class="calibre2" title="See also"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec17" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>See also</h2></div></div></div><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><span class="strong1"><em class="calibre15">Working with Dictionary of Dictionaries</em></span> recipe in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch01.xhtml" title="Chapter 1. Python for Data Science">Chapter 1</a>,<span class="strong1"><em class="calibre15"> Using Python for Data Science</em></span></li></ul></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Working with a dictionary of dictionaries"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec11" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Working with a dictionary of dictionaries</h1></div></div></div><p class="calibre11">As we mentioned <a id="id12" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>earlier, the real power of these data structures lies in how creatively you can use them to achieve your tasks. Let's look at an example to understand how to use dictionaries in a dictionary.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec18" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Look at the following table:</p><div class="mediaobject"><img src="Images/B04041_01_1.jpg" alt="Getting ready" class="calibre20"/></div><p class="calibre11">In the first column, we have three users and the rest of the columns are movies. The cell values are ratings given by a user for a movie. Let's say we want to represent this in memory so that some other part of a larger code base can easily access this information. We will use a<a id="id13" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> dictionary of dictionaries to achieve this objective.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec19" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">We will create the <code class="literal">user_movie_rating</code> dictionary using an anonymous function to demonstrate the concept of a dictionary of dictionaries.</p><p class="calibre11">We will fill it with data to show the effective use of a dictionary of dictionaries:</p><div class="calibre2"><pre class="programlisting">from collections import defaultdict

user_movie_rating = defaultdict(lambda :defaultdict(int))

# Initialize ratings for Alice
user_movie_rating["Alice"]["LOR1"] =  4
user_movie_rating["Alice"]["LOR2"] =  5
user_movie_rating["Alice"]["LOR3"] =  3
user_movie_rating["Alice"]["SW1"]  =  5
user_movie_rating["Alice"]["SW2"]  =  3
print user_movie_rating</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec20" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">The <code class="literal">user_movie_rating</code> is a dictionary of dictionaries. As explained in the previous section, <code class="literal">defaultdict</code> takes a function for argument; in this case, we passed a built-in anonymous function, <code class="literal">lambda</code>, which returns a dictionary. So, every time a new key is passed to <code class="literal">user_movie_rating</code>, a new dictionary will be created for this key. We will see more about the <code class="literal">lambda</code> function in the subsequent section.</p><p class="calibre11">This way, we can access the rating of any user movie combination very quickly. Similarly, there are plenty of use cases where a dictionary of dictionaries comes in very handy.</p><p class="calibre11">As a closing note on the dictionary, I would like to mention that having a good grasp of the dictionary data structure will help ease a lot of your data science programming tasks. As we will see later, dictionaries are frequently used to store features and labels in machine<a id="id14" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> learning. The Python NLTK library uses a dictionary<a id="id15" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> extensively to store features in text mining:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://www.nltk.org/book/ch05.html">http://www.nltk.org/book/ch05.html</a>
</p><p class="calibre11">The section titled <span class="strong1"><em class="calibre15">Mapping words to Properties using Python Dictionaries</em></span> is a good read to understand how effectively dictionaries can be used.</p></div><div class="calibre2" title="See also"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec21" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>See also</h2></div></div></div><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><span class="strong1"><em class="calibre15">Creating Anonymous Functions</em></span> recipe in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch01.xhtml" title="Chapter 1. Python for Data Science">Chapter 1</a>,<span class="strong1"><em class="calibre15"> Using Python for Data Science</em></span></li></ul></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Working with tuples"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec12" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Working with tuples</h1></div></div></div><p class="calibre11">A tuple is a<a id="id16" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> type of container object known as sequence types in Python. Tuples are immutable and can have a heterogeneous sequence of elements separated by a comma and enclosed in parentheses. They support the following operations:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><code class="literal">in</code> and <code class="literal">not in</code></li><li class="listitem">Comparision, concatenation, slicing, and indexing</li><li class="listitem"><code class="literal">min()</code> and <code class="literal">max()</code></li></ul></div><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec22" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Rather than having a full program as we did with dictionaries, we will see tuples as fragmented codes where we will concentrate on the creation and manipulation activities.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec23" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's see <a id="id17" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>some scripts demonstrating the creation and manipulation<a id="id18" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> of tuples:</p><div class="calibre2"><pre class="programlisting"># 1.Ways of creating a tuple
a_tuple = (1,2,'a')
b_tuple =1,2,'c'

# 2.Accessing elements of a tuple through index
print b_tuple[0]
print b_tuple[-1]

# 3.It is not possible to change the value of an item in a tuple,
# for example the next statement will result in an error.
try:
    b_tuple[0] = 20
except:
    print "Cannot change value of tuple by index"    

# 4.Though tuples are immutable
# But elements of a tuple can be mutable objects,
# for instance a list, as in the following line of code
c_tuple =(1,2,[10,20,30])
c_tuple[2][0] = 100

# 5.Tuples once created cannot be extended like list, 
# however two tuples can be concatenated.

print a_tuple + b_tuple

# 6 Slicing of uples
a =(1,2,3,4,5,6,7,8,9,10)
print a[1:]
print a[1:3]
print a[1:6:2]
print a[:-1]

# 7.Tuple min max
print min(a),max(a)

# 8.in and not in
if 1 in a:
    print "Element 1 is available in tuple a"
else:
print "Element 1 is available in tuple a"</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec24" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we created a tuple. Though strictly speaking, the parentheses are not needed, still it's an option for better readability. As you can see, we created a heterogeneous tuple with numeric and string values. Step 2 details how the elements of a tuple can be accessed<a id="id19" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> through the index. Indices start from zero. A negative number can<a id="id20" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> be used to access the tuple in reverse. The output of the print statement is as follows:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; print b_tuple[0]
1
&gt;&gt;&gt; print b_tuple[-1]
c
&gt;&gt;&gt; </pre></div><p class="calibre11">The Python tuple indices start from 0. Tuples are immutable.</p><p class="calibre11">In step 3, we will look at the most important property of a tuple called immutability. It is not possible to change the value of an item in a tuple; step 3 will result in an error thrown by the interpreter:</p><div class="calibre2"><pre class="programlisting">Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: 'tuple' object does not support item assignment</pre></div><p class="calibre11">This may look restrictive; however, the immutable feature has immense value from a data science perspective.</p><div class="note" title="Note"><div class="inner"><h3 class="title5"><a id="tip02" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Tip</h3><p class="calibre19">While building programs for machine learning, in particular during the feature generation from raw data, creating feature tuples ensures that values cannot be changed by downstream programs.</p></div></div><p class="calibre11">As these features reside in a tuple, no downstream program can accidently change the feature values.</p><p class="calibre11">However, we want to point out that a tuple can have a mutable object as its member, for example, a list. If we have a tuple as shown in step 4, the third element of the tuple is a list. Now, let's try to change an element in the list:</p><div class="calibre2"><pre class="programlisting">c_tuple[2][0] = 100</pre></div><p class="calibre11">We will print the tuple as follows:</p><div class="calibre2"><pre class="programlisting">print  c_tuple</pre></div><p class="calibre11">We will get the following output:</p><div class="calibre2"><pre class="programlisting">(1, 2, [100, 20, 30])</pre></div><p class="calibre11">As you can see, the value of the first element in the list is changed to <code class="literal">100</code>.</p><p class="calibre11">In step 5, we concatenated two tuples. Another interesting way to use tuples is when different modules are creating different features for a machine learning program.</p><div class="note" title="Note"><div class="inner"><h3 class="title5"><a id="tip03" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Tip</h3><p class="calibre19">For example, let's say that you have one module that is creating a bag-of-words kind of feature and another module that is working on creating numerical features for a typical text classification program. These models can output the tuples and a final module can concatenate these tuples to get a full feature vector.</p></div></div><p class="calibre11">Due to its<a id="id21" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> immutable property, unlike a list, a tuple cannot be extended after <a id="id22" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>its creation. It does not support an <code class="literal">append</code> function. Another advantage of this immutable property is that a tuple can be used as a key in a dictionary.</p><div class="note" title="Note"><div class="inner"><h3 class="title5"><a id="tip04" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Tip</h3><p class="calibre19">Typically, when creating keys, we may need to concatenate different string values using custom separators to create a unique key. Instead, a tuple with these string values can be created to be used as a key.</p></div></div><p class="calibre11">This improves the program output readability and also avoids bugs from creeping in when the keys are combined manually.</p><p class="calibre11">In step 6, we will detail the slicing operations in a tuple. Typically, there are three numbers provided for the slicing and they are separated by a colon. The first number decides which index to start the slicing, the second one decides the ending index, and the last one is for step. The examples in step 6 will clarify this:</p><div class="calibre2"><pre class="programlisting">print a[1:]</pre></div><p class="calibre11">It prints the output as follows:</p><div class="calibre2"><pre class="programlisting">(2, 3, 4, 5, 6, 7, 8, 9, 10)</pre></div><p class="calibre11">In this case, we specified only the start index number, <code class="literal">1</code>. (Remember that indices start with zero.) We got a slice of the tuple starting from index, <code class="literal">1</code>. Let's see another example:</p><div class="calibre2"><pre class="programlisting">print a[1:3]</pre></div><p class="calibre11">It prints the output as follows:</p><div class="calibre2"><pre class="programlisting">(2, 3)</pre></div><p class="calibre11">Here, we specified the start index as <code class="literal">1</code> and end index as <code class="literal">3</code>.</p><div class="note" title="Note"><div class="inner"><h3 class="title5"><a id="note03" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Note</h3><p class="calibre19">Slicing operations are right-ended.</p></div></div><p class="calibre11">Though we specified the end index as <code class="literal">3</code>, the output will be returned till index <code class="literal">2</code>, that is, one before. Hence, we have <code class="literal">2</code> and <code class="literal">3</code> as a part of our output slice. Finally, let's provide all three parameters<a id="id23" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> and the start and end indices followed by the step<a id="id24" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> size:</p><div class="calibre2"><pre class="programlisting">print a[1:6:2]</pre></div><p class="calibre11">It displays the output as follows:</p><div class="calibre2"><pre class="programlisting">(2, 4, 6)</pre></div><p class="calibre11">Here, our step size is <code class="literal">2</code>. In addition to the start and end indices, we also specified the step size. Hence, it jumps two indices every time and produces the output as shown previously.</p><p class="calibre11">Let's look at the negative indexing:</p><div class="calibre2"><pre class="programlisting">print a[:-1]</pre></div><p class="calibre11">Here, we used the negative index. The output is as follows:</p><div class="calibre2"><pre class="programlisting">(1, 2, 3, 4, 5, 6, 7, 8, 9)</pre></div><p class="calibre11">Everything except the last element is returned in the slice:</p><div class="calibre2"><pre class="programlisting">print a[::-1]</pre></div><p class="calibre11">Food for thought, the output of the preceding statement is as follows—a curious reader should be able to figure out how we got the following output:</p><div class="calibre2"><pre class="programlisting">(10, 9, 8, 7, 6, 5, 4, 3, 2, 1)</pre></div><p class="calibre11">In step 7, we will show that we can use the <code class="literal">min()</code> and <code class="literal">max()</code> functions on a tuple to get the minimum and maximum value out of a tuple:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; print min(a), max(a)
1 10
&gt;&gt;&gt;</pre></div><p class="calibre11">In step 8, we will show the conditional operators in and not in; this can be effectively used to find out if an element is part of a tuple or not:</p><div class="calibre2"><pre class="programlisting">if 1 in a:
    print "Element 1 is available in tuple a"
else:
    print "Element 1 is available in tuple a"</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec25" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">As we saw in the preceding section, we accessed the elements of a tuple by their indices. For better program <a id="id25" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>readability, say that we want to have a name assigned to each <a id="id26" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>of the elements of a tuple and access the elements by their names. This is where namedtuple comes to our rescue. The following URL gives a good<a id="id27" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> documentation of namedtuple:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/collections.html#collections.namedtuple">https://docs.python.org/2/library/collections.html#collections.namedtuple</a>
</p><p class="calibre11">Let's look at a simple example to illustrate the use of a namedtuple:</p><div class="calibre2"><pre class="programlisting">from collections import namedtuple

vector = namedtuple("Dimension",'x y z')
vec_1 = vector(1,1,1)
vec_2 = vector(1,0,1)

manhattan_distance = abs(vec_1.x - vec_2.x) + abs(vec_1.y - vec_2.y) \
                            + abs(vec_1.z - vec_2.z)
                            
print "Manhattan distance between vectors = %d"%(manhattan_distance)</pre></div><p class="calibre11">You can see that we accessed the elements of <code class="literal">vec_1</code> and <code class="literal">vec_2</code> using object notation, <code class="literal">vec_1.x</code>, <code class="literal">vec_1.y</code>, and so on. Instead of using their indices, we now have a better readable program. <code class="literal">Vec_1.x</code> is equivalent to <code class="literal">vec_1[0]</code>.</p></div><div class="calibre2" title="See also"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec26" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>See also</h2></div></div></div><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><span class="strong1"><em class="calibre15">Data Analysis – Explore and Wrangle </em></span>recipe in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch03.xhtml" title="Chapter 3. Data Analysis – Explore and Wrangle">Chapter 3</a>, <span class="strong1"><em class="calibre15">Analyzing Data - Explore &amp; Wrangle </em></span>which represents the text as a Bag-of-words.</li></ul></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Using sets"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec13" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Using sets</h1></div></div></div><p class="calibre11">Sets are very<a id="id28" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> similar to list data structures except that they do not allow duplicates. It's an unordered collection of homogeneous elements. Typically, sets are used to remove the duplicate elements from a list. However, a set supports operations such as intersection, union, difference, and symmetric difference. These operations are very handy in a lot of use cases.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec27" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">In this section, we will write a small program to understand the various utilities of set data structures. In our example, we will calculate a similarity score between two sentences using Jaccard's coefficient. We will see in detail about Jaccard's coefficient and similar other measures in later chapters. Here is a quick introduction to this measure. Jaccard's coefficient is a number between zero and one, where one indicates a high similarity. It's calculated based on how many elements are common between the two sets.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec28" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's see some Python<a id="id29" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> scripts that are used for the set creation and manipulation:</p><div class="calibre2"><pre class="programlisting"># 1.Initialize two sentences.
st_1 = "dogs chase cats"
st_2 = "dogs hate cats"

# 2.Create set of words from strings
st_1_wrds = set(st_1.split())
st_2_wrds = set(st_2.split())

# 3.Find out the number of unique words in each set, vocabulary size.
no_wrds_st_1 = len(st_1_wrds)
no_wrds_st_2 = len(st_2_wrds)

# 4.Find out the list of common words between the two sets.
# Also find out the count of common words.
cmn_wrds = st_1_wrds.intersection(st_2_wrds)
no_cmn_wrds = len(st_1_wrds.intersection(st_2_wrds))

# 5.Get a list of unique words between the two sets.
# Also find out the count of unique words.
unq_wrds = st_1_wrds.union(st_2_wrds)
no_unq_wrds = len(st_1_wrds.union(st_2_wrds))

# 6.Calculate Jaccard similarity 
similarity = no_cmn_wrds / (1.0 * no_unq_wrds)

# 7.Let us now print to grasp our output.
print "No words in sent_1 = %d"%(no_wrds_st_1)
print "Sentence 1 words =", st_1_wrds
print "No words in sent_2 = %d"%(no_wrds_st_2)
print "Sentence 2 words =", st_2_wrds
print "No words in common = %d"%(no_cmn_wrds)
print "Common words =", cmn_wrds
print "Total unique words = %d"%(no_unq_wrds)
print "Unique words=",unq_wrds
print "Similarity = No words in common/No unique words, %d/%d = %.2f"%(no_cmn_wrds,no_unq_wrds,similarity)</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec29" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In steps 1 and 2, we took two sentences, split them into words, and created two sets using the <code class="literal">set()</code> function. The <code class="literal">set</code> function can be used to convert a list or tuple to a set. Look at the following code snippet:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; a =(1,2,1)
&gt;&gt;&gt; set(a)
set([1, 2])
&gt;&gt;&gt; b =[1,2,1]
&gt;&gt;&gt; set(b)
set([1, 2]</pre></div><p class="calibre11">In this example, <code class="literal">a</code> is a tuple and <code class="literal">b</code> is a list. With the <code class="literal">set()</code> function, the duplicates are eliminated and a set object is returned. The <code class="literal">st_1.split()</code> and <code class="literal">st_2.split()</code> method return a list and we will pass it to a set function to get the set objects.</p><p class="calibre11">Let's now calculate the similarity score between two sentences using Jaccard's coefficient. We will see in detail about Jaccard's coefficient and similar other measures in the similarity measures section in a later chapter. We will leverage the <code class="literal">union()</code> and <code class="literal">intersection()</code> functions available with the sets to calculate the similarity score.</p><p class="calibre11">In step 4, we will perform two operations. First, using the <code class="literal">intersection()</code> function, we will try to find out what words are common between the sets. The common words between the two sentences are <code class="literal">'cats'</code> and <code class="literal">'dogs'</code>. Followed by this, we will find out the count of the common words, which is two. In the next step, we will find out the list of unique words between the two sets using the <code class="literal">union()</code> function. The unique words between these two sentences are <code class="literal">'cats'</code>, <code class="literal">'hate'</code>, <code class="literal">'dogs'</code>, and <code class="literal">'chase'</code>. This is sometimes referred to as vocabulary in natural language processing. Finally, we will calculate Jaccard's coefficient in step 6, which is the ratio of a count of the common words between the two sets to a count of the unique words between the two sets.</p><p class="calibre11">The output<a id="id30" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> of this program looks as follows:</p><div class="calibre2"><pre class="programlisting">No words in sent_1 = 3
Sentence 1 words = set(['cats', 'dogs', 'chase'])
No words in sent_2 = 3
Sentence 2 words = set(['cats', 'hate', 'dogs'])
No words in common = 2
Common words = set(['cats', 'dogs'])
Total unique words = 4
Unique words= set(['cats', 'hate', 'dogs', 'chase'])
Similarity = No words in common/No unique words, 2/4 = 0.50</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec30" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">We gave the preceding example to represent the usage of the set functions. However, you can use the built-in functions from libraries such as scikit-learn. Going forward, we will leverage as much of these functions from libraries as possible, instead of hand coding these utility functions:</p><div class="calibre2"><pre class="programlisting"># Load libraries
from sklearn.metrics import jaccard_similarity_score

# 1.Initialize two sentences.
st_1 = "dogs chase cats"
st_2 = "dogs hate cats"

# 2.Create set of words from strings
st_1_wrds = set(st_1.split())
st_2_wrds = set(st_2.split())

unq_wrds = st_1_wrds.union(st_2_wrds)

a  =[ 1 if w in st_1_wrds else 0 for w in unq_wrds ]
b  =[ 1 if w in st_2_wrds else 0 for w in unq_wrds]

print a
print b
print jaccard_similarity_score(a,b)</pre></div><p class="calibre11">The output is as follows:</p><div class="calibre2"><pre class="programlisting">[1, 0, 1, 1]
[1, 1, 1, 0]
0.5</pre></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Writing a list"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec14" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Writing a list</h1></div></div></div><p class="calibre11">A list is a<a id="id31" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> container object and sequence type. They are similar to tuples except that they are homogenous and mutable. A list allows append operations. They can also be used as either a stack or queue. Unlike tuples, lists are expandable; you can add elements to a list using the append function after its creation.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec31" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Similar to how we saw tuples, we will see lists as fragmented codes where we will concentrate on the creation and manipulation activity instead of having a full program as we did with dictionaries.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec32" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's look at some Python scripts demonstrating the list creation and manipulation activities:</p><div class="calibre2"><pre class="programlisting"># 1.Let us look at a quick example of list creation. 
a = range(1,10)
print a
b = ["a","b","c"]
print b

# 2.List can be accessed through indexing. Indexing starts at 0.
print a[0]

# 3.With negative indexing the elements of a list are accessed from backwards.
a[-1]

# 4.Slicing is accessing a subset of list by providing two indices.
print a[1:3]  # prints [2, 3]
print a[1:]   # prints [2, 3, 4, 5, 6, 7, 8, 9]
print a[-1:]  # prints [9]
print a[:-1]  # prints [1, 2, 3, 4, 5, 6, 7, 8]

#5.List concatenation
a = [1,2]
b = [3,4]
print a + b # prints [1, 2, 3, 4]

# 6.	List  min max
print min(a),max(a)

# 7.	in and not in
if 1 in a:
    print "Element 1 is available in list a"
else:
    print "Element 1 is available in tuple a"

# 8. Appending and extending list
a = range(1,10)
print a
a.append(10)
print a

# 9.List as a stack
a_stack = []

a_stack.append(1)
a_stack.append(2)
a_stack.append(3)

print a_stack.pop()
print a_stack.pop()
print a_stack.pop()

# 10.List as queue
a_queue = []

a_queue.append(1)
a_queue.append(2)
a_queue.append(3)

print a_queue.pop(0)
print a_queue.pop(0)
print a_queue.pop(0)


# 11.	List sort and reverse
from random import shuffle
a = range(1,20)
shuffle(a)
print a
a.sort()
print a

a.reverse()
print a</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec33" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we saw different ways of creating a list. Note that we have only homogeneous elements. There <a id="id32" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>can be duplicates unlike a set. Steps 2,3,4,5,6, and 7 are similar to the tuple steps. We will not elaborate on these steps. They cover the indexing, slicing, concatenation, minmax, and in and not in operations similar to a tuple.</p><p class="calibre11">Step 8 presents the append and extend operations. This is where a list starts to differ from a tuple. (Of course, we know that these lists are homogeneous.) Let's look at the output of the first part of the code:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; a = range(1,10)
&gt;&gt;&gt; print a

[1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt; a.append(10)
&gt;&gt;&gt; print a
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
&gt;&gt;&gt;</pre></div><p class="calibre11">We can see that 10 is added to the <code class="literal">a</code> list.</p><p class="calibre11">The following output is of the second part where extend is shown:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; b=range(11,15)
&gt;&gt;&gt; a.extend(b)
&gt;&gt;&gt; print a
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
&gt;&gt;&gt;</pre></div><p class="calibre11">We extended the original <code class="literal">a</code> list by another list, <code class="literal">b</code>.</p><p class="calibre11">In step 9, we will show how a list can be used as a stack. The <code class="literal">pop()</code> function helps to retrieve the last element appended to the list. The output is as follows:</p><div class="calibre2"><pre class="programlisting">3
2
1</pre></div><p class="calibre11">The last element to be appended is the first element to be retrieved <span class="strong1"><strong class="calibre12">Last In, First Out </strong></span>(<span class="strong1"><strong class="calibre12">LIFO</strong></span>) style <a id="id33" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>as in stacks.</p><p class="calibre11">In step 10, we will implement a queue using a list. The <code class="literal">pop()</code> function with zero as a parameter indicates that the index of the element to be retrieved has been passed. The output is as follows:</p><div class="calibre2"><pre class="programlisting">1
2
3</pre></div><p class="calibre11">The output <a id="id34" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>adheres to the LIFO style of a queue. However, this is not a very efficient method. Popping the first element is not optimal because of the way a list is implemented. An efficient way to perform this operation is to use the deque data structure explained in the next section.</p><p class="calibre11">The final step details the sort and reverse operations in a list. A list has a built-in function, <code class="literal">sort()</code>, to sort the elements of a list. By default, it sorts in an ascending order. Sorting is explained in detail in a later section of this chapter. The <code class="literal">reverse()</code> function will reverse the elements of a list.</p><p class="calibre11">We will first create a list with elements from 1 to 19:</p><div class="calibre2"><pre class="programlisting">a = range(1,20)</pre></div><p class="calibre11">We will shuffle the elements using the <code class="literal">shuffle()</code> function from a module random. This shuffles the elements so that we can demonstrate the sort operations. The shuffled output is as follows:</p><div class="calibre2"><pre class="programlisting">[19, 14, 11, 12, 4, 13, 17, 5, 2, 3, 1, 16, 8, 15, 18, 6, 7, 9, 10]</pre></div><p class="calibre11">Now, <code class="literal">a.sort()</code> does an in-place sort and when we print a, we will get the following output:</p><div class="calibre2"><pre class="programlisting">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]</pre></div><p class="calibre11">The <code class="literal">a.reverse()</code> is also an in-place operation that produces the following output:</p><div class="calibre2"><pre class="programlisting">[19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec34" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">The deque<a id="id35" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> stands for double-ended queue. Unlike stack and queues, which can be appended and popped in only one direction, the append and pop operations can be done at <a id="id36" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>both ends with deque:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/collections.html#collections.deque">https://docs.python.org/2/library/collections.html#collections.deque</a>
</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Creating a list from another list - list comprehension"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec15" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Creating a list from another list - list comprehension</h1></div></div></div><p class="calibre11">Comprehension<a id="id37" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is a way to create a sequence from another sequence. For <a id="id38" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>example, we can create a list from another list or tuple. Let's look at a list comprehension. Typically, a list comprehension involves the following features:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">A sequence, say a list whose elements we are interested in</li><li class="listitem">A variable representing the elements of the sequence</li><li class="listitem">An output expression that is responsible for producing the output sequence using the elements of the input sequence</li><li class="listitem">An optional predicate expression</li></ul></div><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec35" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's define a simple problem in order to understand all the different elements involved in comprehension. With an input list with positive and negative numbers, we need an output list that is the square of all the negative elements.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec36" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">In the following script, we will show a simple example of list comprehension:</p><div class="calibre2"><pre class="programlisting"># 1.	Let us define a simple list with some positive and negative numbers.
a = [1,2,-1,-2,3,4,-3,-4]

# 2.	Now let us write our list comprehension.
# pow() a power function takes two input and
# its output is the first variable raised to the power of the second.
b = [pow(x,2) for x in a if x &lt; 0]

# 3.	Finally let us see the output, i.e. the newly created list b.
print b</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec37" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">This example is written in a way to explain the various components of comprehension. Let's look at step 2:</p><div class="calibre2"><pre class="programlisting">b = [pow(x,2) for x in a if x &lt; 0]</pre></div><p class="calibre11">This code is explained as follows:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">Our input list is <code class="literal">a</code> and output list is <code class="literal">b</code></li><li class="listitem">We will use a variable <code class="literal">x</code> to represent each element in the list</li><li class="listitem">The <code class="literal">pow(x,2)</code> is the output expression, which uses the elements in the input to produce the output list</li><li class="listitem">Finally, <code class="literal">if</code> <code class="literal">x &lt; 0</code> is the predicate expression that controls which elements of the input list are used to produce the output list</li></ul></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec38" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">The comprehension<a id="id39" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> syntax is exactly the same as a dictionary. A simple example will illustrate the following:</p><div class="calibre2"><pre class="programlisting">a = {'a':1,'b':2,'c':3}
b = {x:pow(y,2) for x,y in a.items()}
print b</pre></div><p class="calibre11">In the preceding example, we created a new dictionary, b from the input dictionary, a. The output is as follows:</p><div class="calibre2"><pre class="programlisting">{'a': 1, 'c': 9, 'b': 4}</pre></div><p class="calibre11">You can see that we retained the keys of the <code class="literal">a</code> dictionary, but now the new values are a square of the original values in a. A point to note is the use of curly bracelets instead of brackets during the comprehension.</p><p class="calibre11">We can do comprehension for tuples with a small trick. See the following example:</p><div class="calibre2"><pre class="programlisting">def process(x):
    if isinstance(x,str):
        return x.lower()
    elif isinstance(x,int):
        return x*x
    else:
        return -9

a = (1,2,-1,-2,'D',3,4,-3,'A')
b = tuple(process(x) for x in a )

print b</pre></div><p class="calibre11">Instead of the <code class="literal">pow()</code> function, we used a new process function. I will leave it to you as an exercise to decipher what the process function does. Note that we followed the same syntax for a comprehension list; however, we used braces instead of brackets. The output of this program is as follows:</p><div class="calibre2"><pre class="programlisting">&lt;generator object &lt;genexpr&gt; at 0x05E87D00&gt;</pre></div><p class="calibre11">Oops! We wanted a tuple but ended up with a generator (more on generators in the later sections). The right way to do it is as follows:</p><div class="calibre2"><pre class="programlisting">b = tuple(process(x) for x in a )</pre></div><p class="calibre11">Now, the print b <a id="id40" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>statement will produce the following output:</p><div class="calibre2"><pre class="programlisting">(1, 4, 1, 4, 'd', 9, 16, 9, 'a')</pre></div><p class="calibre11">Python <a id="id41" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>comprehension is based on the set builder notation:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://en.wikipedia.org/wiki/Set-builder_notation">http://en.wikipedia.org/wiki/Set-builder_notation</a>
</p><p class="calibre11">Itertools.dropwhile:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/itertools.html#itertools.dropwhile">https://docs.python.org/2/library/itertools.html#itertools.dropwhile</a>
</p><p class="calibre11">With a predicate <a id="id42" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>and sequence, dropwhile will return only those items in the sequence that satisfies the predicate.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Using iterators"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec16" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Using iterators</h1></div></div></div><p class="calibre11">It's a no-brainer that a key input for a data science program is data. Data may vary in size—some of them may fit into memory and some may not. The record access mechanism can<a id="id43" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> vary from one data format to another. Interestingly, different algorithms may demand chunks of varying length to process. For example, let's say that you are writing a stochastic gradient descent algorithm and you want to pass chunks of 5,000 records in each epoch, it will be very nice to have an abstraction that can handle the accessing of the data, understanding the data format, looping through the data, and providing the caller with the required data. This will result in a clean code. Most of the time, the interesting part lies in what we do with the data and not how we access the data. Python provides us with an elegant way in the form of iterators to handle all of these requirements.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec39" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">An iterator in Python implements an iterator pattern. It allows us to go over a sequence one by one without materializing the whole sequence!</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec40" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's create a simple iterator called simple counter and provide it with some code on how to effectively use the iterator:</p><div class="calibre2"><pre class="programlisting"># 1.	Let us write a simple iterator.
class SimpleCounter(object):
    def __init__(self, start, end):
        self.current = start
        self.end = end

    def __iter__(self):
        'Returns itself as an iterator object'
        return self

    def next(self):
        'Returns the next value till current is lower than end'
        if self.current &gt; self.end:


            raise StopIteration
        else:
            self.current += 1
            return self.current - 1
            
# 2.	Now let us try to access the iterator
c = SimpleCounter(1,3)
print c.next()
print c.next()
print c.next()
print c.next()


# 3.	Another way to access
for entry in iter(c):
    print entry     </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec41" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we <a id="id44" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>defined a class by the name of <code class="literal">SimpleCounter</code>. The <code class="literal">__init__</code> constructor takes two parameters, <code class="literal">start</code> and <code class="literal">end,</code> defining the beginning and end of our sequence. Note the two methods, <code class="literal">__iter__</code> and <code class="literal">next</code>. Any object in Python that is meant to be an iterator object should support these two functions. The <code class="literal">__iter__</code> returns the complete class object as an iterator object. The <code class="literal">next</code> method returns the next value in the iterator.</p><p class="calibre11">As shown in step 2, we can access the successive elements in the iterator using the <code class="literal">next()</code> function. Python also provides us with a convenient function, <code class="literal">iter()</code>, which can be used in a loop to access elements sequentially as shown in step 3. The <code class="literal">iter()</code> uses the <code class="literal">next()</code> function internally.</p><p class="calibre11">A point to note is that an iterator object can be used only once. After running the preceding code, we will try to access the iterator as follows:</p><div class="calibre2"><pre class="programlisting">print next(c)</pre></div><p class="calibre11">It will throw<a id="id45" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the StopIteration exception. Calling <code class="literal">c.next()</code> after the sequence has exhausted will result in a StopIteration exception:</p><div class="calibre2"><pre class="programlisting">    raise StopIteration
StopIteration
&gt;&gt;&gt;</pre></div><p class="calibre11">The <code class="literal">iter()</code> function handles this exception and exits the loop once the data has been exhausted.</p></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec42" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Let's see another example of an iterator. Let's say that we need to access a very large file in our program; however, in our program, we will work through it only one line at a time:</p><div class="calibre2"><pre class="programlisting">f = open(some_file_of_interest)
for l in iter(f):
print l
f.close()</pre></div><p class="calibre11">In Python, a file object is an iterator; it supports the <code class="literal">iter()</code> and <code class="literal">next()</code> functions. Hence, instead of loading the whole file in memory, we can work with a single line at a time.</p><p class="calibre11">An iterator gives you the power to write custom code in order to access your data sources in a manner that your application demands.</p><p class="calibre11">The following link provides more information about how iterators can be used in various ways in Python:</p><p class="calibre11">Infinite<a id="id46" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> iterators, <code class="literal">count()</code>, <code class="literal">cycle()</code> and <code class="literal">repeat()</code> in itertools:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/itertools.html#itertools.cycle">https://docs.python.org/2/library/itertools.html#itertools.cycle</a>
</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Generating an iterator and a generator"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec17" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Generating an iterator and a generator</h1></div></div></div><p class="calibre11">We saw <a id="id47" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>what an iterator is in the previous recipe; now in this one, let's see<a id="id48" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> how to generate an iterator.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec43" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Generators provide a clean syntax to loop through a sequence of values eliminating the need to have the two functions, __iter__ and next(). We don't have to write a class. A point to note is that both generators and iterables produce an iterator.</p></div><div class="calibre2" title="How it do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec44" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it do it…</h2></div></div></div><p class="calibre11">Let's have a <a id="id49" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>look the following example; it should be easy to follow if you <a id="id50" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>understood comprehension from the previous section. In this case, we have a generator comprehension. If you recall, we tried doing a tuple comprehension in this way and got a generator object:</p><div class="calibre2"><pre class="programlisting">SimpleCounter  = (x**2 for x in range(1,10))

tot = 0
for val in SimpleCounter:
    tot+=val

print tot    </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec45" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">It should be clear that the preceding code snippet will find the sum of the squares of a given range; in this case, the range is 1 to 9. (The range function in Python is right-ended.) Using a generator, we created an iterator called <code class="literal">SimpleCounter</code> and we use it in a <code class="literal">for</code> loop in order to access the underlying data sequentially. Note that we have not used the <code class="literal">iter()</code> function here. Notice how clean the code is. We successfully recreated our old <code class="literal">SimpleCounter</code> class in a very elegant manner.</p></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec46" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Let's look at how to use the yield statement to create a generator:</p><div class="calibre2"><pre class="programlisting">def my_gen(low,high):
    for x in range(low,high):
        yield x**2

tot = 0     
   
for val in my_gen(1,10):
    tot+=val
print tot    </pre></div><p class="calibre11">In the preceding example, the <code class="literal">my_gen()</code> function is a generator; we used the yield statement to return the output in a sequence.</p><p class="calibre11">In the previous <a id="id51" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>section, we mentioned that both a generator and iterables produce<a id="id52" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> an iterator. Let's validate this by trying to call the generator using the <code class="literal">iter</code> function:</p><div class="calibre2"><pre class="programlisting">gen = (x**2 for x in range(1,10))

for val in iter(gen):
    print val</pre></div><p class="calibre11">Before we move on to iterables in our next recipe, a key point to note with a generator is that once we have gone through the sequence, we are done—no more data.</p><div class="note" title="Note"><div class="inner"><h3 class="title5"><a id="note04" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Note</h3><p class="calibre19">With a generator object, we can go over the sequence only once.</p></div></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Using iterables"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec18" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Using iterables</h1></div></div></div><p class="calibre11">Iterables are similar to generators except for a key difference, we can go on and on with an iterable, that is, once we have exhausted all the elements in a sequence, we can again start accessing it <a id="id53" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>from the beginning unlike a generator.</p><p class="calibre11">They are object-based generators that do not hold any state. Any class with the <code class="literal">iter</code> method that yields data can be used as a stateless object generator.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec47" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's try to understand iterables with a simple example. This recipe should be easy to follow if you have understood the previous recipes on generators and iterators.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec48" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's create a simple iterable called SimpleIterable and show some scripts that manipulate it:</p><div class="calibre2"><pre class="programlisting"># 1.	Let us define a simple class with __iter__ method.
class SimpleIterable(object):
    def __init__(self, start, end):
        self.start = start
        self.end = end

    def __iter__(self):
        for x in range(self.start,self.end):
            yield x**2

#  Now let us invoke this class and iterate over its values two times.
c = SimpleIterable(1,10)

# First iteration
tot = 0
for val in iter(c):
    tot+=val

print tot

# Second iteration
tot =0
for val in iter(c):
    tot+=val

print tot</pre></div></div><div class="calibre2" title="How it works.."><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec49" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works..</h2></div></div></div><p class="calibre11">In step 1, we <a id="id54" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>created a simple class that is our iterable. The init constructor takes two arguments, start and end, similar to our earlier example. We defined a function called iter, which will give us our required sequence. In this given range of numbers, the square of these numbers will be returned.</p><p class="calibre11">Next, we have two loops. We iterated through our range of numbers, 1 to 10, in the first loop. When we will run the second for loop, you will notice that it once again iterates through the sequence and doesn't raise any exceptions.</p></div><div class="calibre2" title="See also"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec50" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>See also</h2></div></div></div><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><span class="strong1"><em class="calibre15">Using Iterators</em></span> recipe in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch01.xhtml" title="Chapter 1. Python for Data Science">Chapter 1</a>, <span class="strong1"><em class="calibre15">Using Python for Data Science</em></span></li><li class="listitem"><span class="strong1"><em class="calibre15">Generating an Iterator - Generators </em></span>recipe in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch01.xhtml" title="Chapter 1. Python for Data Science">Chapter 1</a>, <span class="strong1"><em class="calibre15">Using Python for Data Science</em></span></li></ul></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Passing a function as a variable"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec19" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Passing a function as a variable</h1></div></div></div><p class="calibre11">Python supports functional programming in addition to imperative paradigms. In the previous <a id="id55" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>sections, we have seen some functional programming constructs without an explicit explanation. Let's go over them in this section. Functions are first-class citizens in Python. They have attributes and they can be referenced and assigned to a variable.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec51" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's look at the paradigm of passing a function as a variable in Python in this section.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec52" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's define a <a id="id56" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>simple function and see how it can be used as a variable:</p><div class="calibre2"><pre class="programlisting"># 1.Let us define a simple function.
def square_input(x):
    return x*x
# We will follow it by assigning that function to a variable
square_me = square_input

# And finally invoke the variable
print square_me(5)    </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec53" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">We defined a simple function in step 1; with an input, the function returns the square of the input. We assigned this function to a <code class="literal">square_me</code> variable. Finally, we were able to invoke the function by calling <code class="literal">square_me</code> with a valid parameter. This demonstrates how a function can be treated as a variable in Python. This is a very import functional programming construct.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Embedding functions in another function"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec20" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Embedding functions in another function</h1></div></div></div><p class="calibre11">This recipe <a id="id57" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>will explain yet another functional programming construct; defining a function in another function.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec54" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's take a simple example of writing a function, which will return the sum of the squares of the given input list.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec55" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's write a simple function to demonstrate a function in another function:</p><div class="calibre2"><pre class="programlisting"># 1.	Let us define a function of function to find the sum of squares of the given input
def sum_square(x):
    def square_input(x):
        return x*x
    return sum([square_input(x1) for x1 in x])

# Print the output to check for correctness
print sum_square([2,4,5])    </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec56" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, you<a id="id58" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> can see that we defined a <code class="literal">square_input()</code> function in the <code class="literal">sum_square()</code> function. The parent function uses it to perform the sum of squares operation. In the next step, we called the function and printed its output.</p><p class="calibre11">The output produced was as follows:</p><div class="calibre2"><pre class="programlisting">[4, 9, 16]</pre></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Passing a function as a parameter"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec21" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Passing a function as a parameter</h1></div></div></div><p class="calibre11">Python supports higher order functions, that is, functions that can accept other functions as arguments.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec57" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's leverage<a id="id59" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the <code class="literal">square_input</code> function defined in the previous example and write a code snippet that will demonstrate how functions can be passed as parameters.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec58" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's now demonstrate how to pass a function as a parameter:</p><div class="calibre2"><pre class="programlisting">from math import log

def square_input(x):
    return x*x

# 1.	Define a generic function, which will take another function as input
# and will apply it on the given input sequence.
def apply_func(func_x,input_x):
    return map(func_x,input_x)
    
# Let us try to use the apply_func() and verify the results  
a = [2,3,4]

print apply_func(square_input,a)
print apply_func(log,a)    </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec59" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we <a id="id60" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>defined a <code class="literal">apply_func</code> function with two variables. The first variable is a function and second one is a sequence. As you can see, we used the map function (more on this function in the recipes to follow) to apply the given function to all the elements of the sequence.</p><p class="calibre11">Next, we invoked <code class="literal">apply_func</code> on a list a; first with the <code class="literal">square_input</code> function followed by a <code class="literal">log</code> function. The output is as follows:</p><div class="calibre2"><pre class="programlisting">[4, 9, 16]</pre></div><p class="calibre11">As you can see, the elements of a are all squared. The map applies the square_input function to all the elements in the sequence:</p><div class="calibre2"><pre class="programlisting">[0.69314718055994529, 1.0986122886681098, 1.3862943611198906]</pre></div><p class="calibre11">Similarly, log is applied on all the elements in the sequence.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Returning a function"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec22" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Returning a function</h1></div></div></div><p class="calibre11">In this <a id="id61" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>section, let's look at the functions that will return another function.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec60" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's take a high school example and try to explain the use of functions returning functions.</p><p class="calibre11">Our problem is we are given a cylinder of radius r and we would like to know the volume of it for different heights:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://www.mathopenref.com/cylindervolume.html">http://www.mathopenref.com/cylindervolume.html</a>
</p><div class="calibre2"><pre class="programlisting">Volume = area * height = pi * r^2 * h</pre></div><p class="calibre11">The preceding formula gives the exact cubic units that will fill a cylinder.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec61" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's write a simple function to demonstrate the concept of a function returning a function. In addition, we will write a small piece of code to show the usage:</p><div class="calibre2"><pre class="programlisting"># 1.	Let us define a function which will explain our
#  concept of function returning a function.
def cylinder_vol(r):
    pi = 3.141
    def get_vol(h):
        return pi * r**2 * h
    return get_vol

# 2.	Let us define a radius and find get a volume function,
#  which can now find out the volume for the given radius and any height.
radius = 10
find_volume = cylinder_vol(radius)

# 3.	Let us try to find out the volume for different heights
height = 10
print "Volume of cylinder of radius %d and height %d = %.2f  cubic units" \
                %(radius,height,find_volume(height))        

height = 20
print "Volume of cylinder of radius %d and height %d = %.2f  cubic units" \
                %(radius,height,find_volume(height))        </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec62" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we <a id="id62" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>defined a function called <code class="literal">cylinder_vol()</code>; it takes a single parameter, <code class="literal">r</code>, radius.<code class="literal"> </code>In this function, we defined another function, <code class="literal">get_vol()</code>. The <code class="literal">get_vol()</code> function has access to r and pi, takes the height as an argument. For the given radius, r, which was the parameter to <code class="literal">cylinder_vol()</code>, different heights were passed as a parameter to <code class="literal">get_vol()</code>.</p><p class="calibre11">In step 2, we defined a radius; in this case, as ten and invoke the <code class="literal">cylinder_vol()</code> function<code class="literal"> </code>with it. It returns the <code class="literal">get_vol()</code> function, which we stored in a variable named <code class="literal">find_volume</code>.</p><p class="calibre11">In step 3,<code class="literal"> </code>we invoked <code class="literal">find_volume</code> with different heights, 10 and 20. Note that we didn't give the radius.</p><p class="calibre11">The output produced is as follows:</p><div class="calibre2"><pre class="programlisting">Volume of cylinder of radius 10 and height 10 = 3141.00  cubic units
Volume of cylinder of radius 10 and height 20 = 6282.00  cubic units</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec63" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Functools<a id="id63" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is <a id="id64" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>a module for higher order functions:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/functools.html">https://docs.python.org/2/library/functools.html</a>
</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Altering the function behavior with decorators"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec23" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Altering the function behavior with decorators</h1></div></div></div><p class="calibre11">Decorators <a id="id65" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>wrap a function and alter their behavior. They are best understood with some working examples. Let's see some decorators in <a id="id66" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>action in this recipe.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec64" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Do you recall the section where we explained a function as an argument to another function, function as a variable, and function returning a function? Most important of all, do you remember the cylinder example? If you followed it, decorators should be a piece of cake. In this exercise, we will do a pipeline of cleaning activity on a given string. With a string with mixed casing and punctuation, we will use decorators to write a cleaning routine, which can be extended very easily.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec65" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's write a simple decorator for the text manipulation:</p><div class="calibre2"><pre class="programlisting">from string import punctuation

def pipeline_wrapper(func):

    def to_lower(x):
        return x.lower()
    
    def remove_punc(x):
        for p in punctuation:
            x = x.replace(p,'')
        return x
        
    def wrapper(*args,**kwargs):
        x = to_lower(*args,**kwargs)
        x = remove_punc(x)
        return func(x)
    return wrapper
        
@pipeline_wrapper        
def tokenize_whitespace(inText):
    return inText.split()

s = "string. With. Punctuation?"    
print tokenize_whitespace(s)</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec66" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">Let's start <a id="id67" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>from the last two lines:</p><div class="calibre2"><pre class="programlisting">s = "string. With. Punctuation?" 
print tokenize_whitespace(s)</pre></div><p class="calibre11">We declared <a id="id68" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>a string variable. We want to clean the string. In our case, we want the following features:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">We want the string to be in lowercase</li><li class="listitem">We want to strip the punctuation</li><li class="listitem">We want to return a list of words</li></ul></div><p class="calibre11">You can see that we called the <code class="literal">tokenize_whitespace</code> function with the string, s, as a parameter. Let's look at the <code class="literal">tokenize_whitespace</code> function:</p><div class="calibre2"><pre class="programlisting">@pipeline_wrapper 
def tokenize_whitespace(inText):
return inText.split()</pre></div><p class="calibre11">We see that this is very simple function and with a string input, the function splits it by a space and returns a list of words. We will alter the behavior of this function using decorators. You can see that the decorator that we will use for this function is <code class="literal">@pipeline_wrapper</code>. This is an easier way of calling the following:</p><p class="calibre11">
<code class="literal">tokenize_whitespace</code> = <code class="literal">pipeline_wrapper (clean_tokens)</code>
</p><p class="calibre11">Now, let's look at the decorator function:</p><div class="calibre2"><pre class="programlisting">def pipeline_wrapper(func):

def to_lower(x):
return x.lower()
def remove_punc(x):
for p in punctuation:
x = x.replace(p,'')
return x
def wrapper(*args,**kwargs):
x = to_lower(*args,**kwargs)
x = remove_punc(x)
return func(x)
return wrapper</pre></div><p class="calibre11">You can see that <code class="literal">pipeline_wrapper</code> returns the<code class="literal"> wrapper </code>function. In the<code class="literal"> wrapper </code>function, you <a id="id69" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>can see that the final return statement<a id="id70" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> returns<code class="literal"> func</code>; this is the original function passed by us to the wrapper.<code class="literal"> </code>The <code class="literal">wrapper</code> modifies the behavior of our original <code class="literal">tokenize_whitespace</code> function. The input to <code class="literal">tokenize_whitespace</code> is modified first by the <code class="literal">to_lower()</code> function, which changes the input string to lowercase, followed by the <code class="literal">remove_punc()</code> function, which removes the punctuation. The final output is as follows:</p><div class="calibre2"><pre class="programlisting">['string', 'with', 'punctuation']</pre></div><p class="calibre11">Exactly what we wanted—the punctuation stripped, strings converted to lowercase, and finally, a list of words.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Creating anonymous functions with lambda"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec24" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Creating anonymous functions with lambda</h1></div></div></div><p class="calibre11">Anonymous<a id="id71" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> functions are created using the<a id="id72" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> lambda statement in Python. Functions that are not bound to a name are called anonymous functions.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec67" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">If you followed the section on passing functions as a parameter, the example in this section is very similar to it. We passed a predefined function in that section; here we will pass a lambda function.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec68" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">We will see a simple example with a toy dataset to explain anonymous functions in Python:</p><div class="calibre2"><pre class="programlisting"># 1.	Create a simple list and a function similar to the
# one in functions as parameter section.
a =[10,20,30]

def do_list(a_list,func):
    total = 0
    for element in a_list:
        total+=func(element)
    return total

print do_list(a,lambda x:x**2)   
print do_list(a,lambda x:x**3)   


b =[lambda x: x%3 ==0  for x in a  ]</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec69" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we have a function called <code class="literal">do_list</code> that accepts another function as an argument. With a list and function, <code class="literal">do_list</code> applies the input function over the elements of the given list, sums up the transformed values, and returns the results.</p><p class="calibre11">Next, we <a id="id73" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>will invoke the do-list function, the<a id="id74" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> first parameter is our input list a, and the second parameter is our lambda function. Let's decode our lambda function:</p><div class="calibre2"><pre class="programlisting">lambda x:x**2</pre></div><p class="calibre11">An anonymous function is declared using the keyword, lambda; it's followed by defining a parameter for the function. In this case, x is the name of the parameter passed to this anonymous function. The expression succeeding the colon operator is the return value. The input parameter is evaluated using the expression and returned as the output. In this input, the square of the input is returned as the output. In the next print statement, we have a lambda function, which returns the cube of the given input.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Using the map function"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec25" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Using the map function</h1></div></div></div><p class="calibre11">Map is a <a id="id75" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>built-in Python function. It takes a function and an iterable for an argument:</p><div class="calibre2"><pre class="programlisting">map(aFunction, iterable)</pre></div><p class="calibre11">The function is applied on all the elements of the iterable and results are returned as a list. As a function is passed to map, lambda is most commonly used along with map.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec70" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's look at a very simple example using the map function.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec71" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's see an example on how to use a map function:</p><div class="calibre2"><pre class="programlisting">#First let us declare a list.
a =[10,20,30]
# Let us now call the map function in our Print statement.
print map(lambda x:x**2,a)   </pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec72" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">This is very similar to the code in the previous recipe. A map functions takes two parameters. The first one is a function and second one is a sequence. In our example code, we used an anonymous function:</p><div class="calibre2"><pre class="programlisting">lambda x:x**2</pre></div><p class="calibre11">This function<a id="id76" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> squares the given input. We also passed a list to map.</p><p class="calibre11">Map applies a function that squares all the elements in the given list and returns the result as a list.</p><p class="calibre11">The output is as follows:</p><div class="calibre2"><pre class="programlisting">[100,400,900]</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec73" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Similarly, any other function can be applied to a list:</p><div class="calibre2"><pre class="programlisting">print map(lambda x:x**3,a)</pre></div><p class="calibre11">Using map, we can replace the code snippet in the previous recipe with a single line:</p><div class="calibre2"><pre class="programlisting">print sum(map(lambda x:x**2,a))
print sum(map(lambda x:x**3,a))</pre></div><p class="calibre11">Map expects an N-argument function if we have N-sequences. Let's see an example to understand this:</p><div class="calibre2"><pre class="programlisting">a =[10,20,30]
b = [1,2,3]

print map(pow,a,b) </pre></div><p class="calibre11">We passed two sequences a and b to our map function. Notice that the function passed is the power function. It takes two arguments. Let's see the result of the preceding code snippet:</p><div class="calibre2"><pre class="programlisting">[10, 400, 27000]
&gt;&gt;&gt;</pre></div><p class="calibre11">As you can see, the elements of list <code class="literal">a</code> is raised to the power of value in the same position in list b. A point to note is that both the lists should be of the same size; if not, Python will fill the smaller list with None. Though our examples are operating on a list, any iterable can be passed to a map function.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Working with filters"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec26" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Working with filters</h1></div></div></div><p class="calibre11">True to its name, filter filters elements from a sequence based on the given function. With a sequence<a id="id77" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> of negative and positive numbers, we can use a filter function to, say, filter out all the negative numbers. Filter is a built-in Python function. It takes a function and an iterable for an argument:</p><div class="calibre2"><pre class="programlisting">Filter(aFunction, iterable)</pre></div><p class="calibre11">The function that is passed as an argument is returned as a Boolean value based on a test.</p><p class="calibre11">The function is applied on all the elements of the iterable and all the items that are returned as true when the function is applied over them are returned as a list. An anonymous function, lambda, is most commonly used along with filter.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec74" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's look at a simple code to see the filter function in action.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec75" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's see an example on how to use a filter function:</p><div class="calibre2"><pre class="programlisting"># Let us declare a list.
a = [10,20,30,40,50]
# Let us apply Filter function on all the elements of the list.
print filter(lambda x:x&gt;10,a)</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec76" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">The lambda function that we use here is very simple; it returns true if the given value is greater than ten, false otherwise. Our print statement gives the following result:</p><div class="calibre2"><pre class="programlisting">
<span class="strong1"><strong class="calibre12">[20, 30, 40, 50]</strong></span>
</pre></div><p class="calibre11">As you can see, only elements greater than ten are returned.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Using zip and izip"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec27" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Using zip and izip</h1></div></div></div><p class="calibre11">Zip takes two <a id="id78" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>equal length collections and merges them together in pairs. Zip is a <a id="id79" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>built-in Python function.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec77" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Let's demonstrate zip using a very simple example.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec78" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's pass two sequences to a zip function and print the output:</p><div class="calibre2"><pre class="programlisting">print zip(range(1,5),range(1,5))</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec79" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">The two parameters to our zip function are two lists, both with values ranging from <code class="literal">1</code> to <code class="literal">5</code>.</p><p class="calibre11">A range function<a id="id80" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> takes three parameters. The starting value of the list, ending value <a id="id81" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>of the list, and a step value. The default step value is one. In our case, we passed 1 and 5 as the starting and ending values of the list. Remember that Python is right-closed, so the range (<code class="literal">1</code>, <code class="literal">5</code>) will return a list as follows:</p><div class="calibre2"><pre class="programlisting">[1,2,3,4]</pre></div><p class="calibre11">We pass the two sequences to the zip function and the result is as follows:</p><div class="calibre2"><pre class="programlisting">[(1, 1), (2, 2), (3, 3), (4, 4)]</pre></div><p class="calibre11">Keep in mind that both the collections should be of the same size; if not, then the output is truncated to the size of the shortest collection.</p></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec80" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Now, look at the following code:</p><div class="calibre2"><pre class="programlisting">x,y = zip(*out)
print x,y</pre></div><p class="calibre11">Can you guess what the output is?</p><p class="calibre11">Let's see what the * operator does. A <code class="literal">*</code> operator unpacks a collection in their positional arguments:</p><div class="calibre2"><pre class="programlisting">a =(2,3)
print pow(*a)</pre></div><p class="calibre11">The power operation takes two arguments. Now a is a tuple; as you can see, the * operator splits the tuple into two separate arguments. The * operator unpacks the tuple in 2 and 3. They are passed as parameters, <code class="literal">pow(2,3)</code>, and we get the output, 8.</p><p class="calibre11">The <code class="literal">**</code> operator can be used to unpack a dictionary. Look at the following snippet:</p><div class="calibre2"><pre class="programlisting">a_dict = {"x":10,"y":10,"z":10,"x1":10,"y1":10,"z1":10} </pre></div><p class="calibre11">The <code class="literal">**</code> operator unpacks a dictionary as a set of named arguments. In this case, we will get an output,6, when we apply the <code class="literal">**</code> operator to a dictionary. Look at the following function, which takes six arguments:</p><div class="calibre2"><pre class="programlisting">def dist(x,y,z,x1,y1,z1):
return abs((x-x1)+(y-y1)+(z-z1))

print dist(**a_dict) </pre></div><p class="calibre11">The output of the print statement is zero.</p><p class="calibre11">Armed with<a id="id82" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> these two operators, we can write a function without any restrictions on<a id="id83" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the number of variables that it can ingest:</p><div class="calibre2"><pre class="programlisting">def any_sum(*args):
tot = 0
for arg in args:
tot+=arg
return tot

print any_sum(1,2)
print any_sum(1,2,3)</pre></div><p class="calibre11">As you can see, in the preceding code snippet, the <code class="literal">any_sum</code> function can now work on any number of variables. A curious reader may comment about why not use a list instead as an argument to the <code class="literal">any_sum</code> function, where we can now pass a list of values. Very well, yes in this case, but we will soon encounter cases where we really don't know what kind of arguments will be passed.</p><p class="calibre11">Back to the zip utility. One drawback with zip is that it can compute the list all at once. This may be an issue when we have two very large lists. The <code class="literal">izip</code> comes to the rescue in these cases. They compute the elements only when requested. The <code class="literal">izip</code> is a part of <code class="literal">itertools</code>. Please refer to the itertools recipe for more details.</p></div><div class="calibre2" title="See also"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec81" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>See also</h2></div></div></div><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><span class="strong1"><em class="calibre15">Working with Itertools </em></span>recipe in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch01.xhtml" title="Chapter 1. Python for Data Science">Chapter 1</a>, <span class="strong1"><em class="calibre15">Using Python for Data Science</em></span></li></ul></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Processing arrays from the tabular data"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec28" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Processing arrays from the tabular data</h1></div></div></div><p class="calibre11">The meat of any data science application is to find an appropriate data handling routine for a given<a id="id84" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> problem. In the case of machine learning, it's<a id="id85" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> either the supervised or unsupervised method to predict or classify the data. Even before this step, a good amount of time is spent in the data transformation and making the data suitable for these methods.</p><p class="calibre11">Usually, data is made available to a data science program in many ways. A data science programmer is faced with the challenge of accessing the data and making it available to a later part of his code using the Python data structure. Mastering ways to access data through Python will be very handy when writing a data science program as it will allow you to jump to the meat of the problem very quickly.</p><p class="calibre11">Typically, data<a id="id86" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is available as a text file, separated by <a id="id87" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>either a comma or tab. A Python built-in file object utility can be used in this case. As we saw earlier, a file object implements the <code class="literal">__iter__()</code> and <code class="literal">next()</code> methods. This allows us to work on very large files, which do not fit into memory, by reading only a small chunk of the files at a time.</p><p class="calibre11">Python machine learning libraries such as scikit-learn works on the NumPy libraries. In this section, we will see ways of efficiently reading external data and converting it to numPy arrays for the downstream data processing.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec82" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">NumPy provides us with a function called <code class="literal">genfromtext</code> to create NumPy arrays from tabular data. Once the data is available as NumPy arrays, it's much easier for the downstream systems to process this data. Let's look at how we can leverage <code class="literal">genfromtext</code>. The following code was written using the NumPy version 1.8.0.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec83" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's import the necessary libraries to start with. We will proceed to define a sample input. Finally, we will demonstrate how to process tabular data.</p><div class="calibre2"><pre class="programlisting"># 1.	Let us simulate a small tablular input using StringIO
import numpy as np
from StringIO import StringIO
in_data = StringIO("10,20,30\n56,89,90\n33,46,89")

# 2.Read the input using numpyâ€™s genfromtext to create a nummpy array.
data = np.genfromtxt(in_data,dtype=int,delimiter=",")

# cases where we may not need to use some columns.
in_data = StringIO("10,20,30\n56,89,90\n33,46,89")
data = np.genfromtxt(in_data,dtype=int,delimiter=",",usecols=(0,1))

# providing column names
in_data = StringIO("10,20,30\n56,89,90\n33,46,89")
data = np.genfromtxt(in_data,dtype=int,delimiter=",",names="a,b,c")

# using column names from data
in_data = StringIO("a,b,c\n10,20,30\n56,89,90\n33,46,89")
data = np.genfromtxt(in_data,dtype=int,delimiter=",",names=True)</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec84" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we <a id="id88" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>simulated a tabulated data using the <code class="literal">StringIO</code> utility. We have three rows and three columns. The rows are new line-delimited<a id="id89" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> and columns are comma-delimited.</p><p class="calibre11">In step 2, we used <code class="literal">genfromtxt</code> from NumPy to ingest the data as a NumPy array.</p><p class="calibre11">The first argument to genfromtxt is the source of the file and filename; in our case, it's the StringIO object. The input is comma-delimited; the delimiter argument allows us to specify the same. After running the preceding code, the data value is as follows:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; data
array([[10, 20, 30],
       [56, 89, 90],
       [33, 46, 89]])</pre></div><p class="calibre11">As you can see, we successfully loaded the data from the string in a NumPy array.</p></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec85" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Various parameters and default values of the same are shown here for the <code class="literal">genfromtxt</code> function:</p><div class="calibre2"><pre class="programlisting">genfromtxt(fname, dtype=&lt;type 'float'&gt;, comments='#', delimiter=None, skiprows=0, skip_header=0, skip_footer=0, converters=None, missing='', missing_values=None, filling_values=None, usecols=None, names=None, excludelist=None, deletechars=None, replace_space='_', autostrip=False, case_sensitive=True, defaultfmt='f%i', unpack=None, usemask=False, loose=True, invalid_raise=True)</pre></div><p class="calibre11">The only mandatory argument is the name of the source of the data. In our case, we used a StringIO object. It can be a string corresponding to the name of a file or an object similar to a file with a read method. It can also be a URL of a remote file.</p><p class="calibre11">The first step is to split the given line into columns. Once the file is open to be read, genfromtxt splits the non-empty lines into a sequence of strings. Empty lines are ignored and so are the commented lines. The comments option helps gentext decide which are the comment lines. The strings are split into columns based on a delimiter specified by the delimiter option. In our example case, we used a <code class="literal">,</code> delimiter. A <code class="literal">/t</code> is also a very popular delimiter. By default, the delimiter is <code class="literal">None</code> in gentext, which means that it assumes that the line is split into columns through whitespaces.</p><p class="calibre11">Typically, when lines are changed to a sequence of strings and subsequently the columns are extracted, the individual columns are not stripped of the leading or trailing whitespaces. In a later part of the code, this needs to be handled, especially if some of the variables are used as keys in a dictionary. For example, if the leading or trailing whitespaces are not handled consistently, this may lead to a bug/error in the code. Setting <code class="literal">autostrip=True</code> helps avoid this problem.</p><p class="calibre11">Many times, we <a id="id90" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>want to skip, say, top n rows or bottom <a id="id91" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>n rows while reading a file. This may be due to the presence of headers or footers. The <code class="literal">skip_header = n</code> will skip the first n lines while reading and similarly, <code class="literal">skip_footer = n</code> will skip the last n lines.</p><p class="calibre11">Similar to unwanted rows, we may encounter many cases where we may not need to use some columns. The <code class="literal">usecols</code> argument is used to specify the list of columns that we are interested in:</p><div class="calibre2"><pre class="programlisting">in_data = StringIO("10,20,30\n56,89,90\n33,46,89")

data = np.genfromtxt(in_data,dtype=int,delimiter=",",usecols=(0,1))</pre></div><p class="calibre11">As you can see in the preceding example, we selected only two columns, column 0 and 1. The data object looks as follows:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; data
array([[10, 20],
       [56, 89],
       [33, 46]])</pre></div><p class="calibre11">Custom column names can be provided using the <code class="literal">names</code> argument. A string argument with comma-separated column names looks as follows:</p><div class="calibre2"><pre class="programlisting">in_data = StringIO("10,20,30\n56,89,90\n33,46,89")
data = np.genfromtxt(in_data,dtype=int,delimiter=",",names="a,b,c")

&gt;&gt;&gt; data
array([(10, 20, 30), (56, 89, 90), (33, 46, 89)], 
      dtype=[('a', '&lt;i4'), ('b', '&lt;i4'), ('c', '&lt;i4')])</pre></div><p class="calibre11">By having <code class="literal">names</code> to true, the first row in the input data is used as a column header:</p><div class="calibre2"><pre class="programlisting">in_data = StringIO("a,b,c\n10,20,30\n56,89,90\n33,46,89")
data = np.genfromtxt(in_data,dtype=int,delimiter=",",names=True)

&gt;&gt;&gt; data
array([(10, 20, 30), (56, 89, 90), (33, 46, 89)], 
      dtype=[('a', '&lt;i4'), ('b', '&lt;i4'), ('c', '&lt;i4')])</pre></div><p class="calibre11">Another simple <a id="id92" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>method from NumPy to create NumPy arrays from the text input is <code class="literal">loadtxt</code>:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html">http://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html</a>
</p><p class="calibre11">This is less sophisticated than genfromtxt; if you need a simple reader without any sophisticated <a id="id93" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>data handling mechanisms such as handling <a id="id94" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>missing values, you can opt for loadtxt.</p><p class="calibre11">However, if we are not interested in loading the data as a NumPy array but want to load it as a list, Python provides <a id="id95" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>us with a default csv library:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/csv.html">https://docs.python.org/2/library/csv.html</a>
</p><p class="calibre11">An interesting method in the preceding csv library is <code class="literal">csv.Sniffer.sniff()</code>. If we have a very large csv file and we want to understand its structure, we can use <code class="literal">sniff()</code>. This will return a dialect subclass, which has most of the properties of the csv file.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Preprocessing the columns"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec29" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Preprocessing the columns</h1></div></div></div><p class="calibre11">Often the data that <a id="id96" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>we get is not in the format we can consume. A lot of data processing called data preprocessing steps in machine learning terminology has to be applied. One way to work through this hurdle is to ingest all the input as strings and carry on with the required data transformation at the later stages. Another way is to perform these changes at the source. The <code class="literal">genfromtext</code> provides us with some functionalities in order to perform this data transformation while reading from the source.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec86" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">Consider the following lines of text:</p><div class="calibre2"><pre class="programlisting">30kg,inr2000,31.11,56.33,1
52kg,inr8000.35,12,16.7,2</pre></div><p class="calibre11">This is a typical example of how we get data in real life. The first two columns have a string kg and inr attached to the rear and front of the actual values.</p><p class="calibre11">Let's try to ingest this data in a NumPy array as follows:</p><div class="calibre2"><pre class="programlisting">in_data = StringIO("30kg,inr2000,31.11,56.33,1\n52kg,inr8000.35,12,16.7,2")
data = np.genfromtxt(in_data,delimiter=",")</pre></div><p class="calibre11">This results in the following:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; data
array([[   nan,    nan,  31.11,  56.33,   1.  ],
       [   nan,    nan,  12.  ,  16.7 ,   2.  ]])</pre></div><p class="calibre11">As you can see, the first two columns are not read.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec87" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's import the necessary libraries to start with. We will proceed to define a sample input. Finally, we <a id="id97" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>will demonstrate data preprocessing.</p><div class="calibre2"><pre class="programlisting">import numpy as np
from StringIO import StringIO

# Define a data set
in_data = StringIO("30kg,inr2000,31.11,56.33,1\n52kg,inr8000.35,12,16.7,2")

# 1.Let us define two data pre-processing using lambda functions,
strip_func_1 = lambda x : float(x.rstrip("kg"))
strip_func_2 = lambda x : float(x.lstrip("inr"))

# 2.Let us now create a dictionary of these functions,
convert_funcs = {0:strip_func_1,1:strip_func_2}

# 3.Now provide this dictionary of functions to genfromtxt.
data = np.genfromtxt(in_data,delimiter=",", converters=convert_funcs)

# Using a lambda function to handle conversions
in_data = StringIO("10,20,30\n56,,90\n33,46,89")
mss_func = lambda x : float(x.strip() or -999)
data = np.genfromtxt(in_data,delimiter=",", converters={1:mss_func})</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec88" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In step 1, we defined two lambda functions, one for column 1 where we need to strip the string 'kg' from the right-hand side and another to strip the string 'inr' from the left-hand side of column 2.</p><p class="calibre11">In step 2, we will go ahead and define a dictionary where the key is the column name to which the function has to be applied and the value is the function. This dictionary is passed as a parameter with the <code class="literal">converters</code> name in <code class="literal">genfromtext</code>.</p><p class="calibre11">Now the output is as follows:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; data
array([[  3.00000000e+01,   2.00000000e+03,   3.11100000e+01,
          5.63300000e+01,   1.00000000e+00],
       [  5.20000000e+01,   8.00035000e+03,   1.20000000e+01,
          1.67000000e+01,   2.00000000e+00]])</pre></div><p class="calibre11">Note that Nan has vanished, giving way to an actual value from the input.</p></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec89" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Converters can<a id="id98" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> also be used to handle the missing values in an input record through a lambda function:</p><div class="calibre2"><pre class="programlisting">in_data = StringIO("10,20,30\n56,,90\n33,46,89")
mss_func = lambda x : float(x.strip() or -999)
data = np.genfromtxt(in_data,delimiter=",", converters={1:mss_func})</pre></div><p class="calibre11">The lambda function returns -999 for the missing values. In our input, the second column of the second row is empty and this should be replaced by -999. The final output looks as follows:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; data
array([[  10.,   20.,   30.],
       [  56., -999.,   90.],
       [  33.,   46.,   89.]])</pre></div><p class="calibre11">Refer to the <a id="id99" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>SciPy documentations given here for more details:</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html">http://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html</a>
</p><p class="calibre11">
<a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.genfromtxt.html">http://docs.scipy.org/doc/numpy/reference/generated/numpy.genfromtxt.html</a>
</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Sorting lists"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec30" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Sorting lists</h1></div></div></div><p class="calibre11">We will start with <a id="id100" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>sorting a list and then move on to sorting other iterables.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec90" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">There are two ways to proceed with the sorting. The first way is to use the built-in sort function in the list and the other way is to use the sorted function. Let's work it out through an example.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec91" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's see how to leverage the sort and sorted functions:</p><div class="calibre2"><pre class="programlisting"># Let us look at a very small code snippet, which does sorting of a given list.
a = [8, 0, 3, 4, 5, 2, 9, 6, 7, 1]
b = [8, 0, 3, 4, 5, 2, 9, 6, 7, 1]

print a
a.sort()
print a

print b
b_s = sorted(b)
print b_s</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec92" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">We declared <a id="id101" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>two lists, a and b, with the same elements. As a convenience way to verify the output, we will print list <code class="literal">a</code>:</p><div class="calibre2"><pre class="programlisting">[8, 0, 3, 4, 5, 2, 9, 6, 7, 1]</pre></div><p class="calibre11">We used the sort function available with the list data type, <code class="literal">a.sort()</code>, to perform an in-place sort. The following print statement shows that the list has now been sorted:</p><div class="calibre2"><pre class="programlisting">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre></div><p class="calibre11">Now, we will use the sorted function. This function performs the sorting on the list and returns a new sorted list. You can see that we invoked it as <code class="literal">sorted(b)</code> and stored the output in <code class="literal">b_s</code>. The print statement against <code class="literal">b_s</code> yields a sorted output:</p><div class="calibre2"><pre class="programlisting">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre></div></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec93" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">The <code class="literal">sort</code> function is only available for a list data type. By default, sorting is done in an ascending order; this can be controlled by a reverse parameter to the sort function. By default, reverse is set to <code class="literal">False</code>:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; a = [8, 0, 3, 4, 5, 2, 9, 6, 7, 1]
&gt;&gt;&gt; print a
[8, 0, 3, 4, 5, 2, 9, 6, 7, 1]
&gt;&gt;&gt; a.sort(reverse=True)
&gt;&gt;&gt; print a
[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
&gt;&gt;&gt;
Now, we have a descending order sorting.
For other iterables, we have to fall back on the sorted function. Let's look at a tuple example:
&gt;&gt;&gt; a = (8, 0, 3, 4, 5, 2, 9, 6, 7, 1)
&gt;&gt;&gt; sorted(a)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt;</pre></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Sorting with a key"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec31" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Sorting with a key</h1></div></div></div><p class="calibre11">Till now, we saw all the examples where a list or sequence was sorted by elements. Let's now proceed to see if we can sort it using keys. In the previous example, elements were the keys. In the real world, there are more complicated records where a record contains multiple columns <a id="id102" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>and we would like to sort with one or more columns). We will work out our examples through a list of tuples and the same applies to the other sequence objects.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec94" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">In our example, a single tuple represents a person's record, which includes his name, ID, and age. Let's write a sorting in order to sort by the various fields.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec95" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's define a record-like structure using a list and tuples. We will use this data to demonstrate the data sorting with a key:</p><div class="calibre2"><pre class="programlisting">#1.The first step is to create a list of tuples, which we will use to test our sorting.

employee_records = [ ('joe',1,53),('beck',2,26), \
                     ('ele',6,32),('neo',3,45),  \
                    ('christ',5,33),('trinity',4,29), \
                    ]

# 2.Let us now sort it by employee name
print sorted(employee_records,key=lambda emp : emp[0])
"""
It prints as follows
[('beck', 2, 26), ('christ', 5, 33), ('ele', 6, 32), ('joe', 1, 53), ('neo', 3, 45), ('trinity', 4, 29)]
"""
# 3.Let us now sort it by employee id
print sorted(employee_records,key=lambda emp : emp[1])
"""
It prints as follows
[('joe', 1, 53), ('beck', 2, 26), ('neo', 3, 45), ('trinity', 4, 29), ('christ', 5, 33), ('ele', 6, 32)]
"""
# 4.Finally we sort it with employee age
print sorted(employee_records,key=lambda emp : emp[2])
"""
Its prints as follows
[('beck', 2, 26), ('trinity', 4, 29), ('ele', 6, 32), ('christ', 5, 33), ('neo', 3, 45), ('joe', 1, 53)]
"""</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec96" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">In our example, each record has three fields: name, identification, and age. We used the lambda function <a id="id103" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>to pass a key by which we need to sort the given records. In step 2, we passed the name as the key to sort. Similarly, in steps 2 and 3, we passed the ID and age as the keys. We can see the outputs in various steps; the outputs are sorted by the particular key that we want them to.</p></div><div class="calibre2" title="There's more…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec97" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>There's more…</h2></div></div></div><p class="calibre11">Due to the importance of sorting by a key, Python provides a convenient function to access keys instead of writing lambdas. The operator module has the <code class="literal">itemgetter</code>, <code class="literal">attrgetter</code>, and <code class="literal">methodcaller</code> functions. The sorting example that we saw can be written as follows using <code class="literal">itemgetter</code>:</p><div class="calibre2"><pre class="programlisting">from operator import itemgetter
employee_records = [ ('joe',1,53),('beck',2,26), \
                     ('ele',6,32),('neo',3,45),  \
                     ('christ',5,33),('trinity',4,29), \
                     ]
print sorted(employee_records,key=itemgetter(0))
"""
[('beck', 2, 26), ('christ', 5, 33), ('ele', 6, 32), ('joe', 1, 53), ('neo', 3, 45), ('trinity', 4, 29)]
"""
print sorted(employee_records,key=itemgetter(1))
"""
[('joe', 1, 53), ('beck', 2, 26), ('neo', 3, 45), ('trinity', 4, 29), ('christ', 5, 33), ('ele', 6, 32)]
"""
print sorted(employee_records,key=itemgetter(2))
"""
[('beck', 2, 26), ('trinity', 4, 29), ('ele', 6, 32), ('christ', 5, 33), ('neo', 3, 45), ('joe', 1, 53)]
"""</pre></div><p class="calibre11">Note that we have not used the lambda functions, rather used <code class="literal">itemgetter</code> to specify the key by which we need to sort. More than one field can be given as an input to <code class="literal">itemgetter</code> when <a id="id104" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>we need multiple level sorting; for example, let's say that we need to sort by name and then by age, our code would be as follows:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; sorted(employee_records,key=itemgetter(0,1))
[('beck', 2, 26), ('christ', 5, 33), ('ele', 6, 32), ('joe', 1, 53), ('neo', 3, 45), ('trinity', 4, 29)]</pre></div><p class="calibre11">The <code class="literal">attrgetter</code> and <code class="literal">methodcaller</code> comes in handy when the elements of our iterable are class objects. Look at the following example:</p><div class="calibre2"><pre class="programlisting"># Let us now enclose the employee records as class objects,
class employee(object):
    def __init__(self,name,id,age):
        self.name = name
        self.id = id
        self.age = age
    def pretty_print(self):
       print self.name,self.id,self.age

# Now let us populate a list with these class objects.
employee_records = []
emp1 = employee('joe',1,53)
emp2 = employee('beck',2,26)
emp3 = employee('ele',6,32)

employee_records.append(emp1)
employee_records.append(emp2)
employee_records.append(emp3)

# Print the records
for emp in employee_records:
    emp.pretty_print()


from operator import attrgetter
employee_records_sorted = sorted(employee_records,key=attrgetter('age'))
# Now let us print the sorted list,
for emp in employee_records_sorted:
    emp.pretty_print()</pre></div><p class="calibre11">The constructor initializes the class with three variables: name, age, and ID. We also have the <code class="literal">pretty_print</code> method to print the values of the class object<code class="literal">.</code>
</p><p class="calibre11">Next, let's populate a list with these class objects:</p><div class="calibre2"><pre class="programlisting">employee_records = []
emp1 = employee('joe',1,53)
emp2 = employee('beck',2,26)
emp3 = employee('ele',6,32)

employee_records.append(emp1)
employee_records.append(emp2)
employee_records.append(emp3)</pre></div><p class="calibre11">Now, we have<a id="id105" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> a list of employee objects. There are three variables in each object: name, ID, and age. Let's print the list to see the order:</p><div class="calibre2"><pre class="programlisting">joe 1 53
beck 2 26
ele 6 32</pre></div><p class="calibre11">As you can see, the order of the insertion has been preserved. Now, let's use <code class="literal">attrgetter</code> to sort the list with the age field:</p><div class="calibre2"><pre class="programlisting">employee_records_sorted = sorted(employee_records,key=attrgetter('age'))</pre></div><p class="calibre11">Let's print the sorted list.</p><p class="calibre11">The output is as follows:</p><div class="calibre2"><pre class="programlisting">beck 2 26
ele 6 32
joe 1 53</pre></div><p class="calibre11">You can see that the records are now sorted by age.</p><p class="calibre11">The <code class="literal">methodcaller</code> can be used to sort when we want to use a method in our class to decide the sorting. For demonstration purposes, let's add a random method, which divides the age by the ID:</p><div class="calibre2"><pre class="programlisting">class employee(object):
    def __init__(self,name,id,age):
        self.name = name
        self.id = id
        self.age = age

    def pretty_print(self):
       print self.name,self.id,self.age

    def random_method(self):
       return self.age / self.id 

# Populate data
employee_records = []
emp1 = employee('joe',1,53)
emp2 = employee('beck',2,26)
emp3 = employee('ele',6,32)

employee_records.append(emp1)
employee_records.append(emp2)
employee_records.append(emp3)

from operator import methodcaller
employee_records_sorted = sorted(employee_records,key=methodcaller('random_method'))
for emp in employee_records_sorted:
    emp.pretty_print() </pre></div><p class="calibre11">We can now<a id="id106" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> sort the list by calling this method:</p><div class="calibre2"><pre class="programlisting">sorted(employee_records,key=methodcaller('random_method'))</pre></div><p class="calibre11">Let's now print the list in a sorted order and see the output:</p><div class="calibre2"><pre class="programlisting">ele 6 32
beck 2 26
joe 1 53</pre></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Working with itertools"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title1"><a id="ch01lvl1sec32" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Working with itertools</h1></div></div></div><p class="calibre11">Itertools includes<a id="id107" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> functions to work with iterables; it is inspired by a functional programming language such as Haskell. They promise to be memory-efficient and very fast.</p><div class="calibre2" title="Getting ready"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec98" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>Getting ready</h2></div></div></div><p class="calibre11">There are a lot <a id="id108" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>of functions available in Itertools; we will go through some of them as we work it out through examples. A link to the full list of functions has been provided.</p></div><div class="calibre2" title="How to do it…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec99" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How to do it…</h2></div></div></div><p class="calibre11">Let's proceed to see a set of Python scripts used to demonstrate the usage of itertools:</p><div class="calibre2"><pre class="programlisting"># Load libraries
from itertools import chain,compress,combinations,count,izip,islice

# 1.Chain example, where different iterables can be combined together.
a = [1,2,3]
b = ['a','b','c']
print list(chain(a,b)) # prints [1, 2, 3, 'a', 'b', 'c']

# 2.Compress example, a data selector, where the data in the first iterator
#  is selected based on the second iterator.
a = [1,2,3]
b = [1,0,1]
print list(compress(a,b)) # prints [1, 3]

# 3.From a given list, return n length sub sequences.
a = [1,2,3,4]
print list(combinations(a,2)) # prints [(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (3, 4)]

# 4.A counter which produces infinite consequent integers, given a start integer,
a = range(5)
b = izip(count(1),a)
for element in b:
    print element

# 5.	Extract an iterator from another iterator, 
# let us say we want an iterator which only returns every 
# alternate elements from the input iterator
a = range(100)
b = islice(a,0,100,2)
print list(b)</pre></div></div><div class="calibre2" title="How it works…"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title3"><a id="ch01lvl2sec100" class="pcalibre pcalibre3 pcalibre1 calibre8 pcalibre2"/>How it works…</h2></div></div></div><p class="calibre11">Step 1 is pretty<a id="id109" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> straightforward, where two iterables are combined using <code class="literal">chain()</code>. A point to note is that <code class="literal">chain()</code> is not realized till it's actually called. Check the following command line:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; chain(a,b)
&lt;itertools.chain object at 0x060DD0D0&gt;</pre></div><p class="calibre11">Calling chain(a,b) returns the chain object. However, when we run the following command, the actual output is produced:</p><div class="calibre2"><pre class="programlisting">&gt;&gt;&gt; list(chain(a,b))
[1, 2, 3, 'a', 'b', 'c']</pre></div><p class="calibre11">Step 2 describes <code class="literal">compress</code>. In this example, elements of a are selected based on elements in b. You can see that in b, the second value is zero and hence, the second value in a is also not selected.</p><p class="calibre11">Step 3 does simple mathematical combinations. We have an input list, a, and want the elements of a in combinations of two.</p><p class="calibre11">Step 4 explains a counter object, which can serve as an infinite resource of a sequence number given a <a id="id110" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>start number. Running the code, we will get the following output:</p><div class="calibre2"><pre class="programlisting">(1, 0)
(2, 1)
(3, 2)
(4, 3)
(5, 4)</pre></div><p class="calibre11">You can see that we used izip here. (Zip and izip have been covered in previous sections.) Our output is a tuple where the first element is provided by counter and second element is provided by our input list, a.</p><p class="calibre11">Step 5 details the islice operation; islice is the same as slice, which we covered in the previous section, except that islice is memory-efficient and does not realize the complete output unless called upon.</p><p class="calibre11">Refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://docs.python.org/2/library/itertools.html">https://docs.python.org/2/library/itertools.html</a> for a complete list<a id="id111" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> of the itertools.</p></div></div></div>



  </body></html>
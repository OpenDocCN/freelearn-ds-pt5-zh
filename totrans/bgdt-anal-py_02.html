<html><head></head><body>
		<div><h1 id="_idParaDest-46"><em class="italics"><a id="_idTextAnchor048"/>Chapter 2</em></h1>
		</div>
		<div><h1 id="_idParaDest-47"><a id="_idTextAnchor049"/>Statistical Visualizations</h1>
		</div>
		<div><h2>Learning Objectives</h2>
			<p>We will start our journey by understanding the power of Python to manipulate and visualize data, creating useful analysis.</p>
			<p>By the end of this chapter, you will be able to:</p>
			<ul>
				<li class="bullets">Use graphs for data analysis</li>
				<li class="bullets">Create graphs of various types</li>
				<li class="bullets">Change graph parameters such as color, title, and axis</li>
				<li class="bullets">Export graphs for presentation, printing, and other uses</li>
			</ul>
			<p>In this chapter, we will illustrate how the students can generate visualizations with Matplotlib and Seaborn.</p>
		</div>
		<div><h2 id="_idParaDest-48"><a id="_idTextAnchor050"/>Introduction</h2>
			<p>In the last chapter, we learned that the libraries that are most commonly used for data science work with Python. Although they are not big data libraries per se, the libraries of the Python Data Science Stack (<strong class="bold">NumPy</strong>, <strong class="bold">Jupyter</strong>, <strong class="bold">IPython</strong>, <strong class="bold">Pandas</strong>, and <strong class="bold">Matplotlib</strong>) are important in big data analysis.</p>
			<p>As we will demonstrate in this chapter, no analysis is complete without visualizations, even with big datasets, so knowing how to generate images and graphs from data in Python is relevant for our goal of big data analysis. In the subsequent chapters, we will demonstrate how to process large volumes of data and aggregate it to visualize it using Python tools.</p>
			<p>There are several visualization libraries for Python, such as Plotly, Bokeh, and others. But one of the oldest, most flexible, and most used is Matplotlib. But before going through the details of creating a graph with Matplotlib, let's first understand what kinds of graphs are relevant for analysis.</p>
			<h2 id="_idParaDest-49"><a id="_idTextAnchor051"/>Types of Graphs and When to Use Them</h2>
			<p>Every analysis, whether on small or large datasets, involves a descriptive statistics step, where the data is summarized and described by statistics such as mean, median, percentages, and correlation. This step is commonly the first step in the analysis workflow, allowing a preliminary understanding of the data and its general patterns and behaviors, providing grounds for the analyst to formulate hypotheses, and directing the next steps in the analysis. Graphs are powerful tools to aid in this step, enabling the analyst to visualize the data, create new views and concepts, and communicate them to a larger audience.</p>
			<p>There is a vast amount of literature on statistics about visualizing information. The classic book, <em class="italics">Envisioning Information</em>, by Edward Tufte, demonstrates beautiful and useful examples of how to present information in graphical form. In another book, The <em class="italics">Visual Display of Quantitative Information</em>, Tufte enumerates a few qualities that a graph that will be used for analysis and transmitting information, including statistics, should have:</p>
			<ul>
				<li>Show the data</li>
				<li>Avoid distorting what the data has to say</li>
				<li>Make large datasets coherent</li>
				<li>Serve a reasonably clear purpose—description, exploration, tabulation, or decoration</li>
			</ul>
			<p>Graphs must reveal information. We should think about creating graphs with these principles in mind when creating an analysis.</p>
			<p>A graph should also be able to stand out on its own, outside the analysis. Let's say that you are writing an analysis report that becomes extensive. Now, we need to create a summary of that extensive analysis. To make the analysis' points clear, a graph can be used to represent the data. This graph should be able to support the summary without the entire extensive analysis. To enable the graph to give more information and be able to stand out on its own in the summary, we have to add more information to it, such as a title and labels.</p>
			<h3 id="_idParaDest-50"><a id="_idTextAnchor052"/>Exercise 8: Plotting an Analytical Function</h3>
			<p>In this exercise, we will create a basic plot using the Matplotlib libraries, where we will visualize a function of two variables, for example, <code>y = f(x)</code>, where <code>f(x)</code> is <code>x^2</code>:</p>
			<ol>
				<li>First, create a new Jupyter notebook and import all the required libraries:<pre>%matplotlib inline
import pandas as pd
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt</pre></li>
				<li>Now, let's generate a dataset and plot it using the following code:<pre>x = np.linspace(-50, 50, 100)
y = np.power(x, 2)</pre></li>
				<li>Use the following command to create a basic graph with Matplotlib:<pre>plt.plot(x, y)</pre><p>The output is as follows:</p><div><img alt="Figure 2.1: Basic plot of X and Y axis" src="img/C12913_02_01.jpg"/></div><h6>Figure 2.1: Basic plot of X and Y axis</h6></li>
				<li>Now, modify the data generation function from <code>x^2</code> to <code>x^3</code>, keeping the same interval of <code>[-50,50]</code> and recreate the line plot:<pre>y_hat = np.power(x, 3)
plt.plot(x, y_hat)</pre><p>The output is as follows:</p></li>
			</ol>
			<div><div><img alt="Figure 2.2: Basic plot of X and Y axis" src="img/C12913_02_02.jpg"/>
				</div>
			</div>
			<h6>Figure 2.2: Basic plot of X and Y axis</h6>
			<p>As you can see, the shape of the function changed, as expected. The basic type of graph that we used was sufficient to see the change between the <code>y</code> and <code>y_hat</code> values. But some questions remain: we plotted only a mathematical function, but generally the data that we are collecting has dimensions, such as length, time, and mass. How can we add this information to the plot? How do we add a title? Let's explore this in the next section.</p>
			<h2 id="_idParaDest-51"><a id="_idTextAnchor053"/>Components of a Graph</h2>
			<p>Each graph has a set of common components that can be adjusted. The names that Matplotlib uses for these components are demonstrated in the following graph:</p>
			<div><div><img alt="Figure 2.3: Components of a graph" src="img/C12913_02_03.jpg"/>
				</div>
			</div>
			<h6>Figure 2.3: Components of a graph</h6>
			<p>The components of a graph are as follows:</p>
			<ul>
				<li><strong class="bold">Figure</strong>: The base of the graph, where all the other components are drawn.</li>
				<li><strong class="bold">Axis</strong>: Contains the figure elements and sets the coordinate system.</li>
				<li><strong class="bold">Title</strong>: The title gives the graph its name.</li>
				<li><strong class="bold">X-axis label</strong>: The name of the <em class="italics">x</em>-axis, usually named with the units.</li>
				<li><strong class="bold">Y-axis label</strong>: The name of the <em class="italics">y</em>-axis, usually named with the units.</li>
				<li><strong class="bold">Legend</strong>: A description of the data plotted in the graph, allowing you to identify the curves and points in the graph.</li>
				<li><strong class="bold">Ticks and tick labels</strong>: They indicate the points of reference on a scale for the graph, where the values of the data are. The labels indicate the values themselves.</li>
				<li><strong class="bold">Line plots</strong>: These are the lines that are plotted with the data.</li>
				<li><strong class="bold">Markers</strong>: Markers are the pictograms that mark the point data.</li>
				<li><strong class="bold">Spines</strong>: The lines that delimit the area of the graph where data is plotted.</li>
			</ul>
			<p>Each of these components can be configured to adapt to the needs of the visualization task at hand. We will go through each type of graph and how to adapt the components as previously described.</p>
			<h3 id="_idParaDest-52"><a id="_idTextAnchor054"/>Exercise 9: Creating a Graph</h3>
			<p>There are several ways to create a graph with Matplotlib. The first one is closely related to the MATLAB way of doing it, called <strong class="bold">Pyplot</strong>. Pyplot is an API that is a <em class="italics">state-based interface for Matplotlib</em>, meaning that it keeps the configurations and other parameters in the object itself. Pyplot is intended as a simple case.</p>
			<p>Perform the following steps to create the graph of a sine function using the Matplotlib library:</p>
			<ol>
				<li value="1">Import all the required libraries, as we did in the previous exercise:<pre>%matplotlib inline
import pandas as pd
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt</pre><p>A second API, called <code>plt.subplots</code> module.</p></li>
				<li>Now, to get a figure and an axis, use the following command:<pre>fig, ax = plt.subplots()</pre><h4>Note</h4><p class="callout">The figure is the top container for all other graph components. The axes set things such as the axis, the coordinate system, and contain the plot elements, such as lines, text, and many more.</p></li>
				<li>To add a plot to a graph created using the object-oriented API, use the following command:<pre>x = np.linspace(0,100,500)
y = np.sin(2*np.pi*x/100)
ax.plot(x, y)</pre><p>The output is as follows:</p></li>
			</ol>
			<div><div><img alt="Figure 2.4: Plot output using the object-oriented API" src="img/C12913_02_04.jpg"/>
				</div>
			</div>
			<h6>Figure 2.4: Plot output using the object-oriented API</h6>
			<p>We are adding a line plot to the <code>ax</code> axis that belongs to the <code>fig</code> figure. Changes to the graph, such as label names, title, and so on, will be demonstrated later in this chapter. For now, let's look at how to create each kind of graph that we may use in an analysis.</p>
			<h3 id="_idParaDest-53"><a id="_idTextAnchor055"/>Exercise 10: Creating a Graph for a Mathematical Function</h3>
			<p>In <em class="italics">Exercise 1: Plotting an Analytical Function</em>, we created a graph for a mathematical function using the MATLAB-like interface, Pyplot. Now that we know how to use the Matplotlib object-oriented API, let's create a new graph using it. Analysts have a lot of flexibility in creating graphs, whatever the data source, when using the object-oriented API.</p>
			<p>Let's create a plot using the object-oriented API with the NumPy <code>sine</code> function on the interval <code>[0,100]</code>:</p>
			<ol>
				<li value="1">Create the data points for the <code>x</code>-axis:<pre>import numpy as np
x = np.linspace(0,100,200)
y = np.sin(x)</pre></li>
				<li>Create the API interface for Matplotlib:<pre>%matplotlib inline
import matplotlib.pyplot as plt
fig, ax = plt.subplots()</pre></li>
				<li>Add the graph using the axis object, <code>ax</code>:<pre>ax.plot(x, y)</pre><p>The output is as follows:</p><div><img alt="Figure 2.5: Graph for a mathematical function" src="img/C12913_02_05.jpg"/></div></li>
			</ol>
			<h6>Figure 2.5: Graph for a mathematical function</h6>
			<p>Notice that we again created a linear interval of values between <code>[0, 100]</code> using the <code>linspace</code> function, with <code>200</code> points. We then applied the <code>sine</code> function over these values to create the <code>y</code> axis. This is a common approach when creating data intervals.</p>
			<h2 id="_idParaDest-54"><a id="_idTextAnchor056"/>Seaborn</h2>
			<p><strong class="bold">Seaborn</strong> (<a href="https://seaborn.pydata.org/">https://seaborn.pydata.org/</a>) is part of the PyData family of tools and is a visualization library based on Matplotlib with the goal of creating statistical graphs more easily. It can operate directly on DataFrames and series, doing aggregations and mapping internally. Seaborn uses color palettes and styles to make visualizations consistent and more informative. It also has functions that can calculate some statistics, such as regression, estimation, and errors. Some specialized plots, such as violin plots and multi-facet plots, are also easy to create with Seaborn.</p>
			<h2 id="_idParaDest-55"><a id="_idTextAnchor057"/>Which Tool Should Be Used?</h2>
			<p>Seaborn tries to make the creation of some common analysis graphs easier than using Matplotlib directly. Matplotlib can be considered more low-level than Seaborn, and although this makes it a bit more cumbersome and verbose, it gives analysts much more flexibility. Some graphs, which with Seaborn are created with one function call, would take several lines of code to achieve using Matplotlib.</p>
			<p>There is no rule to determine whether an analyst should use only the pandas plotting interface, Matplotlib directly, or Seaborn. Analysts should keep in mind the visualization requirements and the level of configuration required to create the desired graph.</p>
			<p>Pandas' plotting interface is easier to use but is more constrained and limited. Seaborn has several graph patterns ready to use, including common statistical graphs such as pair plots and boxplots, but requires that the data is formatted into a tidy format and is more opinionated on how the graphs should look. Matplotlib is the base for both cases and is more flexible than both, but it demands a lot more code to create the same visualizations as the two other options.</p>
			<p>The rule of thumb that we use in this book is: how can I create the graph that I need with the least amount of code and without changing the data? With that in mind, we will use the three options, sometimes at the same time, to attain our visualization goals. Analysts should not be restricted to just one of the options. We encourage the use of any tool that creates a meaningful visualization.</p>
			<p>Let's go through the most common kinds of graphs used in statistical analysis.</p>
			<h2 id="_idParaDest-56"><a id="_idTextAnchor058"/>Types of Graphs</h2>
			<p>The first type of graph that we will present is the <strong class="bold">line graph</strong> or <strong class="bold">line chart</strong>. A line graph displays data as a series of interconnected points on two axes (<em class="italics">x</em> and <em class="italics">y</em>), usually <strong class="bold">Cartesian</strong>, ordered commonly by the <em class="italics">x</em>-axis. Line charts are useful for demonstrating trends in data, such as in <strong class="bold">time series</strong>, for example.</p>
			<p>A graph related to the line graph is the <strong class="keyword">scatter plot</strong>. A scatter plot represents the data as points in Cartesian coordinates. Usually, two variables are demonstrated in this graph, although more information can be conveyed if the data is color-coded or size-coded by category, for example. Scatter plots are useful for showing the relationship and possible correlation between variables.</p>
			<p><strong class="keyword">Histograms</strong> are useful for representing the distribution of data. Unlike the two previous examples, histograms show only one variable, usually on the <em class="italics">x</em>-axis, while the <em class="italics">y</em>-axis shows the frequency of occurrence of the data. The process of creating a histogram is a bit more involved than the line graph and the scatter plot, so we will explain them in a bit more detail.</p>
			<p><strong class="keyword">Boxplots</strong> can also be used for representing frequency distributions, but it can help to compare groups of data using some statistical measurements, such as mean, median, and standard deviation. Boxplots are used to visualize the data distribution and outliers.</p>
			<p>Each graph type has its applications and choosing the right type is paramount in the success of an analysis. For example, line graphs could be used to show trends in economic growth in the last century, while a boxplot for that would be hard to create. Another common data analysis task identifies correlations between variables: understanding whether two variables show related behaviors. A scatter plot is the tool commonly used to visualize this. Histograms are useful for visualizing data point numbers in a bin or a range, such as the number of cars whose efficiency is between 10 and 20 miles per gallon.</p>
			<h3 id="_idParaDest-57"><a id="_idTextAnchor059"/>Line Graphs</h3>
			<p>Line graphs, as described in the previous section, connect the data points with a line. Line graphs are useful for demonstrating tendencies and trends. More than one line can be used on the same graph, for a comparison between the behavior of each line, although care must be taken so that the units on the graph are the same. They can also demonstrate the relationship between an independent and a dependent variable. A common case for this is time series.</p>
			<h3 id="_idParaDest-58">Time <a id="_idTextAnchor060"/>Series Plots</h3>
			<p><strong class="bold">Time series plots</strong>, as the name suggests, graphs the behavior of the data with respect to time. Time series graphs are used frequently in financial areas and environmental sciences. For instance, a historical series of temperature anomalies are shown in the following graph:</p>
			<div><div><img alt="Figure 2.6: Time series plot" src="img/C12913_02_06.jpg"/>
				</div>
			</div>
			<h6>Figure 2.6: Time series plot</h6>
			<h4>Source</h4>
			<p class="callout"><a href="https://upload.wikimedia.org/wikipedia/commons/c/c1/2000_Year_Temperature_Comparison.png">https://upload.wikimedia.org/wikipedia/commons/c/c1/2000_Year_Temperature_Comparison.png</a></p>
			<p>Usually, a time series graph has the <code>time</code> variable on the <em class="italics">x</em>-axis.</p>
			<h3 id="_idParaDest-59"><a id="_idTextAnchor061"/>Exercise 11: Creating Line Graphs Using Different Libraries</h3>
			<p>Let's compare the creation process between Matplotlib, Pandas, and Seaborn. We will create a Pandas DataFrame with random values and plot it using various methods:</p>
			<ol>
				<li value="1">Create a dataset with random values:<pre>import numpy as np
X = np.arange(0,100)
Y = np.random.randint(0,200, size=X.shape[0])</pre></li>
				<li>Plot the data using the Matplotlib Pyplot interface:<pre>%matplotlib inline
import matplotlib.pyplot as plt
plt.plot(X, Y)</pre></li>
				<li>Now, let's create a Pandas DataFrame with the created values:<pre>import pandas as pd
df = pd.DataFrame({'x':X, 'y_col':Y})</pre></li>
				<li>Plot it using the Pyplot interface, but with the <code>data</code> argument:<pre>plt.plot('x', 'y_col', data=df)</pre><p>The output is as follows:</p><div><img alt="Figure 2.7: Line graphs using different libraries" src="img/C12913_02_07.jpg"/></div><h6>Figure 2.7: Line graphs using different libraries</h6></li>
				<li>With the same DataFrame, we can also plot directly from the Pandas DataFrame:<pre>df.plot('x', 'y_col')</pre><p>The output is as follows:</p><div><img alt="Figure 2.8: Line graphs from the pandas DataFrame" src="img/C12913_02_08.jpg"/></div><h6>Figure 2.8: Line graphs from the pandas DataFrame</h6></li>
				<li>What about Seaborn? Let's create the same line plot with Seaborn:<pre>import seaborn as sns
sns.lineplot(X, Y)
sns.lineplot('x', 'y_col', data=df)</pre><p>The output is as follows:</p></li>
			</ol>
			<div><div><img alt="Figure 2.9: Line graphs from the Seaborn DataFrame" src="img/C12913_02_09.jpg"/>
				</div>
			</div>
			<h6>Figure 2.9: Line graphs from the Seaborn DataFrame</h6>
			<p>We can see that, in this case, the interface used by Matplotlib and Seaborn is quite similar.</p>
			<h2 id="_idParaDest-60">Pandas Da<a id="_idTextAnchor062"/>taFrames and Grouped Data</h2>
			<p>As we learned in the previous chapter, when analyzing data and using Pandas to do so, we can use the plot functions from Pandas or use Matplotlib directly. Pandas uses Matplotlib under the hood, so the integration is great. Depending on the situation, we can either plot directly from pandas or create a <strong class="bold">figure</strong> and an <strong class="bold">axes</strong> with Matplotlib and pass it to pandas to plot. For example, when doing a GroupBy, we can separate the data into a GroupBy key. But how can we plot the results of GroupBy? We have a few approaches at our disposal. We can, for example, use pandas directly, if the DataFrame is already in the right format:</p>
			<h4>Note</h4>
			<p class="callout">The following code is a sample and will not get executed.</p>
			<pre>fig, ax = plt.subplots()
df = pd.read_csv('data/dow_jones_index.data')
df[df.stock.isin(['MSFT', 'GE', 'PG'])].groupby('stock')['volume'].plot(ax=ax)</pre>
			<p>Or we can just plot each GroupBy key on the same plot:</p>
			<pre>fig, ax = plt.subplots()
df.groupby('stock').volume.plot(ax=ax)</pre>
			<p>For the following activity, we will use what we've learned in the previous chapter and read a CSV file from a URL and parse it. The dataset is the Auto-MPG dataset (<a href="https://raw.githubusercontent.com/TrainingByPackt/Big-Data-Analysis-with-Python/master/Lesson02/Dataset/auto-mpg.data">https://raw.githubusercontent.com/TrainingByPackt/Big-Data-Analysis-with-Python/master/Lesson02/Dataset/auto-mpg.data</a>).</p>
			<h4>Note</h4>
			<p class="callout">This dataset is a modified version of the dataset provided in the <code>StatLib</code> library. The original dataset is available in the <code>auto-mpg.data-original</code> file.</p>
			<p class="callout">The data concerns city-cycle fuel consumption in miles per gallon, in terms of three multivalued discrete and five continuous attributes.</p>
			<h3 id="_idParaDest-61"><a id="_idTextAnchor063"/>Activity 4: Line Graphs with the Object-Oriented API and Pandas DataFrames</h3>
			<p>In this activity, we will create a time series line graph from the Auto-MPG dataset as a first example of plotting using pandas and the object-oriented API. This kind of graph is common in analysis and helps to answer questions such as "is the average horsepower increasing or decreasing with time?"</p>
			<p>Now, follow these procedures to plot a graph of average horsepower per year using pandas and while using the object-oriented API:</p>
			<ol>
				<li value="1">Import the required libraries and packages into the Jupyter notebook.</li>
				<li>Read the Auto-MPG dataset into the Spark object.</li>
				<li>Provide the column names to simplify the dataset, as illustrated here:<pre>column_names = ['mpg', 'cylinders', 'displacement', 'horsepower', 'weight', 'acceleration', 'year', 'origin', 'name']</pre></li>
				<li>Now read the new dataset with column names and display it.</li>
				<li>Convert the <code>horsepower</code> and <code>year</code> data types to float and integer.</li>
				<li>Now plot the graph of average horsepower per year using pandas:</li>
			</ol>
			<div><div><img alt="Figure 2.10: Line Graphs with the Object-Oriented API and Pandas DataFrame" src="img/Image39479.jpg"/>
				</div>
			</div>
			<h6>Figure 2.10: Line Graphs with the Object-Oriented API and Pandas DataFrame</h6>
			<h4>Note</h4>
			<p class="callout">The solution for this activity can be found on page 205.</p>
			<p>Note that we are using the plot functions from pandas but passing the axis that we created directly with Matplotlib as an argument. As we saw in the previous chapter, this is not required, but it will allow you to configure the plot outside pandas and change its configurations later. This same behavior can be applied to the other kinds of graphs. Let's now work with scatter plots.</p>
			<h3 id="_idParaDest-62"><a id="_idTextAnchor064"/>Scatter Plots</h3>
			<p>To understand the correlation between two variables, scatter plots are generally used because they allow the distribution of points to be seen. Creating a scatter plot with Matplotlib is similar to creating a line plot, but instead of using the <code>plot</code> method, we use the <code>scatter</code> method.</p>
			<p>Let's look at an example using the Auto-MPG dataset (<a href="https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/">https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/</a>):</p>
			<pre>fig, ax = plt.subplots()
ax.scatter(x = df['horsepower'], y=df['weight'])</pre>
			<div><div><img alt="" src="img/C12913_02_11.jpg"/>
				</div>
			</div>
			<h6>Figure 2.11: Scatter plot using Matplotlib library</h6>
			<p>Note that we called the scatter method directly from the axis. In Matplotlib parlance, we added a scatter plot to the axis, <code>ax</code>, that belongs to the <code>fig</code> figure. We can also add more dimensions to the plot, such as the <code>color</code> and point <code>size</code>, easily with Seaborn:</p>
			<pre>import seaborn as sns
sns.scatterplot(data=df, x='horsepower', y='weight', hue='cylinders', size='mpg')</pre>
			<div><div><img alt="Figure 2.12: Scatter plot using Seaborn library" src="img/C12913_02_12.jpg"/>
				</div>
			</div>
			<h6>Figure 2.12: Scatter plot using Seaborn library</h6>
			<p>As we can see, scatter plots are quite helpful for understanding the relationship between two variables, or even more. We can infer, for example, that there is a positive correlation between <code>horsepower</code> and <code>weight</code>. We can also easily see an outlier with the scatter plot, which could be more complicated when working with other kinds of graphs. The same principles for grouped data and pandas DataFrames that we saw on the line graphs apply here for the scatter plot.</p>
			<p>We can generate a scatter plot directly from pandas using the <code>kind</code> parameter:</p>
			<pre>df.plot(kind='scatter', x='horsepower', y='weight')</pre>
			<p>Create a figure and pass it to Pandas:</p>
			<pre>fig, ax = plt.subplots()
df.plot(kind='scatter', x='horsepower', y='weight', ax =ax)</pre>
			<h3 id="_idParaDest-63"><a id="_idTextAnchor065"/>Activity 5: Understanding Relationships of Variables Using Scatter Plots</h3>
			<p>To continue our data analysis and learn how to plot data, let's look at a situation where a scatter plot can help. For example, let's use a scatter plot to answer the following question:</p>
			<p>Is there a relationship between horsepower and weight?</p>
			<p>To answer this question, we need to create a scatter plot with the data from Auto-MPG:</p>
			<ol>
				<li value="1">Use the Auto-MPG dataset, already ingested.<h4>Note</h4><p class="callout">Please refer to the previous exercise for how to ingest the dataset.</p></li>
				<li>Use the object-oriented API for Matplotlib:<pre>%matplotlib inline
import matplotlib.pyplot as plt
fig, ax = plt.subplots()</pre></li>
				<li>Create a scatter plot using the <code>scatter</code> method:<pre>ax.scatter(x = df['horsepower'], y=df['weight'])</pre><h4>Note</h4><p class="callout">The solution for this activity can be found on page 208.</p></li>
			</ol>
			<p>We can identify a roughly linear relationship between horsepower and weight, with some outliers with higher horsepower and lower weight. This is the kind of graph that would help an analyst interpret the data's behavior.</p>
			<h3 id="_idParaDest-64"><a id="_idTextAnchor066"/>Histograms</h3>
			<p>Histograms are a bit different from the graphs that we've seen so far, as they only try to visualize the distribution of one variable, instead of two or more. Histograms have the goal of visualizing the probability distribution of one variable, or in other words, counting the number of occurrences of certain values divided into fixed intervals, or bins. </p>
			<p>The bins are consecutive and adjacent but don't need to have the same size, although this is the most common arrangement.</p>
			<p>The choice of the number of bins and bin size is more dependent on the data and the analysis goal than any fixed, general rule. The larger the number of bins, the smaller (narrower) the size of each bin, and vice versa. When data has a lot of noise or variation, for example, a small number of bins (with a large bin) will show the general outline of the data, reducing the impact of the noise in a first analysis. A larger number of bins is more useful when the data has a higher density.</p>
			<h3 id="_idParaDest-65"><a id="_idTextAnchor067"/>Exercise 12: Creating a Histogram of Horsepower Distribution</h3>
			<p>As we strive to understand the data, we now want to see the horsepower distribution over all cars. Analysis questions with an adequate histogram are, for example: what is the most frequent value of a variable? Is the distribution centered or does it have a tail? Let's plot a histogram of the horsepower distribution:</p>
			<ol>
				<li value="1">Import the required libraries into the Jupyter notebook and read the dataset from the Auto-MPG dataset repository:<pre>import pandas as pd
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
import seaborn as sns
url = "https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.data"
df = pd.read_csv(url)</pre></li>
				<li>Provide the column names to simplify the dataset as illustrated here:<pre>column_names = ['mpg', 'Cylinders', 'displacement', 'horsepower', 'weight', 'acceleration', 'year', 'origin', 'name']</pre></li>
				<li>Now read the new dataset with column names and display it:<pre>df = pd.read_csv(url, names= column_names, delim_whitespace=True)
df.head()</pre><p>The plot is as follows:</p><div><img alt="Figure 2.13: The auto-mpg dataset" src="img/C12913_02_13.jpg"/></div><h6>Figure 2.13: The auto-mpg dataset</h6></li>
				<li>Convert the <code>horsepower</code> and <code>year</code> data types to float and integer using the following command:<pre>df.loc[df.horsepower == '?', 'horsepower'] = np.nan
df['horsepower'] = pd.to_numeric(df['horsepower'])
df['full_date'] = pd.to_datetime(df.year, format='%y')
df['year'] = df['full_date'].dt.year</pre></li>
				<li>Create a graph directly from the Pandas DataFrame using the <code>plot</code> function and <code>kind='hist'</code>:<pre>df.horsepower.plot(kind='hist')</pre><div><img alt="Figure 2.14: Histogram plot" src="img/C12913_02_14.jpg"/></div><h6>Figure 2.14: Histogram plot</h6></li>
				<li>Identify the <code>horsepower</code> concentration:<pre>sns.distplot(df['weight'])</pre></li>
			</ol>
			<div><div><img alt="Figure 2.15: Histogram concentration plot" src="img/Image39528.jpg"/>
				</div>
			</div>
			<h6>Figure 2.15: Histogram concentration plot</h6>
			<p>We can see in this graph that the value distribution is skewed to the left, with more cars with horsepower of between <code>50</code> and <code>100</code> than greater than <code>200</code>, for example. This could be quite useful in understanding how some data varies in an analysis.</p>
			<h3 id="_idParaDest-66"><a id="_idTextAnchor068"/>Boxplots</h3>
			<p>Boxplots are also used to see variations in values, but now within each column. We want to see how values compare when grouped by another variable, for example. Because of their format, boxplots are sometimes called <strong class="bold">whisker plots</strong> or <strong class="bold">box</strong> and <strong class="bold">whisker plots</strong> because of the lines that extend vertically from the main box:</p>
			<div><div><img alt="" src="img/C12913_02_16.jpg"/>
				</div>
			</div>
			<h6>Figure 2.16: Boxplot</h6>
			<h4>Source</h4>
			<p class="callout"><a href="https://en.wikipedia.org/wiki/File:Michelsonmorley-boxplot.svg">https://en.wikipedia.org/wiki/File:Michelsonmorley-boxplot.svg</a></p>
			<p>A boxplot uses quartiles (first and third) to create the boxes and whiskers. The line in the middle of the box is the second quartile – the median. The whiskers definition can vary, such as using one standard deviation above and below the mean of the data, but it's common to use 1.5 times the interquartile range (Q3 – Q1) from the edges of the box. Anything that passes these values, either above or below, is plotted as a <code>dot</code> and is usually considered an outlier.</p>
			<h3 id="_idParaDest-67"><a id="_idTextAnchor069"/>Exercise 13: Analyzing the Behavior of the Number of Cylinders and Horsepower Using a Boxplot</h3>
			<p>Sometimes we want not only to see the distribution of each variable, but also to see the variation of the variable of interest with respect to another attribute. We would like to know, for instance, how the horsepower varies given the number of cylinders. Let's create a boxplot with Seaborn, comparing the horsepower distribution to the number of cylinders:</p>
			<ol>
				<li value="1">Import the required libraries into the Jupyter notebook and read the dataset from the Auto-MPG dataset repository:<pre>%matplotlib inline
import pandas as pd
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
import seaborn as sns
url = "https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.data"
df = pd.read_csv(url)</pre></li>
				<li>Provide the column names to simplify the dataset, as illustrated here:<pre>column_names = ['mpg', 'Cylinders', 'displacement', 'horsepower', 'weight', 'acceleration', 'year', 'origin', 'name']</pre></li>
				<li>Now read the new dataset with column names and display it:<pre>df = pd.read_csv(url, names= column_names, delim_whitespace=True)
df.head()</pre><p>The plot is as follows:</p><div><img alt="Figure 2.17: The auto-mpg dataset" src="img/C12913_02_17.jpg"/></div><h6>Figure 2.17: The auto-mpg dataset</h6></li>
				<li>Convert the data type of horsepower and year to float and integer using the following command:<pre>df.loc[df.horsepower == '?', 'horsepower'] = np.nan
df['horsepower'] = pd.to_numeric(df['horsepower'])
df['full_date'] = pd.to_datetime(df.year, format='%y')
df['year'] = df['full_date'].dt.year</pre></li>
				<li>Create a boxplot using the Seaborn <code>boxplot</code> function:<pre>sns.boxplot(data=df, x="cylinders", y="horsepower")</pre><div><img alt="Figure 2.18: Boxplot using the Seaborn boxplot function" src="img/C12913_02_18.jpg"/></div><h6>Figure 2.18: Boxplot using the Seaborn boxplot function</h6></li>
				<li>Now, just for comparison purposes, create the same <code>boxplot</code> using pandas directly:<pre>df.boxplot(column='horsepower', by='cylinders')</pre></li>
			</ol>
			<div><div><img alt="Figure 2.19: Boxplot using pandas" src="img/C12913_02_19.jpg"/>
				</div>
			</div>
			<h6>Figure 2.19: Boxplot using pandas</h6>
			<p>On the analysis side, we can see that the variation range from <strong class="bold">3</strong> cylinders is smaller than for <strong class="bold">8</strong> cylinders for horsepower. We can also see that <strong class="bold">6</strong> and <strong class="bold">8</strong> cylinders have outliers in the data. As for the plotting, the Seaborn function is more complete, showing different colors automatically for different numbers of cylinders, and including the name of the DataFrame columns as labels in the graph.</p>
			<h2 id="_idParaDest-68"><a id="_idTextAnchor070"/>Changing Plot Design: Modifying Graph Components</h2>
			<p>So far, we've looked at the main graphs used in analyzing data, either directly or grouped, for comparison and trend visualization. But one thing that we can see is that the design of each graph is different from the others, and we don't have basic things such as a title and legends.</p>
			<p>We've learned that a graph is composed of several components, such as a graph <strong class="bold">title</strong>, <strong class="bold">x</strong> and <strong class="bold">y</strong> labels, and so on. When using Seaborn, the graphs already have <strong class="bold">x</strong> and <strong class="bold">y</strong> labels, with the names of the columns. With Matplotlib, we don't have this. These changes are not only cosmetic.</p>
			<p>The understanding of a graph can be greatly improved when we adjust things such as line width, color, and point size too, besides labels and titles. A graph must be able to stand on its own, so title, legends, and units are paramount. How can we apply the concepts that we described previously to make good, informative graphs on Matplotlib and Seaborn?</p>
			<p>The possible number of ways that plots can be configured is enormous. Matplotlib is powerful when it comes to configuration, but at the expense of simplicity. It can be cumbersome to change some basic parameters in a graph using Matplotlib and this is where Seaborn and other libraries can be of help. But in some cases, this is desirable, for instance in a custom graph, so having this capacity somewhere in the stack is necessary. We will focus on how to change a few basic plot parameters in this section.</p>
			<h3 id="_idParaDest-69"><a id="_idTextAnchor071"/>Title and Label Configuration for Axis Objects</h3>
			<p>As we said before, the object-oriented API for Matplotlib is the one that provides greater flexibility. Let's explore how to configure the title and labels on axis objects in the following exercise.</p>
			<h3 id="_idParaDest-70"><a id="_idTextAnchor072"/>Exercise 14: Configuring a Title and Labels for Axis Objects</h3>
			<p>Perform the following steps to configure a title and labels for the axis objects. We will continue from the previous exercise and follow these steps:</p>
			<ol>
				<li value="1">Set the <code>title</code>, the x-axis label, and the y-axis label by calling the <code>set</code> method:<pre>import matplotlib.pyplot as plt
fig, ax = plt.subplots()
ax.set(title="Graph title", xlabel="Label of x axis (units)", ylabel="Label of y axis (units)")
ax.plot()</pre><p>The plot is as follows:</p><div><img alt="Figure 2.20: Configuring a title and labels" src="img/C12913_02_20.jpg"/></div><h6>Figure 2.20: Configuring a title and labels</h6></li>
				<li>The legends for the plot can be either passed externally, when using only Matplotlib, or can be set on the Pandas plot and plotted with the axes. Use the following command to plot the legends:<pre>fig, ax = plt.subplots()
df.groupby('year')['horsepower'].mean().plot(ax=ax, label='horsepower')
ax.legend()</pre><p>The plot is as follows:</p><div><img alt="Figure 2.21: Line graph with legends" src="img/C12913_02_21.jpg"/></div><h6>Figure 2.21: Line graph with legends</h6></li>
				<li>The alternative method for plotting the legends is as follows:<pre>fig, ax = plt.subplots()
df.groupby('year')['horsepower'].mean().plot(ax=ax)
ax.legend(['horsepower'])</pre><p>The plot is as follows:</p></li>
			</ol>
			<div><div><img alt="Figure 2.22: Line graph with legends (alternate method)" src="img/C12913_02_22.jpg"/>
				</div>
			</div>
			<h6>Figure 2.22: Line graph with legends (alternate method)</h6>
			<h3 id="_idParaDest-71"><a id="_idTextAnchor073"/>Line Styles and Color</h3>
			<p>For line graphs, the color, the weight, markers, and the style of the lines can be configured with the <code>ls</code>, <code>lw</code>, <code>marker</code>, and <code>color</code> parameters:</p>
			<pre>df.groupby('year')['horsepower'].mean().plot(ls='-.', color='r', lw=3)</pre>
			<div><div><img alt="Figure 2.23: Line graph with color and style" src="img/C12913_02_23.jpg"/>
				</div>
			</div>
			<h6>Figure 2.23: Line graph with color and style</h6>
			<h3 id="_idParaDest-72"><a id="_idTextAnchor074"/>Figure Size</h3>
			<p>We can also configure the size of the figure. The <code>figsize</code> parameter can be passed to all plot functions as a tuple (<code>x</code>-axis, <code>y</code>-axis) with the size in inches:</p>
			<pre>df.plot(kind='scatter', x='weight', y='horsepower', figsize=(20,10))</pre>
			<div><div><img alt="Figure 2.24: Plot with bigger figure size" src="img/C12913_02_24.jpg"/>
				</div>
			</div>
			<h6>Figure 2.24: Plot with bigger figure size</h6>
			<h3 id="_idParaDest-73"><a id="_idTextAnchor075"/>Exercise 15: Working with Matplotlib Style Sheets</h3>
			<p>Matplotlib has some style sheets that define general rules for graphs, such as <strong class="bold">background</strong> <strong class="bold">color</strong>, <strong class="bold">ticks</strong>, <strong class="bold">graph colors</strong>, and <strong class="bold">palettes</strong>. Let's say that we want to change the style so our graph has better colors for printing. To accomplish that, follow these steps:</p>
			<ol>
				<li value="1">Let's first print the list of available styles using the following command:<pre>import matplotlib.pyplot as plt
print(plt.style.available)</pre><p>The output is as follows:</p><pre>['bmh', 'classic', 'dark_background', 'fast', 'fivethirtyeight', 'ggplot', 'grayscale', 'seaborn-bright', 'seaborn-colorblind', 'seaborn-dark-palette', 'seaborn-dark', 'seaborn-darkgrid', 'seaborn-deep', 'seaborn-muted', 'seaborn-notebook', 'seaborn-paper', 'seaborn-pastel', 'seaborn-poster', 'seaborn-talk', 'seaborn-ticks', 'seaborn-white', 'seaborn-whitegrid', 'seaborn', 'Solarize_Light2', 'tableau-colorblind10', '_classic_test']</pre></li>
				<li>Now, let's create a scatter plot with the style as <code>classic</code>. Make sure you import the Matplotlib library first before proceeding:<pre>%matplotlib inline
import numpy as np
import matplotlib.pyplot as plt
url = ('https://raw.githubusercontent.com/TrainingByPackt/Big-Data-Analysis-with-Python/master/Lesson02/Dataset/auto-mpg.data')
df = pd.read_csv(url)
column_names = ['mpg', 'cylinders', 'displacement', 'horsepower', 'weight', 'acceleration', 'year', 'origin', 'name']
df = pd.read_csv(url, names= column_names, delim_whitespace=True)
df.loc[df.horsepower == '?', 'horsepower'] = np.nan
df['horsepower'] = pd.to_numeric(df['horsepower'])
plt.style.use(['classic'])
df.plot(kind='scatter', x='weight', y='horsepower')</pre><p>The output is as follows:</p></li>
			</ol>
			<div><div><img alt="" src="img/Image39625.jpg"/>
				</div>
			</div>
			<h6>Figure 2.25: Scatter plot with the style as classic</h6>
			<h4>Note</h4>
			<p class="callout">To use a style sheet, us<a id="_idTextAnchor076"/>e the following command:</p>
			<p class="callout"><code>plt.style.use('presentation')</code></p>
			<p>One of the changes that Seaborn makes when it is imported is to add some styles to the list of available ones. Styles are also useful when creating images for different audiences, such as one for visualization in a notebook and another for printing or displaying in a presentation.</p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor077"/>Exporting Graphs</h2>
			<p>After generating our visualizations and configuring the details, we can export our graphs to a hard copy format, such as PNG, JPEG, or SVG. If we are using the interactive API in the notebook, we can just call the <code>savefig</code> function over the <code>pyplot</code> interface, and the last generated graph will be exported to the file:</p>
			<pre>df.plot(kind='scatter', x='weight', y='horsepower', figsize=(20,10))
plt.savefig('horsepower_weight_scatter.png')</pre>
			<div><div><img alt="Figure 2.26: Exporting the graphs" src="img/C12913_02_26.jpg"/>
				</div>
			</div>
			<h6>Figure 2.26: Exporting the graphs</h6>
			<p>All plot configurations will be carried to the <code>plot</code>. To export a graph when using the object-oriented API, we can call <code>savefig</code> from the figure:</p>
			<pre>fig, ax = plt.subplots()
df.plot(kind='scatter', x='weight', y='horsepower', figsize=(20,10), ax=ax)
fig.savefig('horsepower_weight_scatter.jpg')</pre>
			<div><div><img alt="Figure 2.27: Saving the graph" src="img/C12913_02_27.jpg"/>
				</div>
			</div>
			<h6>Figure 2.27: Saving the graph</h6>
			<p>We can change some parameters for the saved image:</p>
			<ul>
				<li><strong class="bold">dpi</strong>: Adjust the saved image resolution.</li>
				<li><strong class="bold">facecolor</strong>: The face color of the figure.</li>
				<li><strong class="bold">edgecolor</strong>: The edge color of the figure, around the graph.</li>
				<li><strong class="bold">format</strong>: Usually PNG, PDF, PS, EPS, JPG, or SVG. Inferred from the filename extension.</li>
			</ul>
			<p>Seaborn also uses the same underlying Matplotlib mechanism to save figures. Call the <code>savefig</code> method directly from a Seaborn graph:</p>
			<pre>sns_scatter = sns.scatterplot(data=df, x='horsepower', y='weight', hue='cylinders', size='mpg')
plt.savefig('scatter_fig.png', dpi=300)</pre>
			<div><div><img alt="Figure 2.28: Plot using the savefig method" src="img/C12913_02_28.jpg"/>
				</div>
			</div>
			<h6>Figure 2.28: Plot using the savefig method</h6>
			<p>With these complementary options, the analyst has the capability of generating visualizations for different audiences, either in notebooks, on websites, or in print.</p>
			<h3 id="_idParaDest-75"><a id="_idTextAnchor078"/>Activity 6: Exporting a Graph to a File on Disk</h3>
			<p>Saving our work to a file is a good way to enable sharing the results in different media. It also helps if we want to keep it for future reference. Let's create a graph and save it to disk:</p>
			<ol>
				<li value="1">Ingest the Auto-MPG dataset.</li>
				<li>Create any kind of graph using the Matplotlib object-oriented API. For example, here's a histogram on weight:<pre>%matplotlib inline
import matplotlib.pyplot
fig, ax = plt.subplots()
df.weight.plot(kind='hist', ax=ax)</pre></li>
				<li>Export this to a PNG file using the <code>savefig</code> function:<pre>fig.savefig('weight_hist.png')</pre><h4>Note</h4><p class="callout">The solution for this a<a id="_idTextAnchor079"/>ctivity can be found on page 209.</p></li>
			</ol>
			<h3 id="_idParaDest-76"><a id="_idTextAnchor080"/>Activity 7: Complete Plot Design</h3>
			<p>To make our graphs stand alone, separated from analysis, we need to add more information to it, for other analysis or for other users be able to grasp the graph content and understand what's being represented. We will now combine all of what we've learned in this chapter to create a complete graph, including a title, labels, and legends, and adjust the plot size.</p>
			<p>As an analyst, we want to understand whether the average miles per year increased or not, and we want to group by number of cylinders. For example, what is the behavior, in fuel consumption, of a car with three cylinders, over time? Is it higher or lower than a car with four cylinders?</p>
			<p>Follow these steps to create our final graph:</p>
			<ol>
				<li value="1">Ingest the Auto-MPG dataset.</li>
				<li>Perform the <code>groupby</code> operations on <code>year</code> and <code>cylinders</code>, and unset the option to use them as indexes.</li>
				<li>Calculate the average miles per gallon over the grouping and set year as index.</li>
				<li>Set year as the DataFrame index.</li>
				<li>Create the figure and axes using the object-oriented API.</li>
				<li>Perform the <code>groupby</code> operations on the <code>df_g</code> dataset by cylinders and plot the miles per gallon variable using the axes created with size <code>(10,8)</code>.</li>
				<li>Set the <strong class="bold">title</strong>, <strong class="bold">x</strong> label, and <strong class="bold">y</strong> label on the axes.</li>
				<li>Include the legends in the plot.</li>
				<li>Save the figure to disk as a PNG file.<h4>Note</h4><p class="callout">The solution for this activity can be found on page 211.</p></li>
			</ol>
			<p>We can infer from this graph that cars with four cylinders are more economical than cars with eight cylinders. We can also infer that all cars increased fuel efficiency during the studied period, with a decrease of four cylinders between 1980 and 1982.</p>
			<h4>Note</h4>
			<p class="callout">Notice that with the label axes and legend, the complicated transformation that was done using Pandas (group by and averaging, then setting the index) is easy to explain in the final result.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor081"/>Summary</h2>
			<p>In this chapter, we have seen the importance of creating meaningful and interesting visualizations when analyzing data. A good data visualization can immensely help the analyst's job, representing data in a way that can reach larger audiences and explain concepts that could be hard to translate into words or to represent with tables.</p>
			<p>A graph, to be effective as a data visualization tool, must show the data, avoid distortions, make understanding large datasets easy, and have a clear purpose, such as description or exploration. The main goal of a graph is to communicate data, so the analyst must keep that in mind when creating a graph. A useful graph is more desirable than a beautiful one.</p>
			<p>We demonstrated some kinds o<a id="_idTextAnchor082"/>f graphs commonly used in analysis: the line graph, the scatter plot, the histogram, and the boxplot. Each graph has its purpose and application, depending on the data and the goal. We have also shown how to create graphs directly from Matplotlib, from pandas, or a combination of both, with Matplotlib's APIs: Pyplot, the interactive API, and the object-oriented API. We finished this chapter with an explanation of the options for changing the appearance of a graph, from line styles to markers and colors, and how to save a graph to a hard copy format for printing or sharing.</p>
			<p>There are plenty of ways to configure graphs that we didn't cover here. Visualization is a large field and the tools also have a large set of options.</p>
			<p>In the next chapters, we will focus on data processing, including the manipulation of large-scale data with Hadoop and Spark. After going through the basics of both of those tools, we will return to the analysis process, which will include graphs in diverse forms.</p>
		</div>
	</body></html>